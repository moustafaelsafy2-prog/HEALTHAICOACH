<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù…Ø¯Ø±Ø¨Ùƒ Ø§Ù„ØµØ­ÙŠ Ø§Ù„Ø°ÙƒÙŠ | Your Smart Health Coach</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap');
    body {
      font-family: 'Tajawal', sans-serif;
      background-color: #F8FAFC;
      color: #334155;
    }
    .hero-bg {
      background: linear-gradient(135deg, #1A237E 0%, #0D47A1 100%);
    }
    .chat-container {
      max-width: 600px;
      margin: 0 auto;
      height: 100vh;
      display: flex;
      flex-direction: column;
      background-image: url('https://placehold.co/600x400/ECE5DD/ECE5DD');
      background-size: cover;
      background-repeat: repeat;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      border-radius: 1rem;
      overflow: hidden;
    }
    .chat-header {
      background-color: #075E54;
      color: white;
      padding: 1rem;
      text-align: center;
      position: sticky;
      top: 0;
      z-index: 10;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .chat-messages {
      flex-grow: 1;
      padding: 1rem;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      padding-bottom: 5rem;
    }
    .message-bubble {
      padding: 0.8rem 1.2rem;
      border-radius: 1.5rem;
      max-width: 80%;
      margin-bottom: 0.75rem;
      position: relative;
    }
    .message-bubble.user {
      background-color: #DCF8C6;
      margin-left: auto;
      border-bottom-left-radius: 0.2rem;
    }
    .message-bubble.ai {
      background-color: #FFFFFF;
      margin-right: auto;
      border-bottom-right-radius: 0.2rem;
    }
    .input-area {
      display: flex;
      padding: 0.5rem;
      background-color: #F0F0F0;
      border-top: 1px solid #ddd;
      position: sticky;
      bottom: 0;
      z-index: 10;
      align-items: flex-end;
    }
    .input-area input {
      flex-grow: 1;
      border-radius: 2rem;
      padding: 0.75rem 1.5rem;
      border: none;
      outline: none;
      background-color: #FFFFFF;
    }
    .input-area button {
      background-color: #075E54;
      color: white;
      border-radius: 50%;
      width: 45px;
      height: 45px;
      display: flex;
      justify-content: center;
      align-items: center;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }
    .message-bubble table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 0.5rem;
      font-size: 0.8rem;
    }
    .message-bubble th, .message-bubble td {
      border: 1px solid #e2e8f0;
      padding: 0.5rem;
      text-align: right;
    }
    .message-bubble th {
      background-color: #f1f5f9;
    }
    .summary-card {
      background: #FFFFFF;
      padding: 1.5rem;
      border-radius: 1rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .welcome-screen, .user-data-screen {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      text-align: center;
      background: linear-gradient(135deg, #075E54 0%, #128C7E 100%);
      color: white;
    }
    .cta-btn {
      background: #25D366;
      transition: all 0.3s ease;
    }
    .cta-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 8px 15px rgba(37, 211, 102, 0.4);
    }
    .lang-switcher button, .theme-toggle button {
        background-color: rgba(255, 255, 255, 0.2);
        color: white;
        padding: 0.5rem;
        border-radius: 0.5rem;
        font-size: 0.75rem;
        font-weight: bold;
        transition: all 0.3s;
    }
    .lang-switcher button.active, .theme-toggle button:hover {
        background-color: white;
        color: #075E54;
    }
    .user-data-screen input {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: white;
      padding: 0.75rem 1rem;
      border-radius: 0.5rem;
      width: 100%;
      margin-bottom: 1rem;
    }
    .user-data-screen input::placeholder {
      color: rgba(255, 255, 255, 0.7);
    }
    .footer {
      position: fixed;
      bottom: 0;
      width: 100%;
      text-align: center;
      padding: 0.5rem;
      font-size: 0.75rem;
      color: #6B7280;
      background-color: #F8FAFC;
    }
    .input-icons button {
        background: transparent;
        box-shadow: none;
        color: #6B7280;
    }
    .plan-actions-container {
      position: fixed;
      bottom: 5.5rem;
      left: 50%;
      transform: translateX(-50%);
      width: 100%;
      max-width: 600px;
      padding: 1rem;
      box-sizing: border-box;
      background-color: #F8FAFC;
      border-top: 1px solid #CBD5E1;
      text-align: center;
    }
    .dark .plan-actions-container {
      background-color: #1A1A1A;
      border-top-color: #2D3748;
    }
    
    .wave-container {
        flex-grow: 1;
        height: 40px;
        display: flex;
        align-items: center;
        gap: 2px;
        direction: ltr;
    }

    .wave-bar {
        background-color: #128C7E;
        height: 2px;
        width: 2px;
        transition: height 0.3s ease;
    }
  </style>
</head>
<body class="flex flex-col h-screen overflow-hidden">
  <div class="welcome-screen" id="welcomeScreen">
    <img src="https://placehold.co/150x150/ffffff/0D47A1?text=AI+Coach" alt="AI Coach Avatar" class="rounded-full mb-6 shadow-xl"/>
    <h1 class="text-4xl font-bold mb-2" id="welcomeTitle">Ù…Ø¯Ø±Ø¨Ùƒ Ø§Ù„ØµØ­ÙŠ Ø§Ù„Ø´Ø®ØµÙŠ</h1>
    <p class="text-xl font-light text-white/90 mb-8" id="welcomeSubtitle">Ø§Ø¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ Ù†Ø­Ùˆ Ø§Ù„Ø£ÙØ¶Ù„ Ø§Ù„Ø¢Ù†</p>
    <button id="startBtn" class="cta-btn text-white font-bold py-4 px-8 rounded-full shadow-lg hover:shadow-2xl transition-all duration-300" id="startButtonText">
      Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
    </button>
  </div>

  <div class="user-data-screen hidden" id="userDataScreen">
    <h2 class="text-3xl font-bold mb-4" id="userDataTitle">Ù„Ù†Ø¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ</h2>
    <p class="text-lg font-light text-white/90 mb-6" id="userDataSubtitle">Ø£Ø®Ø¨Ø±Ù†Ø§ Ø¹Ù† Ù†ÙØ³Ùƒ Ù„ØªØ¨Ø¯Ø£</p>
    <div class="w-full max-w-xs">
      <input type="text" id="userName" placeholder="Ø§Ø³Ù…Ùƒ" dir="rtl">
      <input type="number" id="userAge" placeholder="Ø¹Ù…Ø±Ùƒ" dir="ltr">
      <input type="text" id="userCountry" placeholder="Ø¯ÙˆÙ„ØªÙƒ" dir="rtl">
      <button id="nextBtn" class="cta-btn w-full text-white font-bold py-3 px-6 rounded-full shadow-lg hover:shadow-2xl transition-all duration-300 mt-4">
        Ø§Ù„ØªØ§Ù„ÙŠ
      </button>
    </div>
  </div>

  <div class="chat-container hidden" id="chatContainer">
    <div class="chat-header">
      <span class="text-xl font-bold" id="chatTitle">Coach AI</span>
      <div class="flex items-center space-x-2 space-x-reverse">
        <div class="lang-switcher flex">
          <button id="btnAr">Ø¹Ø±Ø¨ÙŠ</button>
          <button id="btnEn">EN</button>
        </div>
        <div class="theme-toggle">
          <button id="btnTheme">â˜€ï¸</button>
        </div>
      </div>
    </div>
    <div class="chat-messages" id="chatMessages" role="region" aria-label="Chat messages"></div>
    <div class="input-area" id="inputArea">
        <button id="plusBtn" aria-label="Ø£Ø±Ø³Ù„ Ù…Ù„Ù" class="mr-2">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-plus-circle"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="16"></line><line x1="8" y1="12" x2="16" y2="12"></line></svg>
        </button>
        <div class="flex-1 relative">
            <input type="text" id="userInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ..." dir="rtl" class="w-full"/>
            <button id="voiceBtn" aria-label="ØªØ³Ø¬ÙŠÙ„ ØµÙˆØªÙŠ" class="absolute left-2 top-1/2 -translate-y-1/2 rounded-full p-2 bg-transparent text-gray-500 hover:text-gray-700">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mic"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line></svg>
            </button>
        </div>
        <button id="sendBtn" aria-label="Ø£Ø±Ø³Ù„" class="ml-2">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-send"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
        </button>
    </div>
    <div class="recording-area hidden" id="recordingArea">
      <button id="cancelVoiceBtn" aria-label="Ø¥Ù„ØºØ§Ø¡">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-trash-2"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
      </button>
      <div class="flex items-center gap-2 flex-grow mx-4">
        <span class="timer font-medium" id="recordingTimer">00:00</span>
        <div class="wave-container" id="waveContainer"></div>
      </div>
      <button id="sendVoiceBtn" class="cta-btn text-white p-2 rounded-full">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-send"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
      </button>
    </div>
    <div class="plan-actions-container hidden" id="planActions">
      <button id="generatePlanBtn" class="cta-btn w-full text-white font-bold py-3 px-6 rounded-full shadow-lg">
        ÙŠÙ…ÙƒÙ†Ùƒ Ø¨Ø¯Ø¡ Ø®Ø·ØªÙƒ Ø§Ù„Ø¢Ù† Ø§Ø¶ØºØ· Ù‡Ù†Ø§
      </button>
      <p class="text-xs text-slate-500 mt-2" id="planActionsMessage">
        ÙŠÙ…ÙƒÙ†Ùƒ Ø£ÙŠØ¶Ø§Ù‹ Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± ÙÙŠ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ù…Ø¹ Ø§Ù„Ù…Ø¯Ø±Ø¨ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù„Ø¯ÙŠÙƒ Ø£ÙŠ Ø§Ø³ØªÙØ³Ø§Ø±Ø§Øª Ø£Ùˆ Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©.
      </p>
    </div>
  </div>

  <footer class="footer">
    Â© 2024 Ù…ØµØ·ÙÙ‰ Ø§Ù„ØµØ§ÙÙŠ
  </footer>

  <script>
    const chatMessages = document.getElementById('chatMessages');
    const userInput = document.getElementById('userInput');
    const sendBtn = document.getElementById('sendBtn');
    const startBtn = document.getElementById('startBtn');
    const nextBtn = document.getElementById('nextBtn');
    const welcomeScreen = document.getElementById('welcomeScreen');
    const userDataScreen = document.getElementById('userDataScreen');
    const chatContainer = document.getElementById('chatContainer');
    const userNameInput = document.getElementById('userName');
    const userAgeInput = document.getElementById('userAge');
    const userCountryInput = document.getElementById('userCountry');
    const btnAr = document.getElementById('btnAr');
    const btnEn = document.getElementById('btnEn');
    const btnTheme = document.getElementById('btnTheme');
    const plusBtn = document.getElementById('plusBtn');
    const voiceBtn = document.getElementById('voiceBtn');
    const fileInput = document.getElementById('fileInput');
    const recordingArea = document.getElementById('recordingArea');
    const cancelVoiceBtn = document.getElementById('cancelVoiceBtn');
    const sendVoiceBtn = document.getElementById('sendVoiceBtn');
    const recordingTimer = document.getElementById('recordingTimer');
    const planActionsContainer = document.getElementById('planActions');
    const generatePlanBtn = document.getElementById('generatePlanBtn');
    const waveContainer = document.getElementById('waveContainer');

    let userState = { step: -1, data: {} };
    let LANG = 'ar';
    let isRecording = false;
    let recordingInterval;
    let seconds = 0;
    let mediaRecorder;
    let audioChunks = [];
    
    const i18n = {
      ar: {
        welcomeTitle: 'Ù…Ø¯Ø±Ø¨Ùƒ Ø§Ù„ØµØ­ÙŠ Ø§Ù„Ø´Ø®ØµÙŠ',
        welcomeSubtitle: 'Ø§Ø¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ Ù†Ø­Ùˆ Ø§Ù„Ø£ÙØ¶Ù„ Ø§Ù„Ø¢Ù†',
        startButtonText: 'Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©',
        userDataTitle: 'Ù„Ù†Ø¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ',
        userDataSubtitle: 'Ø£Ø®Ø¨Ø±Ù†Ø§ Ø¹Ù† Ù†ÙØ³Ùƒ Ù„ØªØ¨Ø¯Ø£',
        namePlaceholder: 'Ø§Ø³Ù…Ùƒ',
        agePlaceholder: 'Ø¹Ù…Ø±Ùƒ',
        countryPlaceholder: 'Ø¯ÙˆÙ„ØªÙƒ',
        nextButtonText: 'Ø§Ù„ØªØ§Ù„ÙŠ',
        chatTitle: 'Coach AI',
        inputPlaceholder: 'Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ...',
        prompts: [
            "Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ {name}! Ø£Ù†Ø§ Ù‡Ù†Ø§ Ù„Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ. ÙƒÙ† Ù…Ø³ØªØ¹Ø¯Ø§Ù‹ Ù„Ø±Ø­Ù„Ø© ØªØ­ÙˆÙŠÙ„ÙŠØ©ØŒ ÙÙ†Ø­Ù† Ù†Ø¹Ø¯Ùƒ Ø¨Ø®Ø·Ø© Ø¯Ù‚ÙŠÙ‚Ø© 100%ØŒ Ù…ØµÙ…Ù…Ø© Ø®ØµÙŠØµØ§Ù‹ Ù„Ùƒ. ÙƒÙ„ Ù…Ø§ Ø¹Ù„ÙŠÙƒ Ù‡Ùˆ Ø§Ù„ØªØ­Ø¯Ø« Ù…Ø¹ Ù…Ø¯Ø±Ø¨Ùƒ Ù…ØµØ·ÙÙ‰ Ø§Ù„ØµØ§ÙÙŠ Ù‡Ù†Ø§.",
            "ØªÙ…Ø§Ù…ØŒ Ø¹Ù„Ø´Ø§Ù† Ø£Ù‚Ø¯Ø± Ø£Ø®ØµØµ Ø§Ù„Ø®Ø·Ø© Ù„ÙŠÙƒ Ø¨Ø§Ù„Ø¸Ø¨Ø·ØŒ Ù…Ù…ÙƒÙ† ØªÙ‚ÙˆÙ„ÙŠ ÙƒØ§Ù… Ø¹Ù…Ø±Ùƒ ÙˆØ¬Ù†Ø³Ùƒ (Ø°ÙƒØ±/Ø£Ù†Ø«Ù‰) ÙˆØ·ÙˆÙ„Ùƒ ÙˆÙˆØ²Ù†ÙƒØŸ",
            "ØªÙ…Ø§Ù… ÙŠØ§ Ø¨Ø·Ù„. Ù„Ùˆ Ø¹Ù†Ø¯Ùƒ Ø£ÙŠ ÙÙƒØ±Ø© Ø¹Ù† Ù†Ø³Ø¨Ø© Ø§Ù„Ø¯Ù‡ÙˆÙ† Ø£Ùˆ Ù…Ø­ÙŠØ· Ø§Ù„Ø®ØµØ±ØŒ Ù…Ù…ÙƒÙ† ØªÙ‚ÙˆÙ„ Ù„ÙŠØŸ Ù„Ùˆ Ù„Ø£ØŒ Ù…Ø§ÙÙŠØ´ Ù…Ø´ÙƒÙ„Ø©.",
            "Ø¹Ø¸ÙŠÙ…. Ø¹Ù„Ø´Ø§Ù† Ø£ÙƒÙˆÙ† Ø¯Ù‚ÙŠÙ‚ Ø£ÙƒØªØ±ØŒ ÙƒØ§Ù… ÙŠÙˆÙ… ÙÙŠ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ù†Ø§ÙˆÙŠ ØªØªÙ…Ø±Ù†ØŸ ÙˆÙ…Ø¯Ø© Ø§Ù„Ø¬Ù„Ø³Ø© Ø¨ØªÙƒÙˆÙ† ÙÙŠ Ø­Ø¯ÙˆØ¯ ÙƒØ§Ù… Ø³Ø§Ø¹Ø©ØŸ",
            "ØªÙ…Ø§Ù…. ÙÙŠÙ† Ø¨ØªÙØ¶Ù„ ØªØªÙ…Ø±Ù†ØŸ ÙÙŠ **Ø§Ù„Ø¨ÙŠØª** ÙˆÙ„Ø§ **Ø§Ù„Ø¬ÙŠÙ…**ØŸ ÙˆÙ‚ÙˆÙ„ Ù„ÙŠ ÙƒÙ…Ø§Ù† Ø¥ÙŠÙ‡ Ù‡ÙŠ Ø§Ù„Ù…Ø¹Ø¯Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© Ø¹Ù†Ø¯Ùƒ.",
            "Ø¹Ø¸ÙŠÙ…! Ø¨Ø§Ù„Ù†Ø³Ø¨Ø© Ù„Ù†Ø¸Ø§Ù…Ùƒ Ø§Ù„ØºØ°Ø§Ø¦ÙŠØŒ Ø¨ØªÙØ¶Ù„ Ù†Ø¸Ø§Ù… Ù…Ø¹ÙŠÙ†ØŸ Ø²ÙŠ Ù…Ø«Ù„Ø§Ù‹ **Ù†Ø¸Ø§Ù… Ù…ØªÙˆØ§Ø²Ù†**ØŒ Ø£Ùˆ **Ù‚Ù„ÙŠÙ„ Ø§Ù„ÙƒØ±Ø¨ÙˆÙ‡ÙŠØ¯Ø±Ø§Øª**ØŒ Ø£Ùˆ Ø£ÙŠ Ù†Ø¸Ø§Ù… ØªØ§Ù†ÙŠØŸ ÙˆÙƒÙ… ÙˆØ¬Ø¨Ø© ÙÙŠ Ø§Ù„ÙŠÙˆÙ… Ø¨ØªÙƒÙˆÙ† Ù…Ù†Ø§Ø³Ø¨Ø© Ù„ÙŠÙƒØŸ",
            "ØªÙ…Ø§Ù…. Ù‡Ù„ Ø¹Ù†Ø¯Ùƒ Ø£ÙŠ Ø­Ø³Ø§Ø³ÙŠØ© ØªØ¬Ø§Ù‡ Ø£ÙŠ Ù†ÙˆØ¹ Ù…Ù† Ø§Ù„Ø£ÙƒÙ„ØŸ (Ù…Ø«Ù„Ø§Ù‹: Ø¬Ù„ÙˆØªÙŠÙ†ØŒ Ù„Ø§ÙƒØªÙˆØ²ØŒ ÙÙˆÙ„ Ø³ÙˆØ¯Ø§Ù†ÙŠØŒ Ø¨ÙŠØ¶ØŒ Ø¥Ù„Ø®).",
            "ØªÙ…Ø§Ù… ÙŠØ§ Ø¨Ø·Ù„. Ø¥ÙŠÙ‡ Ø£Ù‡Ù… Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„Ù„ÙŠ Ø¨ØªÙˆØ§Ø¬Ù‡Ù‡Ø§ Ø¹Ø§Ø¯Ø©Ù‹ ÙÙŠ Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„ØºØ°Ø§Ø¦ÙŠØ© Ø£Ùˆ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ©ØŸ (Ù…Ø«Ù„Ø§Ù‹: Ø¬ÙˆØ¹ØŒ Ø¶ØºØ· Ø§Ù„ÙˆÙ‚ØªØŒ Ø³ÙØ±ØŒ Ø¥Ù„Ø®).",
            "ØªÙ…Ø§Ù…. Ø®Ù„ÙŠÙ†Ø§ Ù†Ø´ÙˆÙ Ù†Ù…Ø· Ø­ÙŠØ§ØªÙƒ. Ù…Ù…ÙƒÙ† ØªÙˆØµÙ Ù„ÙŠ Ù†Ø´Ø§Ø·Ùƒ ÙÙŠ Ø§Ù„Ø´ØºÙ„ØŸ (Ù…Ø«Ù„Ø§Ù‹: Ù…ÙƒØªØ¨ÙŠØŒ Ø®ÙÙŠÙØŒ Ù…ØªÙˆØ³Ø·ØŒ Ø«Ù‚ÙŠÙ„) ÙˆÙƒÙ… Ø®Ø·ÙˆØ© Ø¨ØªÙ…Ø´ÙŠÙ‡Ø§ ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹ ÙÙŠ Ø§Ù„ÙŠÙˆÙ…ØŸ",
            "Ø¹Ø¸ÙŠÙ…. ÙˆØ¨ØªÙ†Ø§Ù… ÙƒØ§Ù… Ø³Ø§Ø¹Ø© ÙÙŠ Ø§Ù„ÙŠÙˆÙ… ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹ØŒ ÙˆÙ…Ø³ØªÙˆÙ‰ Ø§Ù„ØªÙˆØªØ± Ø¹Ù†Ø¯Ùƒ Ø¹Ø§Ù…Ù„ Ø¥Ø²Ø§ÙŠØŸ (Ù…Ù†Ø®ÙØ¶ØŒ Ù…ØªÙˆØ³Ø·ØŒ Ù…Ø±ØªÙØ¹)",
            "ØªÙ…Ø§Ù…. Ù‡Ù„ Ø¹Ù†Ø¯Ùƒ Ø£ÙŠ Ø¥ØµØ§Ø¨Ø§Øª Ø­Ø§Ù„ÙŠØ© Ø£Ùˆ Ù‚ÙŠÙˆØ¯ Ø·Ø¨ÙŠØ©ØŸ ÙˆÙ‡Ù„ Ø¨ØªØ§Ø®Ø¯ Ø£ÙŠ Ø£Ø¯ÙˆÙŠØ© Ø£Ùˆ Ù…ÙƒÙ…Ù„Ø§Øª ØºØ°Ø§Ø¦ÙŠØ© ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠØŸ",
            "Ù…Ù…ØªØ§Ø². Ø¢Ø®Ø± Ø³Ø¤Ø§Ù„ØŒ Ù‡Ù„ ÙÙŠÙ‡ Ø¹Ø¶Ù„Ø§Øª Ù…Ø¹ÙŠÙ†Ø© Ø¨ØªØ­Ø³ Ø¥Ù†Ù‡Ø§ Ù…Ø­ØªØ§Ø¬Ø© ØªØ±ÙƒÙŠØ² Ø®Ø§Øµ ÙÙŠ Ø§Ù„ØªÙ…Ø±ÙŠÙ†ØŸ (Ø²ÙŠ Ø§Ù„ØµØ¯Ø±ØŒ Ø§Ù„Ø¸Ù‡Ø±ØŒ Ø§Ù„Ø£ÙƒØªØ§ÙØŒ Ø¥Ù„Ø®).",
        ],
        summaryTitle: '**Ù…Ù„Ø®Øµ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ:**',
        confirmMessage: 'Ù‡Ù„ ÙƒÙ„ Ø­Ø§Ø¬Ø© ØªÙ…Ø§Ù…ØŸ Ù†ÙˆÙ„Ù‘Ø¯ Ø§Ù„Ø®Ø·Ø©ØŸ (Ø¬Ø§ÙˆØ¨ Ø¨Ù€ "Ø£ÙŠÙˆÙ‡" Ø£Ùˆ "Ø¹Ø¯Ù‘Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª")',
        editPrompt: 'ØªÙ…Ø§Ù…. Ø§ÙŠÙ‡ Ø§Ù„Ù„ÙŠ Ù…Ø­ØªØ§Ø¬ Ù†Ø¹Ø¯Ù„Ù‡ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¯ÙŠØŸ',
        badInput: "ÙŠØ§ Ø±ÙŠØª Ù„Ùˆ Ù…Ù…ÙƒÙ† ØªØ¯ÙŠÙ†ÙŠ Ø§Ù„Ø¹Ù…Ø± ÙˆØ§Ù„Ø¬Ù†Ø³ ÙˆØ§Ù„Ø·ÙˆÙ„ ÙˆØ§Ù„ÙˆØ²Ù† Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨ Ø¯Ù‡ØŒ Ø¹Ù„Ø´Ø§Ù† Ø£Ù‚Ø¯Ø± Ø£Ø¸Ø¨Ø· Ø§Ù„Ø®Ø·Ø©.",
        weirdWeight: "Ø§Ù„ÙˆØ²Ù† Ø¯Ù‡ ØºØ±ÙŠØ¨ Ø´ÙˆÙŠØ©. Ù…Ù…ÙƒÙ† ØªØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù„ÙŠ Ø¯Ø®Ù„ØªÙ‡ØŸ",
        emptyFields: "Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù…Ùƒ ÙˆØ¹Ù…Ø±Ùƒ ÙˆØ¯ÙˆÙ„ØªÙƒ Ù„Ù„Ø¨Ø¯Ø¡.",
        imageUpload: 'ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø©. Ø§Ù„Ù…Ø¯Ø±Ø¨ Ø¨ÙŠØ­Ù„Ù„Ù‡Ø§ Ø¯Ù„ÙˆÙ‚ØªÙŠ...',
        generationStart: 'ØªÙ…Ø§Ù… ÙŠØ§ Ø¨Ø·Ù„ØŒ Ù„Ø­Ø¸Ø§Øª ÙˆÙ‡ØªÙƒÙˆÙ† Ø®Ø·ØªÙƒ Ø¬Ø§Ù‡Ø²Ø©. Ø£Ù†Ø§ Ø¨Ø¬Ù‡Ø²Ù‡Ø§ Ø§Ù„Ø¢Ù†.',
        generationDone: 'ØªÙ… ÙŠØ§ Ø¨Ø·Ù„! Ø§Ù„Ø®Ø·Ø© ÙƒØ§Ù…Ù„Ø© Ø¹Ù†Ø¯Ùƒ. Ù„Ùˆ ÙÙŠÙ‡ Ø£ÙŠ ØªØ¹Ø¯ÙŠÙ„ Ø£Ùˆ Ø³Ø¤Ø§Ù„ØŒ Ø£Ù†Ø§ Ù…ÙˆØ¬ÙˆØ¯.',
        editPart: 'Ø£Ù†Ø§ Ø£Ù‚Ø¯Ø± Ø£Ø¹Ø¯Ù„ Ø£ÙŠ Ø¬Ø²Ø¡. Ù‚ÙˆÙ„ Ù„ÙŠ Ø¥ÙŠÙ‡ Ø§Ù„Ù„ÙŠ Ù…Ø­ØªØ§Ø¬ ÙŠØªØºÙŠØ± ÙÙŠ Ø§Ù„Ø®Ø·Ø©.',
        selectDay: 'Ø­Ø¯Ø¯ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ù„ÙŠ Ø¹Ø§ÙŠØ² ØªØ¹Ø¯Ù„Ù‡ Ø¹Ø´Ø§Ù† Ø£Ù‚Ø¯Ø± Ø£Ø³Ø§Ø¹Ø¯Ùƒ.',
        planActionMessage: "ÙŠÙ…ÙƒÙ†Ùƒ Ø£ÙŠØ¶Ø§Ù‹ Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± ÙÙŠ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ù…Ø¹ Ø§Ù„Ù…Ø¯Ø±Ø¨ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù„Ø¯ÙŠÙƒ Ø£ÙŠ Ø§Ø³ØªÙØ³Ø§Ø±Ø§Øª Ø£Ùˆ Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©."
      },
      en: {
        welcomeTitle: 'Your Personal Health Coach',
        welcomeSubtitle: 'Start your journey to a better you now',
        startButtonText: 'Start Chat',
        userDataTitle: 'Letâ€™s start your journey',
        userDataSubtitle: 'Tell us about yourself to begin',
        namePlaceholder: 'Your Name',
        agePlaceholder: 'Your Age',
        countryPlaceholder: 'Your Country',
        nextButtonText: 'Next',
        chatTitle: 'Coach AI',
        inputPlaceholder: 'Type your message...',
        prompts: [
          "Hello, {name}! I'm here to help you. Get ready for a transformative journey; we promise you a 100% accurate plan, tailored specifically for you. All you have to do is talk to your coach Mustafa Elsafy here.",
          "Okay, to fully customize your plan, could you tell me your age, gender (Male/Female), height, and weight?",
          "Great, champ. If you have any idea about your body fat percentage or waist circumference, could you share them? If not, no problem.",
          "Awesome. To be more precise, how many days a week do you plan to work out? And what's the session length in hours?",
          "Okay. Where do you prefer to train? At **home** or at the **gym**? And tell me what equipment you have available.",
          "Awesome! Regarding your diet, do you have a preferred style? For example, a **balanced diet**, or **low-carb**, or any other? And how many meals a day would be suitable for you?",
          "Okay. Do you have any allergies to any type of food? (e.g., gluten, lactose, peanuts, eggs, etc.).",
          "Okay, champ. What are the main challenges you usually face with diet or workout plans? (e.g., hunger, time pressure, travel, etc.).",
          "Okay. Let's look at your lifestyle. Could you describe your work activity? (e.g., sedentary, light, moderate, heavy) and approximately how many steps you take per day?",
          "Great. And how many hours do you sleep per day, and what's your stress level? (low, moderate, high)",
          "Okay. Do you have any current injuries or medical conditions? And are you currently taking any medications or supplements?",
          "Excellent. Last question, are there any specific muscles you feel need special focus in your workout? (like chest, back, shoulders, etc.).",
        ],
        summaryTitle: '**Your Data Summary:**',
        confirmMessage: 'Is everything correct? Shall we generate the plan? (Reply with "yes" or "edit data")',
        editPrompt: 'Okay. What do you need to change in the data?',
        badInput: "Could you please provide your age, gender, height, and weight in that order to help me tailor the plan?",
        weirdWeight: "That weight seems a bit odd. Could you please double-check the weight you entered?",
        emptyFields: "Please enter your name, age, and country to get started.",
        imageUpload: 'Image sent. The coach is analyzing it now...',
        generationStart: 'Okay, champ! Your plan will be ready in a few moments. I\'m preparing it now.',
        generationDone: 'Done, champ! Your complete plan is ready. If you have any questions or need to make changes, I\'m here for you.',
        editPart: 'I can edit any part. Tell me what needs to be changed in the plan.',
        selectDay: 'Please specify the day you want to edit so I can help you.',
        planActionMessage: "You can also continue the conversation with the coach if you have any questions or want to provide additional data."
      },
    };
    
    function setLang(lang) {
      LANG = lang;
      document.documentElement.lang = lang;
      document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
      
      const L = i18n[LANG];
      
      const welcomeTitle = document.getElementById('welcomeTitle');
      if (welcomeTitle) welcomeTitle.textContent = L.welcomeTitle;
      const welcomeSubtitle = document.getElementById('welcomeSubtitle');
      if (welcomeSubtitle) welcomeSubtitle.textContent = L.welcomeSubtitle;
      const startButtonText = document.getElementById('startButtonText');
      if (startButtonText) startButtonText.textContent = L.startButtonText;

      const userDataTitle = document.getElementById('userDataTitle');
      if (userDataTitle) userDataTitle.textContent = L.userDataTitle;
      const userDataSubtitle = document.getElementById('userDataSubtitle');
      if (userDataSubtitle) userDataSubtitle.textContent = L.userDataSubtitle;
      const userName = document.getElementById('userName');
      if (userName) userName.placeholder = L.namePlaceholder;
      const userAge = document.getElementById('userAge');
      if (userAge) userAge.placeholder = L.agePlaceholder;
      const userCountry = document.getElementById('userCountry');
      if (userCountry) userCountry.placeholder = L.countryPlaceholder;
      const nextBtn = document.getElementById('nextBtn');
      if (nextBtn) nextBtn.textContent = L.nextButtonText;

      const chatTitle = document.getElementById('chatTitle');
      if (chatTitle) chatTitle.textContent = L.chatTitle;
      const userInput = document.getElementById('userInput');
      if (userInput) userInput.placeholder = L.inputPlaceholder;
      const btnAr = document.getElementById('btnAr');
      if (btnAr) btnAr.classList.toggle('active', LANG === 'ar');
      const btnEn = document.getElementById('btnEn');
      if (btnEn) btnEn.classList.toggle('active', LANG === 'en');
      const planActionsMessage = document.getElementById('planActionsMessage');
      if(planActionsMessage) planActionsMessage.textContent = L.planActionMessage;
    }

    function setTheme() {
      document.body.classList.toggle('dark');
      const isDarkMode = document.body.classList.contains('dark');
      btnTheme.textContent = isDarkMode ? 'ğŸŒ™' : 'â˜€ï¸';
      localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
    }

    function showToast(msg) {
        const t = document.createElement('div');
        t.className = 'fixed bottom-4 left-1/2 -translate-x-1/2 bg-red-600 text-white px-4 py-2 rounded-lg text-sm z-50';
        t.textContent = msg;
        document.body.appendChild(t);
        setTimeout(() => t.remove(), 3000);
    }

    function displayMessage(message, sender) {
      const bubble = document.createElement('div');
      bubble.classList.add('message-bubble', sender);
      bubble.innerHTML = marked.parse(message);
      chatMessages.appendChild(bubble);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }
    
    // Main function to send prompt to AI
    async function sendPromptToAI(prompt) {
        // Here we construct a comprehensive prompt for the AI
        const L = i18n[LANG];
        const fullPrompt = `
        You are Coach Mustafa Elsafy, a top-level health coach, nutritionist, and doctor.
        User's profile: Name: ${userState.data.name}, Age: ${userState.data.age}, Country: ${userState.data.country}.
        User's goals: ${userState.data.goals}.
        User's lifestyle: Work activity: ${userState.data.workActivity}, Daily steps: ${userState.data.dailySteps}.
        Health and constraints: Allergies: ${userState.data.allergies}, Medical conditions: ${userState.data.injuries}.

        Task: Generate a complete health plan for the user, acting as a coach, nutritionist, and doctor. The plan should be presented in a friendly, conversational tone and include a detailed meal plan, workout routine, and medical safety advice. The response must be in Markdown.
        `;
        
        // This part is a mock for Gemini API call
        // In a real app, this would be a fetch() call to a serverless function
        // that handles the actual API call to Gemini, for example:
        // const response = await fetch('/.netlify/functions/gemini-proxy', {
        //     method: 'POST',
        //     body: JSON.stringify({ prompt: fullPrompt })
        // });
        // const data = await response.json();
        // displayMessage(data.text, 'ai');

        // For this demo, we'll use a mock response based on a simple prompt check.
        // This section needs to be replaced with a real API call for true AI capabilities.
        const mockResponse = getMockAIResponse(prompt, L);
        displayMessage(mockResponse, 'ai');
    }

    function getMockAIResponse(prompt, L) {
        if (prompt.includes('Ø®Ø·Ø©')) {
            return getMockPlanData(userState.data);
        } else if (prompt.includes('Ø£Ù‡Ù„Ø§Ù‹')) {
            return `Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ ${userState.data.name}! Ø£Ù†Ø§ ÙÙŠ Ø®Ø¯Ù…ØªÙƒ.`;
        } else if (prompt.includes('Ø§Ù„Ø³Ø¹Ø±Ø§Øª')) {
            return 'Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§ØªÙƒØŒ Ø§Ù„Ø³Ø¹Ø±Ø§Øª Ø§Ù„Ø­Ø±Ø§Ø±ÙŠØ© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø© Ù„Ùƒ Ù‡ÙŠ Ø­ÙˆØ§Ù„ÙŠ 2200 Ø³Ø¹Ø± Ø­Ø±Ø§Ø±ÙŠ ÙÙŠ Ø§Ù„ÙŠÙˆÙ….';
        } else if (prompt.includes('ØºÙŠØ± ÙˆØ§Ø¶Ø­')) {
            return 'Ø£Ù†Ø§ Ø¢Ø³ÙØŒ Ù„Ù… Ø£ÙÙ‡Ù… Ù…Ø§ ØªÙ‚ØµØ¯Ù‡. Ù‡Ù„ ÙŠÙ…ÙƒÙ†Ùƒ ØªÙˆØ¶ÙŠØ­ Ø·Ù„Ø¨Ùƒ Ø¨Ø´ÙƒÙ„ Ø£ÙØ¶Ù„ØŸ';
        } else {
            return 'ØªÙ…Ø§Ù…. Ø£Ù†Ø§ Ø£Ø­Ù„Ù„ Ø·Ù„Ø¨Ùƒ Ø§Ù„Ø¢Ù†.';
        }
    }
    
    // Hardcoded data for demonstration
    const getMockPlanData = (data) => {
        return `
    **Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ Ø¨Ø·Ù„!**

    Ø£Ù†Ø§ Ù…ØªØ­Ù…Ø³ Ø¬Ø¯Ø§Ù‹ Ù„Ø¨Ø¯Ø§ÙŠØ© Ø±Ø­Ù„ØªÙƒ Ù…Ø¹ÙŠ. Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù„ÙŠ Ø´Ø§Ø±ÙƒØªÙ‡Ø§ØŒ Ø£Ù†Ø§ ÙˆÙØ±ÙŠÙ‚ÙŠ Ù…Ù† Ø§Ù„Ø®Ø¨Ø±Ø§Ø¡ Ø¬Ù‡Ø²Ù†Ø§ Ù„Ùƒ Ø®Ø·Ø© Ù…ØªÙƒØ§Ù…Ù„Ø© ÙˆÙ…Ø®ØµØµØ© Ø¨Ù†Ø³Ø¨Ø© 100% Ø¹Ø´Ø§Ù† ØªØ­Ù‚Ù‚ ÙƒÙ„ Ø£Ù‡Ø¯Ø§ÙÙƒ.

    ---
    ### **ØªØ­Ù„ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ**

    * **Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ:** Ø®Ø³Ø§Ø±Ø© Ø§Ù„Ø¯Ù‡ÙˆÙ†
    * **Ø§Ù„Ø³Ø¹Ø±Ø§Øª Ø§Ù„Ø­Ø±Ø§Ø±ÙŠØ© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©:** 2,200 Ø³Ø¹Ø±Ø© Ø­Ø±Ø§Ø±ÙŠØ©. ØªÙ… Ø­Ø³Ø§Ø¨Ù‡Ø§ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø¹Ù…Ø±Ùƒ ÙˆÙˆØ²Ù†Ùƒ ÙˆØ·ÙˆÙ„Ùƒ ÙˆÙ…Ø³ØªÙˆÙ‰ Ù†Ø´Ø§Ø·Ùƒ.
    * **Ø§Ù„Ù…Ø§ÙƒØ±ÙˆØ² (Ø§Ù„Ø¨Ø±ÙˆØªÙŠÙ†/Ø§Ù„Ø¯Ù‡ÙˆÙ†/Ø§Ù„ÙƒØ±Ø¨ÙˆÙ‡ÙŠØ¯Ø±Ø§Øª):**
        * **Ø§Ù„Ø¨Ø±ÙˆØªÙŠÙ†:** 160 Ø¬Ø±Ø§Ù…. Ø£Ø³Ø§Ø³ÙŠ Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„ÙƒØªÙ„Ø© Ø§Ù„Ø¹Ø¶Ù„ÙŠØ© Ø£Ø«Ù†Ø§Ø¡ Ø®Ø³Ø§Ø±Ø© Ø§Ù„Ø¯Ù‡ÙˆÙ†.
        * **Ø§Ù„Ø¯Ù‡ÙˆÙ†:** 65 Ø¬Ø±Ø§Ù…. Ø¶Ø±ÙˆØ±ÙŠØ© Ù„ØµØ­Ø© Ø§Ù„Ù‡Ø±Ù…ÙˆÙ†Ø§Øª ÙˆÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¬Ø³Ù….
        * **Ø§Ù„ÙƒØ±Ø¨ÙˆÙ‡ÙŠØ¯Ø±Ø§Øª:** 230 Ø¬Ø±Ø§Ù…. Ù…ØµØ¯Ø± Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ù„Ø¬Ø³Ù…ØŒ Ø®Ø§ØµØ© Ù„Ù„ØªÙ…Ø§Ø±ÙŠÙ†.
    * **Ø§Ù„Ù‚ÙŠÙˆØ¯:** ØªÙ… Ù…Ø±Ø§Ø¹Ø§Ø© Ø­Ø³Ø§Ø³ÙŠØªÙƒ Ù…Ù† Ø§Ù„Ù„Ø§ÙƒØªÙˆØ² ÙˆØªØ­Ø¯ÙŠ Ø§Ù„Ø¬ÙˆØ¹ Ø§Ù„Ø°ÙŠ ÙˆØ§Ø¬Ù‡ØªÙ‡ Ø³Ø§Ø¨Ù‚Ø§Ù‹.

    ---
    ### **Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ØªØºØ°ÙŠØ© (7 Ø£ÙŠØ§Ù…)**

    ØªÙ… ØªØµÙ…ÙŠÙ… Ù†Ø¸Ø§Ù…Ùƒ Ø§Ù„ØºØ°Ø§Ø¦ÙŠ Ù„ÙŠÙƒÙˆÙ† Ø³Ù‡Ù„ Ø§Ù„ØªØ­Ø¶ÙŠØ± (Ø£Ù‚Ù„ Ù…Ù† 30 Ø¯Ù‚ÙŠÙ‚Ø©) ÙˆÙŠØ³Ø§Ø¹Ø¯Ùƒ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø¹ÙˆØ± Ø¨Ø§Ù„Ø´Ø¨Ø¹.

    | Ø§Ù„ÙˆØ¬Ø¨Ø© | Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª | Ø§Ù„Ø³Ø¹Ø±Ø§Øª (kcal) | Ø§Ù„Ø¨Ø±ÙˆØªÙŠÙ† (g) | Ø§Ù„Ø¯Ù‡ÙˆÙ† (g) | Ø§Ù„ÙƒØ±Ø¨ÙˆÙ‡ÙŠØ¯Ø±Ø§Øª (g) |
    |---|---|---|---|---|---|
    | **Ø§Ù„ÙŠÙˆÙ… 1** | | | | | |
    | Ø§Ù„ÙØ·ÙˆØ± | 3 Ø¨ÙŠØ¶Ø§Øª Ù…Ø®ÙÙˆÙ‚Ø© Ù…Ø¹ Ø§Ù„Ø³Ø¨Ø§Ù†Ø®ØŒ 1 Ø´Ø±ÙŠØ­Ø© Ø®Ø¨Ø² Ù…Ø­Ù…Øµ Ù…Ù† Ø§Ù„Ø­Ø¨ÙˆØ¨ Ø§Ù„ÙƒØ§Ù…Ù„Ø© | 450 | 25 | 25 | 30 |
    | Ø§Ù„ØºØ¯Ø§Ø¡ | 150 Ø¬Ø±Ø§Ù… ØµØ¯Ø± Ø¯Ø¬Ø§Ø¬ Ù…Ø´ÙˆÙŠØŒ ÙƒÙˆØ¨ Ø£Ø±Ø² Ø¨Ø³Ù…ØªÙŠØŒ Ø³Ù„Ø·Ø© Ø®Ø¶Ø±Ø§Ø¡ ÙƒØ¨ÙŠØ±Ø© | 600 | 45 | 10 | 80 |
    | Ø§Ù„Ø¹Ø´Ø§Ø¡ | 200 Ø¬Ø±Ø§Ù… Ø³Ù…Ùƒ Ø§Ù„Ø³Ù„Ù…ÙˆÙ† Ø§Ù„Ù…Ø´ÙˆÙŠØŒ Ø®Ø¶Ø§Ø± Ù…Ø´ÙˆÙŠØ© (Ø¨Ø±ÙˆÙƒÙ„ÙŠØŒ ÙÙ„ÙÙ„) | 550 | 40 | 30 | 25 |
    | **Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹** | | 1600 | 110 | 65 | 135 |

    ---
    ### **Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ (3 Ø£ÙŠØ§Ù…)**

    ØªÙ… ØªØµÙ…ÙŠÙ… Ø¨Ø±Ù†Ø§Ù…Ø¬Ùƒ Ù„Ù€ 3 Ø£ÙŠØ§Ù… Ø£Ø³Ø¨ÙˆØ¹ÙŠØ§Ù‹ Ù…Ø¹ Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ ØªÙ‚ÙˆÙŠØ© Ø¹Ø¶Ù„Ø§Øª Ø§Ù„Ø¸Ù‡Ø± ÙˆØ§Ù„Ø£ÙƒØªØ§Ù.

    | Ø§Ù„ÙŠÙˆÙ… | Ø§Ù„ØªÙ…Ø±ÙŠÙ† | Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª | Ø§Ù„ØªÙƒØ±Ø§Ø±Ø§Øª | Ø§Ù„Ø±Ø§Ø­Ø© (Ø«Ø§Ù†ÙŠØ©) |
    |---|---|---|---|---|
    | **Ø§Ù„ÙŠÙˆÙ… 1** | | | | |
    | Ø§Ù„Ø¥Ø­Ù…Ø§Ø¡ | 5 Ø¯Ù‚Ø§Ø¦Ù‚ Ù…Ø´ÙŠ Ø³Ø±ÙŠØ¹ Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ± | | | |
    | ØªÙ…Ø±ÙŠÙ† 1 | Ø³Ø­Ø¨ Ø§Ù„Ø¨Ø§Ø± (Barbell Rows) | 3 | 10-12 | 90 |
    | ØªÙ…Ø±ÙŠÙ† 2 | ØªÙ…Ø±ÙŠÙ† Ø§Ù„Ø¶ØºØ· (Push-ups) | 3 | 8-10 | 60 |
    | ØªÙ…Ø±ÙŠÙ† 3 | Ø§Ù„Ø±ÙØ¹Ø© Ø§Ù„Ù…Ù…ÙŠØªØ© (Deadlifts) | 3 | 6-8 | 120 |
    | Ø§Ù„Ø¥Ø·Ø§Ù„Ø© | Ø¥Ø·Ø§Ù„Ø© Ø§Ù„Ø¸Ù‡Ø± ÙˆØ£ÙˆØªØ§Ø± Ø§Ù„Ø±ÙƒØ¨Ø© | 5 Ø¯Ù‚Ø§Ø¦Ù‚ | | |

    ---
    ### **Ø§Ù„Ù…ÙƒÙ…Ù„Ø§Øª Ø§Ù„ØºØ°Ø§Ø¦ÙŠØ©**

    Ù„ØªØ­Ù‚ÙŠÙ‚ Ø£Ù‡Ø¯Ø§ÙÙƒ Ø¨Ø´ÙƒÙ„ Ø£Ø³Ø±Ø¹ØŒ Ø¥Ù„ÙŠÙƒ Ø¨Ø¹Ø¶ Ø§Ù„Ù…ÙƒÙ…Ù„Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©:
    * **Ø§Ù„ÙƒØ±ÙŠØ§ØªÙŠÙ†:** 5 Ø¬Ø±Ø§Ù… ÙŠÙˆÙ…ÙŠØ§Ù‹. ÙŠØ³Ø§Ø¹Ø¯ Ø¹Ù„Ù‰ Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù‚ÙˆØ© ÙˆØ§Ù„Ø£Ø¯Ø§Ø¡.
    * **Ø§Ù„Ø¨Ø±ÙˆØªÙŠÙ†:** 30 Ø¬Ø±Ø§Ù… Ø¨Ø¹Ø¯ Ø§Ù„ØªÙ…Ø±ÙŠÙ† Ù…Ø¨Ø§Ø´Ø±Ø©. ÙŠØ¹Ø²Ø² ØªØ¹Ø§ÙÙŠ Ø§Ù„Ø¹Ø¶Ù„Ø§Øª.

    ---
    ### **Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ¨**

    Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù…Ù„ÙÙƒØŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙŠ Ø­Ø§Ù„Ø§Øª Ø·Ø¨ÙŠØ© ØªØ³ØªØ¯Ø¹ÙŠ Ù‚Ù„Ù‚Ø§Ù‹. ÙˆÙ…Ø¹ Ø°Ù„ÙƒØŒ Ù†ÙˆØµÙŠ Ø¨Ø§Ù„Ø¢ØªÙŠ:
    * **Ø§Ù„ØªØ±Ø·ÙŠØ¨:** Ø§Ø´Ø±Ø¨ 3-4 Ù„ØªØ± Ù…Ù† Ø§Ù„Ù…Ø§Ø¡ ÙŠÙˆÙ…ÙŠØ§Ù‹.
    * **Ø§Ù„Ù†ÙˆÙ…:** Ø§Ø­Ø±Øµ Ø¹Ù„Ù‰ Ø§Ù„Ù†ÙˆÙ… 7-8 Ø³Ø§Ø¹Ø§Øª ÙŠÙˆÙ…ÙŠØ§Ù‹ Ù„Ø¶Ù…Ø§Ù† ØªØ¹Ø§ÙÙŠ Ø§Ù„Ø¬Ø³Ù… Ø¨Ø´ÙƒÙ„ ÙƒØ§Ù…Ù„.
    * **Ø¥Ø´Ø§Ø±Ø§Øª Ø§Ù„Ø¬Ø³Ù…:** Ø§Ù†ØªØ¨Ù‡ Ù„Ø£ÙŠ Ø£Ù„Ù… Ø­Ø§Ø¯ Ø£Ùˆ Ø´Ø¹ÙˆØ± Ø¨Ø§Ù„Ø¥Ø±Ù‡Ø§Ù‚. Ù„Ùˆ Ø´Ø¹Ø±Øª Ø¨Ø£ÙŠ Ø´ÙŠØ¡ ØºÙŠØ± Ø·Ø¨ÙŠØ¹ÙŠØŒ Ø®Ø° ÙŠÙˆÙ… Ø±Ø§Ø­Ø© Ø¥Ø¶Ø§ÙÙŠ.

    ---
    **Ø£ØªÙ…Ù†Ù‰ Ù„Ùƒ Ø±Ø­Ù„Ø© Ù…ÙˆÙÙ‚Ø© ÙŠØ§ ${data.name}! Ø£Ù†Ø§ Ù‡Ù†Ø§ ÙÙŠ Ø£ÙŠ ÙˆÙ‚Øª Ù„Ùˆ Ø§Ø­ØªØ¬Øª Ø£ÙŠ Ù…Ø³Ø§Ø¹Ø¯Ø©.**

    **Ø§Ù„Ù…Ø¯Ø±Ø¨ Ù…ØµØ·ÙÙ‰ Ø§Ù„ØµØ§ÙÙŠ**
    `;
    }
    
    // Event listeners
    startBtn.addEventListener('click', () => {
      welcomeScreen.classList.add('hidden');
      userDataScreen.classList.remove('hidden');
      setLang(localStorage.getItem('lang') || 'ar');
    });

    nextBtn.addEventListener('click', () => {
      const name = userNameInput.value.trim();
      const age = userAgeInput.value.trim();
      const country = userCountryInput.value.trim();
      
      if (!name || !age || !country) {
        showToast(i18n[LANG].emptyFields);
        return;
      }
      
      userState.data.name = name;
      userState.data.age = age;
      userState.data.country = country;
      
      userDataScreen.classList.add('hidden');
      chatContainer.classList.remove('hidden');
      
      const firstPrompt = i18n[LANG].prompts[0].replace('{name}', userState.data.name);
      displayMessage(firstPrompt, 'ai');
      userState.step = 1;
    });
    
    // Attach other listeners after the main UI is loaded
    window.addEventListener('load', () => {
      sendBtn.addEventListener('click', () => {
        const message = userInput.value.trim();
        if (message) {
            displayMessage(message, 'user');
            sendPromptToAI(message);
            userInput.value = '';
        }
      });
      userInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            sendBtn.click();
        }
      });
      plusBtn.addEventListener('click', () => {
          const fileInput = document.createElement('input');
          fileInput.type = 'file';
          fileInput.multiple = true;
          fileInput.classList.add('hidden');
          fileInput.addEventListener('change', (e) => {
              const files = e.target.files;
              if (files.length > 0) {
                  // This is where you'd handle file upload
                  displayMessage(i18n[LANG].imageUpload, 'ai');
              }
          });
          document.body.appendChild(fileInput);
          fileInput.click();
      });
      
      btnAr.addEventListener('click', () => setLang('ar'));
      btnEn.addEventListener('click', () => setLang('en'));
      btnTheme.addEventListener('click', setTheme);
      if(generatePlanBtn) {
          generatePlanBtn.addEventListener('click', () => {
              const fullPrompt = `You are Coach Mustafa Elsafy, a top-level health coach, nutritionist, and doctor. User's profile: Name: ${userState.data.name}, Age: ${userState.data.age}, Country: ${userState.data.country}. User's goals: ${userState.data.goals}. User's lifestyle: Work activity: ${userState.data.workActivity}, Daily steps: ${userState.data.dailySteps}. Health and constraints: Allergies: ${userState.data.allergies}, Medical conditions: ${userState.data.injuries}. Task: Generate a complete health plan for the user, acting as a coach, nutritionist, and doctor. The plan should be presented in a friendly, conversational tone and include a detailed meal plan, workout routine, and medical safety advice. The response must be in Markdown.`;
              sendPromptToAI(fullPrompt);
          });
      }
      
      const savedLang = localStorage.getItem('lang') || 'ar';
      setLang(savedLang);
      
      const savedTheme = localStorage.getItem('theme') || 'light';
      if (savedTheme === 'dark') {
        document.body.classList.add('dark');
        btnTheme.textContent = 'ğŸŒ™';
      }
    });
  </script>
</body>
</html>
