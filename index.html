<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Ù…Ø¯Ø±Ø¨Ùƒ Ø§Ù„Ø´Ø®ØµÙŠ Ø§Ù„Ø°ÙƒÙŠ | Smart Personal Coach</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap');

    :root{
      --primary:#04364A; --secondary:#176B87; --accent:#64CCC5;
      --chat-bg:#F5F7FA; --bubble-user:#E8F7D4; --bubble-ai:#FFFFFF;
      --backdrop:rgba(2,6,23,.55);
      --text:#0B1220; --muted:#64748B;
      --surface:#FFFFFF; --border:#E5E7EB
    }
    html.dark{
      --primary:#0f172a; --secondary:#334155; --accent:#10B981;
      --chat-bg:#0B1220; --bubble-user:#394150; --bubble-ai:#111827;
      --backdrop:rgba(0,0,0,.7); --text:#E5E7EB; --muted:#94A3B8;
      --surface:#0f172a; --border:#334155
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:'Tajawal',sans-serif;background:var(--chat-bg);color:var(--text);transition:background-color .3s,color .3s}

    /* Shell / App look */
    .chat-container{max-width:780px;margin:0 auto;height:100vh;display:flex;flex-direction:column;background:var(--chat-bg);box-shadow:0 0 25px rgba(0,0,0,.08);border-radius:1rem;overflow:hidden}
    @supports (height: 100dvh){ .chat-container{height:100dvh} }
    @media (max-width:768px){ .chat-container{border-radius:0;box-shadow:none} }

    .chat-header{background:linear-gradient(135deg,var(--primary),var(--secondary));color:#fff;padding:.875rem 1rem;position:sticky;top:0;z-index:10;display:flex;justify-content:space-between;align-items:center}
    .brand{display:flex;align-items:center;gap:.6rem}
    .brand img{width:40px;height:40px;border-radius:999px;object-fit:cover}

    .chat-messages{flex:1;padding:1rem;overflow-y:auto;-webkit-overflow-scrolling:touch;padding-bottom:6rem}
    .message-bubble{padding:.85rem 1.15rem;border-radius:1.25rem;max-width:85%;margin-bottom:.75rem;animation:fadeIn .25s ease-in-out;position:relative}
    .message-bubble.user{background:var(--bubble-user);margin-left:auto;border-bottom-right-radius:.25rem;color:#0B1220}
    .message-bubble.ai{background:var(--bubble-ai);margin-right:auto;border-bottom-left-radius:.25rem;color:var(--text)}

    .msg-meta{display:flex;gap:.35rem;opacity:0;transition:.2s;position:absolute;bottom:.35rem;inset-inline-end:.6rem}
    .message-bubble:hover .msg-meta{opacity:.95}
    .meta-btn{background:transparent;border:none;font-size:.85rem;cursor:pointer;color:#64748B;padding:.15rem .35rem;border-radius:.35rem}
    .meta-btn:hover{color:#0ea5e9;background:rgba(0,0,0,.05)}

    .input-area{display:flex;gap:.5rem;padding:.75rem;background:color-mix(in srgb,var(--surface) 92%, transparent);border-top:1px solid var(--border);position:sticky;bottom:0;z-index:10;align-items:center;backdrop-filter:saturate(160%) blur(6px);padding-bottom:calc(.75rem + env(safe-area-inset-bottom))}
    .input-area input[type=text]{flex:1;border-radius:999px;padding:.78rem 1.1rem;border:1px solid var(--border);background:#fff;color:#0B1220}
    html.dark .input-area input[type=text]{background:#0f172a;color:#E5E7EB}
    .input-area input[type=text]::placeholder{color:var(--muted)}
    .input-area input[type=text]:focus{outline:none;border-color:var(--accent)}
    .icon-btn{background:transparent;color:#0ea5e9;border-radius:999px;width:44px;height:44px;display:grid;place-items:center;transition:.25s}
    .icon-btn:hover{background:rgba(0,0,0,.06)}
    .send-btn{background:var(--accent);color:#fff;border-radius:999px}
    html[dir="rtl"] .input-area{flex-direction:row-reverse}
    html[dir="rtl"] #userInput{text-align:right}
    html[dir="ltr"] #userInput{text-align:left}

    .welcome-screen,.user-data-screen{display:flex;flex-direction:column;justify-content:center;align-items:center;height:100vh;text-align:center;background:linear-gradient(135deg,var(--primary),var(--secondary));color:#fff}
    .cta-btn{background:var(--accent);font-weight:700;box-shadow:0 6px 16px rgba(0,0,0,.25);padding:1rem 2rem;border-radius:999px}

    .toast{position:fixed;bottom:1.2rem;left:50%;transform:translateX(-50%);background:#111827;color:#fff;padding:.7rem 1rem;border-radius:.6rem;z-index:60;opacity:0;transition:.35s}

    @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

    .typing{display:inline-flex;gap:6px;align-items:center}
    .dot{width:6px;height:6px;border-radius:999px;background:#9CA3AF;animation:blink 1.2s infinite}
    .dot:nth-child(2){animation-delay:.2s}.dot:nth-child(3){animation-delay:.4s}
    @keyframes blink{0%,80%,100%{opacity:.2}40%{opacity:1}}

    .mic-btn{position:relative}
    .mic-live::after{content:'';position:absolute;inset:-2px;border:2px solid #ef4444;border-radius:999px;animation:pulse 1s infinite}
    @keyframes pulse{0%{transform:scale(.95);opacity:.9}70%{transform:scale(1.05);opacity:.2}100%{transform:scale(.95);opacity:.9}}
    .rec-hint{font-size:.8rem;color:#ef4444;margin-inline-end:.35rem}

    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:var(--backdrop);z-index:50}
    .modal.open{display:flex}
    .modal-content{width:min(560px,96vw);max-height:86vh;overflow:hidden;background:#fff;border-radius:1rem;box-shadow:0 20px 60px rgba(0,0,0,.25);display:flex;flex-direction:column}
    html.dark .modal-content{background:#0f172a;color:#E5E7EB}
    .modal-header{display:flex;justify-content:space-between;align-items:center;padding:.85rem 1rem;border-bottom:1px solid var(--border);background:linear-gradient(135deg,var(--primary),var(--secondary));color:#fff}
    .modal-body{padding:1rem}
    .close-button{background:transparent;color:#fff;font-size:1.75rem;line-height:1;padding:0 .25rem}
    .contact-actions{display:grid;grid-template-columns:1fr;gap:.8rem}
    @media (min-width:520px){.contact-actions{grid-template-columns:1fr 1fr}}
    .contact-btn{display:flex;align-items:center;gap:.75rem;padding:1rem;border-radius:.9rem;font-weight:800;justify-content:center}
    .contact-btn svg{width:22px;height:22px}
    .contact-whatsapp{background:#25D366;color:#fff}
    .contact-phone{background:#0ea5e9;color:#fff}

    .footer{text-align:center;padding:.75rem;font-size:.9rem;color:var(--muted);padding-bottom:calc(.75rem + env(safe-area-inset-bottom))}

    .reply-bar{display:none;align-items:center;gap:.5rem;padding:.5rem .75rem;border:1px dashed var(--border);border-radius:.6rem;margin:.25rem .75rem 0}
    .reply-bar.show{display:flex}
    .reply-bar .x{margin-inline-start:auto;background:transparent;border:none;font-size:1.1rem}

    /* CTA card */
    .card-cta{display:flex;align-items:center;gap:.75rem}
    .badge{font-size:.75rem;padding:.2rem .5rem;border-radius:.5rem;background:color-mix(in srgb,var(--accent) 18%, white)}
    @media (max-width:420px){.brand span{display:none}}
  </style>
</head>
<body class="flex flex-col h-screen overflow-hidden">

  <!-- Welcome -->
  <div class="welcome-screen" id="welcomeScreen">
    <img id="welcomeAvatar" src="https://images.unsplash.com/photo-1605296867304-46d5465a13f1?auto=format&fit=crop&w=200&q=60" alt="Coach Avatar" class="rounded-full mb-6 shadow-xl object-cover"/>
    <h1 class="text-4xl font-bold mb-2" id="welcomeTitle">Ù…Ø¯Ø±Ø¨Ùƒ Ø§Ù„Ø´Ø®ØµÙŠ Ø§Ù„Ø°ÙƒÙŠ</h1>
    <p class="text-xl font-light text-white/90 mb-6" id="welcomeSubtitle">Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØºÙŠÙŠØ±ØŸ Ø®Ø·ØªÙƒ Ù…ØµÙ…Ù…Ø© Ø®ØµÙŠØµÙ‹Ø§ Ù„Ùƒ â€” ØªÙ†ÙÙŠØ° Ù…Ø­ÙƒÙ…ØŒ Ù…ØªØ§Ø¨Ø¹Ø© Ø¯Ù‚ÙŠÙ‚Ø©ØŒ ÙˆÙ†ØªÙŠØ¬Ø© Ù…Ù„Ù…ÙˆØ³Ø©.</p>
    <button id="startBtn" class="cta-btn">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù†</button>
  </div>

  <!-- Profile -->
  <div class="user-data-screen hidden" id="userDataScreen">
    <div class="w-full max-w-sm p-8 space-y-6 bg-white/10 backdrop-blur-md rounded-2xl shadow-xl border border-white/20">
      <div class="text-center">
        <h2 class="text-3xl font-extrabold" id="userDataTitle">Ù„Ù†Ø¨Ù†ÙŠ Ù…Ù„ÙÙƒ Ø§Ù„Ø³Ø±ÙŠØ¹</h2>
        <p class="text-white/80 mt-2" id="userDataSubtitle">Ù†Ø­ØªØ§Ø¬ Ø¨Ø¹Ø¶ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù„Ù„Ø¨Ø¯Ø¡</p>
      </div>
      <div class="space-y-4">
        <!-- Name Input with Icon -->
        <div class="relative flex items-center">
          <span class="absolute inset-y-0 flex items-center pointer-events-none" style="inset-inline-start: 1rem;">
            <svg class="w-5 h-5 text-white/60" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.5a5.5 5.5 0 0 1 5.5 5.5c0 1.57-.67 3-1.75 3.98-1.25.9-2.88 1.32-4.25.26-.7-.54-1.12-1.39-1.12-2.31 0-1.63 1.3-2.95 2.92-2.95.42 0 .81.09 1.18.25a3.47 3.47 0 0 0-3.5-3.5c-1.93 0-3.5 1.57-3.5 3.5 0 .92.35 1.77 1.12 2.31-1.37 1.06-3 .64-4.25-.26C2.17 11 1.5 9.57 1.5 8a5.5 5.5 0 0 1 5.5-5.5C8.83 2.5 10.37 3.4 12 2.5zm6.53 9.78c-1.2-1.03-2.6-1.55-4.2-1.55-1.93 0-3.6.86-4.83 2.22-.6.67-1.13 1.4-1.57 2.18-.5.9-.9 1.87-1.15 2.87-.21.84-.3 1.7-.27 2.55.03.88.2 1.75.47 2.6.27.8.64 1.55 1.1 2.25.5.75 1.1 1.44 1.8 2.02.8.63 1.7.97 2.7.97s1.9-.34 2.7-.97c.7-.58 1.3-1.27 1.8-2.02.46-.7.83-1.45 1.1-2.25.27-.85.44-1.72.47-2.6.03-.85-.06-1.71-.27-2.55-.25-1-.65-1.97-1.15-2.87-.44-.78-.97-1.51-1.57-2.18z"/></svg>
          </span>
          <input type="text" id="userName" class="block w-full rounded-full py-3 bg-white/10 border-2 border-transparent text-white placeholder-white/70 focus:bg-white/20 focus:border-accent focus:ring-0 outline-none transition" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§" dir="auto" style="padding-inline-start: 3.25rem; padding-inline-end: 1.25rem;">
        </div>

        <!-- Age Input with Icon -->
        <div class="relative flex items-center">
          <span class="absolute inset-y-0 flex items-center pointer-events-none" style="inset-inline-start: 1rem;">
            <svg class="w-5 h-5 text-white/60" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 4c-4.41 0-8 3.59-8 8s3.59 8 8 8 8-3.59 8-8-3.59-8-8-8zm0 14c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6zm-1-8h2v5h-2zm0-2h2v2h-2z"/></svg>
          </span>
          <input type="text" inputmode="numeric" id="userAge" class="block w-full rounded-full py-3 bg-white/10 border-2 border-transparent text-white placeholder-white/70 focus:bg-white/20 focus:border-accent focus:ring-0 outline-none transition" placeholder="Ø¹Ù…Ø±Ùƒ" dir="ltr" style="padding-inline-start: 3.25rem; padding-inline-end: 1.25rem;">
        </div>

        <!-- Country Input with Icon -->
        <div class="relative flex items-center">
          <span class="absolute inset-y-0 flex items-center pointer-events-none" style="inset-inline-start: 1rem;">
            <svg class="w-5 h-5 text-white/60" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1h-2v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg>
          </span>
          <input type="text" id="userCountry" class="block w-full rounded-full py-3 bg-white/10 border-2 border-transparent text-white placeholder-white/70 focus:bg-white/20 focus:border-accent focus:ring-0 outline-none transition" placeholder="Ø¨Ù„Ø¯Ùƒ" dir="auto" style="padding-inline-start: 3.25rem; padding-inline-end: 1.25rem;">
        </div>
      </div>
      <button id="nextBtn" class="cta-btn w-full mt-4 !py-3 !text-lg !font-bold">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</button>
    </div>
  </div>

  <!-- Chat -->
  <div class="chat-container hidden" id="chatContainer">
    <div class="chat-header">
      <div class="brand">
        <img id="chatAvatar" src="https://images.unsplash.com/photo-1605296867304-46d5465a13f1?auto=format&fit=crop&w=80&q=60" alt="Coach Avatar"/>
        <span class="text-xl font-bold" id="chatTitle">Ù…Ø¯Ø±Ø¨Ùƒ Ø§Ù„Ø´Ø®ØµÙŠ Ø§Ù„Ø°ÙƒÙŠ</span>
      </div>
      <div class="flex items-center gap-2">
        <button id="btnLang" class="icon-btn text-white border border-white/30 px-3 w-auto h-9 rounded-md">AR</button>
        <button id="btnTheme" class="icon-btn text-white border border-white/30 w-9 h-9 rounded-md">â˜€ï¸</button>
      </div>
    </div>

    <div class="chat-messages" id="chatMessages" role="region" aria-label="Chat messages" aria-live="polite"></div>

    <!-- CTA: opens contact modal -->
    <div id="planButtonArea" class="px-4 py-3 hidden">
      <div class="rounded-xl bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-700 p-3 card-cta justify-between">
        <div>
          <div id="ctaTitle" class="text-[.98rem] font-bold text-slate-800 dark:text-slate-100">Ø¬Ø§Ù‡Ø² Ù„Ù†ØªÙŠØ¬Ø© Ù…Ù„Ù…ÙˆØ³Ø©ØŸ</div>
          <div id="ctaSubtitle" class="text-sm text-slate-600 dark:text-slate-300 mt-1">ØªØ³Ù„ÙŠÙ… Ø®Ø·Ø© Ù…ÙØ­ÙƒÙ…Ø© + Ù…ØªØ§Ø¨Ø¹Ø© Ø£Ø³Ø¨ÙˆØ¹ÙŠØ© + Ø¯Ø¹Ù… Ù…Ø¨Ø§Ø´Ø±.</div>
        </div>
        <span id="ctaBadge" class="badge">Ø®ØµÙ… Ø§Ù„ÙŠÙˆÙ…</span>
        <button id="generatePlanBtn" class="btn send-btn font-bold px-4 py-2 rounded-lg" disabled>Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø®Ø·ØªÙƒ Ø§Ù„Ø¢Ù†</button>
      </div>
      <p id="planButtonNote" class="text-gray-700 dark:text-gray-300 text-sm mt-2">Ø¨Ø§Ù„Ø¶ØºØ·ØŒ Ø³ØªÙØªØ­ Ø·Ø±Ù‚ Ø§Ù„ØªÙˆØ§ØµÙ„. Ø¨Ø§Ù‚Ø© Ø§Ù„Ø¨Ø¯Ø¡ ØªØ´Ù…Ù„: ØªÙ‚ÙŠÙŠÙ… Ø¯Ù‚ÙŠÙ‚ØŒ Ø®Ø·Ø© ÙˆØ¬Ø¨Ø§Øª ÙˆØªÙ…Ø±ÙŠÙ†ØŒ Ù…ØªØ§Ø¨Ø¹Ø© Ø£ÙˆÙ„ Ø£Ø³Ø¨ÙˆØ¹.</p>
    </div>

    <!-- Reply bar -->
    <div id="replyBar" class="reply-bar" aria-live="polite">
      <strong id="replyBarLabel">Ø±Ø¯ Ø¹Ù„Ù‰:</strong>
      <span id="replySnippet" class="truncate"></span>
      <button id="replyClear" class="x" title="Ø¥Ù„ØºØ§Ø¡">Ã—</button>
    </div>

    <div class="input-area" id="inputArea">
      <input type="text" id="userInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ..." dir="rtl"
             autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" />
      <input type="file" id="imageInput" accept="image/*" class="hidden" />
      <input type="file" id="fileInput" accept=".txt,.csv,application/pdf" class="hidden" />
      <button id="plusBtn" class="icon-btn" aria-label="Ø£Ø±Ø³Ù„ ØµÙˆØ±Ø©/Ù…Ù„Ù" title="ØµÙˆØ±Ø©/Ù…Ù„Ù">
        <svg class="w-6 h-6 -rotate-45" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path></svg>
      </button>
      <button id="micBtn" class="icon-btn mic-btn" aria-label="ØªØ³Ø¬ÙŠÙ„ ØµÙˆØªÙŠ" title="Ø§Ø¶ØºØ· Ù…Ø·ÙˆÙ„Ø§Ù‹ Ù„Ù„ØªØ³Ø¬ÙŠÙ„">
        <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line></svg>
      </button>
      <button id="sendBtn" class="icon-btn send-btn" aria-label="Ø£Ø±Ø³Ù„" title="Ø¥Ø±Ø³Ø§Ù„">
        <svg class="w-5 h-5 pl-1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path></svg>
      </button>
    </div>
    <div class="px-4 pb-2 -mt-2 hidden" id="recHintWrap"><span class="rec-hint" id="recHint">â— Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„â€¦ Ø§Ø±ÙØ¹ Ø¥ØµØ¨Ø¹Ùƒ Ù„Ù„Ù†Ø³Ø® Ø¥Ù„Ù‰ Ø®Ø§Ù†Ø© Ø§Ù„ÙƒØªØ§Ø¨Ø©</span></div>
  </div>

  <!-- Contact Modal -->
  <div id="contactModal" class="modal" aria-modal="true" aria-hidden="true" role="dialog" aria-labelledby="contactModalTitle">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="contactModalTitle" class="text-lg font-extrabold">Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø®Ø·ØªÙƒ Ø§Ù„Ø¢Ù† Ø¨Ø¶ØºØ·Ø© Ø²Ø±</h3>
        <button id="closeContactBtn" class="close-button" title="Ø¥ØºÙ„Ø§Ù‚" aria-label="Ø¥ØºÙ„Ø§Ù‚">Ã—</button>
      </div>
      <div class="modal-body">
        <p id="contactModalText1" class="mb-3 text-sm text-gray-600 dark:text-gray-300">Ø§Ø®ØªØ± Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù…Ø¹ Ø§Ù„Ù…Ø¯Ø±Ø¨.
          <span id="contactModalText2" class="block mt-2 text-[12px] text-gray-500">ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± ÙÙŠ Ø§Ù„Ø­Ø¯ÙŠØ« Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù„Ø¯ÙŠÙƒ Ø£Ø³Ø¦Ù„Ø©.</span>
        </p>
        <div class="contact-actions">
          <a class="contact-btn contact-whatsapp" href="https://wa.me/971502061209" target="_blank" rel="noopener" title="ÙˆØ§ØªØ³Ø§Ø¨ Ù…Ø¨Ø§Ø´Ø±">
            <svg viewBox="0 0 32 32" fill="currentColor" aria-hidden="true"><path d="M19.11 17.18c-.28-.14-1.65-.81-1.9-.9-.26-.1-.44-.14-.62.14-.18.27-.71.9-.87 1.09-.16.18-.32.2-.6.07-.28-.14-1.18-.44-2.25-1.4-.83-.74-1.39-1.66-1.55-1.94-.16-.27-.02-.42.12-.56.12-.12.28-.3.42-.46.14-.16.18-.27.28-.46.1-.18.06-.34-.02-.48-.08-.14-.62-1.5-.84-2.06-.22-.52-.44-.45-.62-.46h-.54c-.18 0-.48.07-.74.34-.26.27-1 1-1 2.42s1.03 2.8 1.18 2.99c.14.2 2.03 3.1 4.93 4.33.69.3 1.22.48 1.64.62.69.22 1.32.19 1.82.12.56-.08 1.65-.68 1.88-1.35.24-.67.24-1.24.16-1.35-.06-.1-.24-.16-.52-.3z"/><path d="M26.9 5.1A13.9 13.9 0 0 0 16 .1C7.3.1.2 7.1.2 15.8c0 2.7.7 5.2 2 7.4L.1 31.9l8.9-2.3c2.1 1.1 4.5 1.7 7 1.7h.1c8.7 0 15.8-7 15.8-15.7 0-4.2-1.6-8.1-4.9-10.9z"/></svg>
            <span id="whatsappBtnText">ÙˆØ§ØªØ³Ø§Ø¨ Ù…Ø¨Ø§Ø´Ø±</span>
          </a>
          <a class="contact-btn contact-phone" href="tel:+971502061209" title="Ø§ØªØµØ§Ù„ Ù‡Ø§ØªÙÙŠ">
            <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M6.62 10.79a15.05 15.05 0 0 0 6.59 6.59l2.2-2.2a1 1 0 0 1 1.01-.24c1.11.37 2.3.57 3.58.57a1 1 0 0 1 1 1V21a1 1 0 0 1-1 1C10.61 22 2 13.39 2 3a1 1 0 0 1 1-1h3.5a1 1 0 0 1 1 1c0 1.27.2 2.47.57 3.58a1 1 0 0 1-.24 1.01l-2.21 2.2z"/></svg>
            <span id="phoneBtnText">Ø§ØªØµØ§Ù„ Ù‡Ø§ØªÙÙŠ</span>
          </a>
        </div>
      </div>
    </div>
  </div>

  <footer class="footer" id="pageFooter">Â© Powered by Mustafa Elsafy | Ù…ØµØ·ÙÙ‰ Ø§Ù„ØµØ§ÙÙŠ</footer>

  <script type="module">
    /* =========================
       Elements
    ========================= */
    const $ = id => document.getElementById(id);
    const chatMessages = $('chatMessages');
    const userInput = $('userInput');
    const sendBtn = $('sendBtn');
    const startBtn = $('startBtn');
    const nextBtn = $('nextBtn');
    const welcomeScreen = $('welcomeScreen');
    const userDataScreen = $('userDataScreen');
    const chatContainer = $('chatContainer');
    const userNameInput = $('userName');
    const userAgeInput = $('userAge');
    const userCountryInput = $('userCountry');
    const btnTheme = $('btnTheme');
    const btnLang = $('btnLang');
    const plusBtn = $('plusBtn');
    const imageInput = $('imageInput');
    const fileInput = $('fileInput');
    const micBtn = $('micBtn');
    const recHintWrap = $('recHintWrap');
    const planButtonArea = $('planButtonArea');
    const generatePlanBtn = $('generatePlanBtn');
    const contactModal = $('contactModal');
    const closeContactBtn = $('closeContactBtn');
    const replyBar = $('replyBar');
    const replySnippet = $('replySnippet');
    const replyClear = $('replyClear');

    /* =========================
       State
    ========================= */
    let userState = { step: 0, data: {}, persona:'neutral' };
    let LANG = 'ar';
    let chatHistory = [];
    const MAX_TURNS = 12;
    const MAX_PROMPT_CHARS = 14000;

    /* =========================
       i18n
    ========================= */
    const i18n = {
      ar: {
        appName: 'Ù…Ø¯Ø±Ø¨Ùƒ Ø§Ù„Ø´Ø®ØµÙŠ Ø§Ù„Ø°ÙƒÙŠ',
        welcomeSubtitle: 'Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØºÙŠÙŠØ±ØŸ Ø®Ø·ØªÙƒ Ù…ØµÙ…Ù…Ø© Ø®ØµÙŠØµÙ‹Ø§ Ù„Ùƒ â€” ØªÙ†ÙÙŠØ° Ù…Ø­ÙƒÙ…ØŒ Ù…ØªØ§Ø¨Ø¹Ø© Ø¯Ù‚ÙŠÙ‚Ø©ØŒ ÙˆÙ†ØªÙŠØ¬Ø© Ù…Ù„Ù…ÙˆØ³Ø©.',
        startButtonText: 'Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù†',
        userDataTitle: 'Ù„Ù†Ø¨Ù†ÙŠ Ù…Ù„ÙÙƒ Ø§Ù„Ø³Ø±ÙŠØ¹',
        userDataSubtitle: 'Ø§Ø³Ù…Ùƒ ÙˆØ¹ÙÙ…Ø±Ùƒ ÙˆØ¯ÙˆÙ„ØªÙƒ ÙƒØ¨Ø¯Ø§ÙŠØ©',
        namePlaceholder:'Ø§Ø³Ù…Ùƒ', agePlaceholder:'Ø¹Ù…Ø±Ùƒ', countryPlaceholder:'Ø¯ÙˆÙ„ØªÙƒ', nextButtonText:'Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©',
        inputPlaceholder:'Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ...', emptyFields:'Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø¹Ù…Ø± ÙˆØ§Ù„Ø¯ÙˆÙ„Ø© Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©.', imageUpload:'ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„ØµÙˆØ±Ø© â€” ÙŠØªÙ… Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¢Ù†.',
        typing:'â€¦ ÙŠØªÙ… Ø§Ù„Ø±Ø¯ Ø§Ù„Ø¢Ù†',
        recStart:'â— Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„â€¦ Ø§Ø±ÙØ¹ Ø¥ØµØ¨Ø¹Ùƒ Ù„Ù„Ù†Ø³Ø®', recDenied:'ØªØ¹Ø°Ù‘Ø± Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙˆÙ†.', recTooShort:'Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù‚ØµÙŠØ± Ø¬Ø¯Ù‹Ø§.', recSaved:'ØªÙ… Ù†Ø³Ø® Ø§Ù„ÙƒÙ„Ø§Ù… Ø¥Ù„Ù‰ Ø®Ø§Ù†Ø© Ø§Ù„ÙƒØªØ§Ø¨Ø© â€” Ø£Ø±Ø³Ù„Ù‡ ÙŠØ¯ÙˆÙŠÙ‹Ø§.',
        ctaTitle: 'Ø¬Ø§Ù‡Ø² Ù„Ù†ØªÙŠØ¬Ø© Ù…Ù„Ù…ÙˆØ³Ø©ØŸ',
        ctaSubtitle: 'ØªØ³Ù„ÙŠÙ… Ø®Ø·Ø© Ù…ÙØ­ÙƒÙ…Ø© + Ù…ØªØ§Ø¨Ø¹Ø© Ø£Ø³Ø¨ÙˆØ¹ÙŠØ© + Ø¯Ø¹Ù… Ù…Ø¨Ø§Ø´Ø±.',
        ctaBadge: 'Ø®ØµÙ… Ø§Ù„ÙŠÙˆÙ…',
        getPlanButton: 'Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø®Ø·ØªÙƒ Ø§Ù„Ø¢Ù†',
        planButtonNote: 'Ø¨Ø§Ù„Ø¶ØºØ·ØŒ Ø³ØªÙØªØ­ Ø·Ø±Ù‚ Ø§Ù„ØªÙˆØ§ØµÙ„. Ø¨Ø§Ù‚Ø© Ø§Ù„Ø¨Ø¯Ø¡ ØªØ´Ù…Ù„: ØªÙ‚ÙŠÙŠÙ… Ø¯Ù‚ÙŠÙ‚ØŒ Ø®Ø·Ø© ÙˆØ¬Ø¨Ø§Øª ÙˆØªÙ…Ø±ÙŠÙ†ØŒ Ù…ØªØ§Ø¨Ø¹Ø© Ø£ÙˆÙ„ Ø£Ø³Ø¨ÙˆØ¹.',
        contactModalTitle: 'Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ø®Ø·ØªÙƒ Ø§Ù„Ø¢Ù† Ø¨Ø¶ØºØ·Ø© Ø²Ø±',
        contactModalText1: 'Ø§Ø®ØªØ± Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù…Ø¹ Ø§Ù„Ù…Ø¯Ø±Ø¨.',
        contactModalText2: 'ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± ÙÙŠ Ø§Ù„Ø­Ø¯ÙŠØ« Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù„Ø¯ÙŠÙƒ Ø£Ø³Ø¦Ù„Ø©.',
        whatsappBtnText: 'ÙˆØ§ØªØ³Ø§Ø¨ Ù…Ø¨Ø§Ø´Ø±',
        phoneBtnText: 'Ø§ØªØµØ§Ù„ Ù‡Ø§ØªÙÙŠ',
        replyBarLabel: 'Ø±Ø¯ Ø¹Ù„Ù‰:',
        footerText: 'Â© Powered by Mustafa Elsafy | Ù…ØµØ·ÙÙ‰ Ø§Ù„ØµØ§ÙÙŠ',
        messageToolsLabel: 'Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø±Ø³Ø§Ù„Ø©',
        copyBtnText: 'Ù†Ø³Ø®',
        replyBtnText: 'Ø±Ø¯',
        copyBtnTitle: 'Ù†Ø³Ø® Ø§Ù„Ø±Ø³Ø§Ù„Ø©',
        replyBtnTitle: 'Ø±Ø¯',
        cancelReplyTitle: 'Ø¥Ù„ØºØ§Ø¡',
        attachFileTitle: 'ØµÙˆØ±Ø©/Ù…Ù„Ù',
        recordAudioTitle: 'Ø§Ø¶ØºØ· Ù…Ø·ÙˆÙ„Ø§Ù‹ Ù„Ù„ØªØ³Ø¬ÙŠÙ„',
        sendTitle: 'Ø¥Ø±Ø³Ø§Ù„',
        closeModalTitle: 'Ø¥ØºÙ„Ø§Ù‚'
      },
      en: {
        appName:'Smart Personal Coach',
        welcomeSubtitle:'Ready for a change? Your plan is tailored for youâ€”precise execution, close follow-up, and tangible results.',
        startButtonText:'Start Now',
        userDataTitle:"Let's create your quick profile",
        userDataSubtitle:'We need some info to start',
        namePlaceholder:'Your Name', agePlaceholder:'Your Age', countryPlaceholder:'Your Country', nextButtonText:'Start Conversation',
        inputPlaceholder:'Type your messageâ€¦', emptyFields:'Please enter your name, age, and country to continue.', imageUpload:'Image received â€” analyzing now.',
        typing:'â€¦ typing now',
        recStart:'â— Recordingâ€¦ release to copy', recDenied:'Microphone access denied.', recTooShort:'Recording is too short.', recSaved:'Text copied to input â€” send manually.',
        ctaTitle: 'Ready for tangible results?',
        ctaSubtitle: 'Precise plan + weekly follow-up + direct support.',
        ctaBadge: "Today's Offer",
        getPlanButton: 'Get Your Plan Now',
        planButtonNote: 'By clicking, contact options will open. The starter package includes: detailed assessment, meal & workout plan, and first week follow-up.',
        contactModalTitle: 'Get your plan now with one click',
        contactModalText1: 'Choose the best way to contact the coach directly.',
        contactModalText2: 'You can continue chatting if you have questions.',
        whatsappBtnText: 'Direct WhatsApp',
        phoneBtnText: 'Phone Call',
        replyBarLabel: 'Reply to:',
        footerText: 'Â© Powered by Mustafa Elsafy',
        messageToolsLabel: 'Message Tools',
        copyBtnText: 'Copy',
        replyBtnText: 'Reply',
        copyBtnTitle: 'Copy Message',
        replyBtnTitle: 'Reply',
        cancelReplyTitle: 'Cancel',
        attachFileTitle: 'Image/File',
        recordAudioTitle: 'Press and hold to record',
        sendTitle: 'Send',
        closeModalTitle: 'Close'
      }
    };

    function setLang(lang){
      LANG = lang;
      document.documentElement.lang = lang;
      document.documentElement.dir = lang==='ar'?'rtl':'ltr';
      const L = i18n[LANG];
      
      // Welcome Screen
      $('welcomeTitle').textContent = L.appName;
      $('welcomeSubtitle').textContent = L.welcomeSubtitle;
      $('startBtn').textContent = L.startButtonText;
      
      // User Data Screen
      $('userDataTitle').textContent = L.userDataTitle;
      $('userDataSubtitle').textContent = L.userDataSubtitle;
      $('userName').placeholder = L.namePlaceholder;
      $('userAge').placeholder = L.agePlaceholder;
      $('userCountry').placeholder = L.countryPlaceholder;
      $('nextBtn').textContent = L.nextButtonText;
      
      // Chat Screen
      $('chatTitle').textContent = L.appName;
      $('userInput').placeholder = L.inputPlaceholder;
      $('ctaTitle').textContent = L.ctaTitle;
      $('ctaSubtitle').textContent = L.ctaSubtitle;
      $('ctaBadge').textContent = L.ctaBadge;
      $('generatePlanBtn').textContent = L.getPlanButton;
      $('planButtonNote').textContent = L.planButtonNote;
      $('replyBarLabel').textContent = L.replyBarLabel;
      $('replyClear').title = L.cancelReplyTitle;

      // Input area tooltips
      $('plusBtn').title = L.attachFileTitle;
      $('micBtn').title = L.recordAudioTitle;
      $('sendBtn').title = L.sendTitle;
      
      // Contact Modal
      $('contactModalTitle').textContent = L.contactModalTitle;
      $('closeContactBtn').title = L.closeModalTitle;
      $('closeContactBtn').setAttribute('aria-label', L.closeModalTitle);
      $('contactModalText1').firstChild.nodeValue = L.contactModalText1 + ' ';
      $('contactModalText2').textContent = L.contactModalText2;
      $('whatsappBtnText').textContent = L.whatsappBtnText;
      $('phoneBtnText').textContent = L.phoneBtnText;

      // Footer
      $('pageFooter').textContent = L.footerText;

      // Global
      btnLang.textContent = lang==='ar' ? 'EN' : 'AR';
      document.title = `${L.appName} | Smart Personal Coach`;
    }

    /* =========================
       Utilities
    ========================= */
    function setTheme(){
      document.documentElement.classList.toggle('dark');
      btnTheme.textContent = document.documentElement.classList.contains('dark') ? 'ğŸŒ™' : 'â˜€ï¸';
      localStorage.setItem('theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light')
    }
    function toast(msg){
      const t=document.createElement('div'); t.className='toast'; t.textContent=msg;
      document.body.appendChild(t); setTimeout(()=>t.style.opacity=1,10);
      setTimeout(()=>{t.style.opacity=0; setTimeout(()=>t.remove(),400)},2400)
    }

    /* =========================
       Language helper
    ========================= */
    const Lang = {
      isArabic(s){ return /[\u0600-\u06FF]/.test(s) },
      autoSetByText(s){
        if(!s) return;
        const target = this.isArabic(s) ? 'ar' : 'en';
        if(target!==LANG) setLang(target);
      }
    };

    /* =========================
       Storage / History
    ========================= */
    const Storage = {
      KEY: 'smart-coach-history-v1',
      save(){
        // Not implemented as per previous request to remove buttons
      },
      load(){
        // Not implemented as per previous request to remove buttons
        return false;
      },
      clear(){
       // Not implemented as per previous request to remove buttons
      },
      export(){
       // Not implemented as per previous request to remove buttons
      },
      async import(file){
        // Not implemented as per previous request to remove buttons
      }
    };

    function compactHistory(){ if (chatHistory.length > MAX_TURNS) chatHistory = chatHistory.slice(-MAX_TURNS) }

    /* =========================
       Messages UI
    ========================= */
    function displayMessage(message, sender){
      const b=document.createElement('div'); b.classList.add('message-bubble', sender);
      const safe = (message && typeof message === 'string') ? message : 'â€¦';
      const html = marked.parse(safe);
      const L = i18n[LANG];
      
      b.innerHTML = `
        <div class="msg-content">${html}</div>
        <div class="msg-meta" role="group" aria-label="${L.messageToolsLabel}">
          <button class="meta-btn copy" title="${L.copyBtnTitle}">${L.copyBtnText}</button>
          <button class="meta-btn reply" title="${L.replyBtnTitle}">${L.replyBtnText}</button>
        </div>`;
      chatMessages.appendChild(b); chatMessages.scrollTop = chatMessages.scrollHeight;

      // Copy
      b.querySelector('.copy').onclick = async ()=>{
        const txt = b.querySelector('.msg-content').innerText;
        await navigator.clipboard.writeText(txt);
        toast(i18n[LANG].copied);
      };
      // Reply
      b.querySelector('.reply').onclick = ()=>{
        UI.setReply(b.querySelector('.msg-content').innerText.slice(0,160));
      };
      return b;
    }
    function showTyping(sender='ai'){
      const b=document.createElement('div'); b.classList.add('message-bubble', sender);
      b.innerHTML = `<span class="typing"><span>${i18n[LANG].typing}</span><span class="dot"></span><span class="dot"></span><span class="dot"></span></span>`;
      chatMessages.appendChild(b); chatMessages.scrollTop=chatMessages.scrollHeight; return b
    }
    function removeNode(n){ if(n && n.parentNode) n.parentNode.removeChild(n) }

    const UI = {
      setReply(snippet){ replySnippet.textContent = snippet; replyBar.classList.add('show'); userInput.focus(); },
      clearReply(){ replySnippet.textContent = ''; replyBar.classList.remove('show'); }
    };
    replyClear.addEventListener('click', UI.clearReply);

    /* =========================
       i18n injection
    ========================= */
    function togglePlanCTA(){ const ready = isDataComplete(); planButtonArea.classList.toggle('hidden', !ready); generatePlanBtn.disabled = !ready }
    function isDataComplete(){ return ['name','age','country'].every(k => !!userState.data[k]) }

    /* =========================
       Prompts
    ========================= */
    function buildCoachSystemPrompt(){ return `
ğŸ“Œ Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠ Ø§Ù„Ø´Ø§Ù…Ù„ Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠ/Ø§Ù„ØºØ°Ø§Ø¦ÙŠ â€” Ù†Ø³Ø®Ø© Ù…ÙØ­Ø³Ù‘Ù†Ø© Ù„Ø¶Ù…Ø§Ù† Ø³Ù„Ø§Ø³Ø© Ø¨Ø´Ø±ÙŠØ© 100%

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€Ù¡) Ø§Ù„Ù‡ÙˆÙŠØ© ÙˆØ§Ù„Ø¯ÙˆØ±ã€‘
- Ø¥Ù†Øª Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ù…Ø¯Ø±Ù‘Ø¨ Ø§Ù„Ø¯ÙˆÙ„ÙŠ **Ù…ØµØ·ÙÙ‰ Ø§Ù„ØµØ§ÙÙŠ**.
- Ø§Ù„Ø¯ÙˆØ±: Ù…Ø¯Ø±Ù‘Ø¨ Ø´Ø®ØµÙŠ ÙˆØ£Ø®ØµØ§Ø¦ÙŠ ØªØºØ°ÙŠØ© Ù…Ø­ØªØ±ÙØ› ØªÙÙ‡Ù… Ø§Ù„Ø±Ø³Ø§Ù„Ø©ØŒ ØªØ­Ù„Ù„Ù‡Ø§ Ø³Ø±ÙŠØ¹Ù‹Ø§ØŒ ÙˆØªÙ‚Ø¯Ù‘Ù… Ø­Ù„Ù‹Ø§ Ø¹Ù…Ù„ÙŠÙ‹Ø§ Ù…Ø¨Ù†ÙŠÙ‹Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù„Ù….
- ØªØªÙƒÙ„Ù… ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¨Ù†ÙØ³ Ù„ØºØ© ÙˆÙ„Ù‡Ø¬Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ù…Ø±Ø¢Ø© Ù„ØºÙˆÙŠØ©). Ù„Ùˆ Ø§Ù„Ù„Ù‡Ø¬Ø© ØºÙŠØ± ÙˆØ§Ø¶Ø­Ø©ØŒ Ø§Ø³ØªØ®Ø¯Ù… **Ù…ØµØ±ÙŠ Ø¨Ø±ÙˆÙÙŠØ´Ù†Ø§Ù„** ÙˆØ§Ø¶Ø­ ÙˆÙ…Ø­ØªØ±Ù….
- **Ù…Ù…Ù†ÙˆØ¹ Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§** Ø°ÙƒØ± Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¯Ø§Ø®Ù„ Ø§Ù„Ø±Ø¯ÙˆØ¯.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€Ù¢) Ø³Ù„Ø§Ø³Ø© Ø¨Ø´Ø±ÙŠØ© Ø¨Ù„Ø§ Ù„ØºØ© Ø¢Ù„ÙŠØ© (ÙŠÙ†Ø·Ø¨Ù‚ Ø¹Ù„Ù‰ ÙƒÙ„ Ø§Ù„Ø±Ø¯ÙˆØ¯ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„)ã€‘
- Ø§Ù„Ø±Ø¯ÙˆØ¯ ÙŠØ¬Ø¨ Ø£Ù† ØªØ¨Ø¯Ùˆ Ø·Ø¨ÙŠØ¹ÙŠØ© ÙˆÙ…ØªÙ†ÙˆØ¹Ø© ÙƒØ£Ù† Ø¥Ù†Ø³Ø§Ù† Ù…Ø­ØªØ±Ù ÙŠÙƒØªØ¨Ù‡Ø§ØŒ Ø¯ÙˆÙ† Ø£ÙŠ Ø¹Ø¨Ø§Ø±Ø§Øª Ù‚ÙˆØ§Ù„Ø¨ Ø£Ùˆ Ø§ÙØªØªØ§Ø­ÙŠØ§Øª Ù…ÙƒØ±Ø±Ø©.
- **Ù…Ù…Ù†ÙˆØ¹** Ø¨Ø¯Ø¡ Ø£ÙŠ Ø±Ø¯ Ø£Ùˆ Ø£ÙŠ ÙÙ‚Ø±Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„Ø±Ø¯ Ø¨Ù€: (ØªÙ…Ø§Ù…/Ù…Ù…ØªØ§Ø²/Ø·ÙŠØ¨/Ø¹Ø´Ø§Ù† Ù†ÙƒÙ…Ù„/Ø¹Ù„Ø´Ø§Ù† Ø£Ù‚Ø¯Ø± Ø£Ø³Ø§Ø¹Ø¯Ùƒ/Ø®Ù„Ù‘ÙŠÙ†Ø§/Ø£ÙˆÙƒ/Ø£ÙˆÙ„Ù‹Ø§/Ø«Ø§Ù†ÙŠÙ‹Ø§â€¦).
- **Ù…Ù…Ù†ÙˆØ¹** Ø´Ø±Ø­ Ø³Ø¨Ø¨ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø£Ùˆ ØªØ¨Ø±ÙŠØ±Ù‡ (Ù„Ø§ ØªÙ‚Ù„: "Ø¹Ø´Ø§Ù† Ø£Ø¸Ø¨Ø· Ø§Ù„Ø®Ø·Ø©" Ø£Ùˆ "Ø¹Ù„Ø´Ø§Ù† Ø§Ù„Ø¯Ù‚Ø©"). Ø§Ø³Ø£Ù„ Ø§Ù„Ø³Ø¤Ø§Ù„ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ù„Ø§ ØªÙ…Ù‡ÙŠØ¯.
- Ù„Ø§ ØªØ¹ÙŠØ¯ ØµÙŠØ§ØºØ© Ø£Ùˆ ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ø§Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© (Ù„Ø§ ØªÙ‚Ù„: "ÙÙ‡Ù…Øª Ø¥Ù†Ùƒâ€¦"). Ø§Ù†ØªÙ‚Ù„ Ù„Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø£Ùˆ Ù„Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ Ù…Ø¨Ø§Ø´Ø±Ø©.
- Ù†ÙˆÙ‘Ø¹ Ø§Ù„Ø¬ÙÙ…Ù„ ÙˆØ§Ø³ØªØ®Ø¯Ù… ØªØ±Ø§ÙƒÙŠØ¨ Ù…Ø®ØªÙ„ÙØ©Ø› ØªØ¬Ù†Ù‘Ø¨ Ø§Ù„ØªÙƒØ±Ø§Ø± Ø§Ù„Ù„ÙØ¸ÙŠ ÙˆØ£ÙŠ Ù†Ø¨Ø±Ø© Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠØ© ÙÙŠ Ø£ÙŠ Ø¬Ø²Ø¡ Ù…Ù† Ø§Ù„Ø±Ø³Ø§Ù„Ø©.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€Ù£) Ø£Ø³Ù„ÙˆØ¨ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© ÙˆØ§Ù„Ø³Ù„ÙˆÙƒã€‘
- Ø§Ù„ØªØ­ÙŠØ© Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø· ÙÙŠ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø£Ùˆ Ø¹Ù†Ø¯ ØªØ­ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø© Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù….
- **Ø³Ø¤Ø§Ù„ ÙˆØ§Ø­Ø¯ ÙÙ‚Ø·** ÙÙŠ ÙƒÙ„ Ø±Ø³Ø§Ù„Ø© (ÙˆØ³Ø¤Ø§Ù„Ø§Ù† ÙÙ‚Ø· Ù„Ùˆ Ù…Ø±ØªØ¨Ø·ÙŠÙ† Ø¬Ø¯Ù‹Ø§ØŒ Ù…Ø«Ù„ Ø§Ù„Ø·ÙˆÙ„ ÙˆØ§Ù„ÙˆØ²Ù†).
- Ø§Ù„Ø±Ø¯ÙˆØ¯ Ù…Ø±ÙƒÙ‘Ø²Ø©ØŒ Ù…Ø´Ø¬Ù‘Ø¹Ø© Ø¨Ø¯ÙˆÙ† Ù…Ø¨Ø§Ù„ØºØ©ØŒ ÙˆÙ…Ù…ØªØ¹Ø© ØºÙŠØ± Ù…Ù…Ù„Ø©.
- Ù„Ùˆ Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø¯ÙˆÙ† Ù‡Ø¯Ù ÙˆØ§Ø¶Ø­: Ø¹Ø±Ù‘Ù Ù†ÙØ³Ùƒ Ø¨Ø§Ù‚ØªØ¶Ø§Ø¨ ÙƒÙ…Ø³Ø§Ø¹Ø¯ Ù…ØµØ·ÙÙ‰ Ø§Ù„ØµØ§ÙÙŠ Ù„Ù„ØªØ¯Ø±ÙŠØ¨ ÙˆØ§Ù„ØªØºØ°ÙŠØ©ØŒ Ø«Ù… Ø§Ø³Ø£Ù„Ù‡: Â«ØªØ­Ø¨ Ù†Ø¨Ø¯Ø£ Ø¨Ù‡Ø¯ÙÙƒ Ø§Ù„Ø­Ø§Ù„ÙŠ ÙˆÙ„Ø§ Ø¹Ù†Ø¯Ùƒ Ø§Ø³ØªÙØ³Ø§Ø± Ù…Ø¹ÙŠÙ‘Ù†ØŸÂ».

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€Ù¤) Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³ÙŠØ§Ù‚ ÙˆØ§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©ã€‘
- Ø®Ø²Ù‘Ù† Ø¯Ø§Ø®Ù„ÙŠÙ‹Ø§ (ØºÙŠØ± Ù…Ø±Ø¦ÙŠ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…):
  â€¢ Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø­Ø§Ù„ÙŠ (Ø¯Ù‡ÙˆÙ†/Ø¹Ø¶Ù„/Ù„ÙŠØ§Ù‚Ø©/ØµØ­Ø© Ø¹Ø§Ù…Ø©/Ø§Ø³ØªØ´Ø§Ø±Ø© ÙÙ‚Ø·).  
  â€¢ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ§Øª: Ø§Ù„Ø¹Ù…Ø±ØŒ Ø§Ù„Ø¬Ù†Ø³ØŒ Ø§Ù„Ø·ÙˆÙ„ØŒ Ø§Ù„ÙˆØ²Ù†ØŒ Ø§Ù„Ù…Ù†Ø·Ù‚Ø©ØŒ Ø§Ù„Ù†Ø´Ø§Ø·ØŒ Ø§Ù„ØªÙØ¶ÙŠÙ„Ø§Øª/Ø§Ù„Ù…Ù…Ù†ÙˆØ¹Ø§ØªØŒ Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ¬Ø¨Ø§ØªØŒ Ù…ÙƒØ§Ù† Ø§Ù„ØªÙ…Ø±ÙŠÙ†ØŒ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ§Ø­Ø©ØŒ Ø£Ù…Ø±Ø§Ø¶/Ø¥ØµØ§Ø¨Ø§Øª/Ø£Ø¯ÙˆÙŠØ©.  
  â€¢ Ø´Ø®ØµÙŠØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ù…ØªØ­Ù…Ø³/Ù…ØªØ±Ø¯Ø¯/Ù‚Ù„ÙÙ‚/Ù…Ø´ØºÙˆÙ„/Ø­Ø§Ø³Ù…).  
  â€¢ Ø¢Ø®Ø± Ø¥Ø¬Ø§Ø¨Ø§Øª Ù…Ù‡Ù…Ø© + ØªØ­Ø°ÙŠØ±Ø§Øª ØµØ­ÙŠØ©.  
- **Ù…Ø±Ø§Ø¬Ø¹Ø© ØµØ§Ù…ØªØ© Ù‚Ø¨Ù„ ÙƒÙ„ Ø±Ø¯**: Ù„Ø§ ØªÙƒØ±Ø§Ø± Ù„Ø£Ø³Ø¦Ù„Ø© Ù…ÙØ¬Ø§Ø¨ Ø¹Ù†Ù‡Ø§ØŒ ØªÙˆØ§ÙÙ‚ Ù…Ø¹ Ø§Ù„Ù‡Ø¯Ù ÙˆØ§Ù„Ù‚ÙŠÙˆØ¯ØŒ Ø£Ø³Ù„ÙˆØ¨ Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ø´Ø®ØµÙŠØ©ØŒ ÙˆÙ†Ø¨Ø±Ø© Ø¨Ø´Ø±ÙŠØ© Ø³Ù„Ø³Ø© ÙÙŠ ÙƒÙ„ Ø³Ø·Ø±.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€Ù¥) Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ Ø·Ù„Ø¨ Ø®Ø·Ø© (ØªØ¯Ø±ÙŠØ¬ÙŠ Ø¨Ù„Ø§ ØªØ¨Ø±ÙŠØ±)ã€‘
- Ø§Ù„Ù‡Ø¯Ù: Ø¬Ù…Ø¹ **Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ø§Ù„ÙƒØ§ÙÙŠ** Ù„Ø¨Ù†Ø§Ø¡ Ø®Ø·Ø© Ø¯Ù‚ÙŠÙ‚Ø© Ù¡Ù Ù Ùª Ø¨ØµÙˆØ±Ø© ØªØ¯Ø±ÙŠØ¬ÙŠØ© (Ø³Ø¤Ø§Ù„ ÙˆØ§Ø­Ø¯/Ø±Ø³Ø§Ù„Ø©ØŒ Ø£Ùˆ Ø³Ø¤Ø§Ù„Ø§Ù† Ù…Ø±ØªØ¨Ø·Ø§Ù† ÙÙ‚Ø·).
- Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:
  1) Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ.  
  2) Ø§Ù„Ø¬Ù†Ø³ + Ø§Ù„Ø¹Ù…Ø±.  
  3) Ø§Ù„Ø·ÙˆÙ„ + Ø§Ù„ÙˆØ²Ù†.  
  4) Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø­Ø§Ù„ÙŠ + ØªØ§Ø±ÙŠØ® ØªÙ…Ø±ÙŠÙ† Ù…Ø®ØªØµØ±.  
  5) Ù…ÙƒØ§Ù† Ø§Ù„ØªÙ…Ø±ÙŠÙ† (Ø¬ÙŠÙ…/Ù…Ù†Ø²Ù„) + Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ§Ø­Ø©.  
  6) Ø§Ù„ØªÙØ¶ÙŠÙ„Ø§Øª/Ø§Ù„Ù…Ù…Ù†ÙˆØ¹Ø§Øª + Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ¬Ø¨Ø§Øª.  
  7) Ø£Ù…Ø±Ø§Ø¶/Ø¥ØµØ§Ø¨Ø§Øª/Ø£Ø¯ÙˆÙŠØ© (Ø¥Ù† ÙˆØ¬Ø¯Øª).  
- Ø¹Ù†Ø¯ Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰: **Ù‚Ø¯Ù‘Ù… Ø§Ù„Ø®Ø·Ø© ÙƒØ§Ù…Ù„Ø© ÙÙˆØ±Ù‹Ø§** ÙÙŠ Ø±Ø³Ø§Ù„Ø© ÙˆØ§Ø­Ø¯Ø© â€” Ø¨Ø¯ÙˆÙ† Ù…Ø±Ø§Ø­Ù„.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€Ù¦) Ø³ÙŠØ§Ø³Ø© ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø®Ø·Ø© ÙˆØ§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø²Ø¦ÙŠØ©ã€‘
- Ø¨Ø¹Ø¯ Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: Ø±Ø³Ø§Ù„Ø© ÙˆØ§Ø­Ø¯Ø© Ø´Ø§Ù…Ù„Ø© ÙˆÙ…Ù†Ø³Ù‚Ø© Ø¨Ø§Ù„Ø®Ø·Ø© ÙƒØ§Ù…Ù„Ø©.
- Ù„Ùˆ Ù†Ù‚Ø·Ø© ØµØºÙŠØ±Ø© Ù†Ø§Ù‚ØµØ© Ù„Ø§ ØªÙ…Ù†Ø¹ Ø§Ù„Ø¨Ù†Ø§Ø¡: Ø§ÙØªØ±Ø¶ Ø§Ø®ØªÙŠØ§Ø±Ù‹Ø§ Ù…Ù†Ø·Ù‚ÙŠÙ‹Ø§ØŒ Ø§Ø°ÙƒØ± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø®Ø·Ø© ÙˆÙ‚Ø¯Ù‘Ù… Ø¨Ø¯ÙŠÙ„Ù‹Ø§.
- Ù„Ùˆ Ø·Ù„Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø²Ø¡Ù‹Ø§ Ù…Ø­Ø¯Ø¯Ù‹Ø§ (ÙŠÙˆÙ… ØºØ°Ø§Ø¦ÙŠ/ØªÙ…Ø±ÙŠÙ† Ø¹Ø¶Ù„Ø©/Ø³Ù†Ø§Ùƒ/ÙˆØµÙØ©):  
  â€¢ Ø§Ø³Ø£Ù„ Ø¯ÙØ¹Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù† **Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰** Ø§Ù„Ù„Ø§Ø²Ù…ØŒ  
  â€¢ Ø«Ù… Ù‚Ø¯Ù‘Ù… Ø§Ù„Ø·Ù„Ø¨ Ù…Ø¨Ø§Ø´Ø±Ø© ÙÙŠ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€Ù§) Ø§Ù„Ø¯Ù‚Ù‘Ø© Ø§Ù„Ø¹Ù„Ù…ÙŠØ© ÙˆØ§Ù„Ø§Ø­ØªÙŠØ§Ø·Ø§Øªã€‘
- Ø§Ù„ØªØ¯Ø±ÙŠØ¨: Ù‚ÙˆØ©/Hypertrophy/Ù„ÙŠØ§Ù‚Ø©ØŒ ØªØ¯Ø±Ù‘Ø¬ Ø£Ø­Ù…Ø§Ù„ØŒ Ø±Ø§Ø­Ø©ØŒ RPE Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©ØŒ Ø¨Ø¯Ø§Ø¦Ù„ Ø¢Ù…Ù†Ø© Ù„Ù„Ø¥ØµØ§Ø¨Ø§Øª.  
- Ø§Ù„ØªØºØ°ÙŠØ©: Ø³Ø¹Ø±Ø§Øª Ø¯Ù‚ÙŠÙ‚Ø©ØŒ Ù…Ø§ÙƒØ±ÙˆØ² Ù…Ø­Ø³ÙˆØ¨Ø©ØŒ Ù…Ù‚Ø§Ø¯ÙŠØ± Ø¨Ø§Ù„Ø¬Ø±Ø§Ù…/Ù…Ù„/Ù‚Ø·Ø¹ØŒ Ø¨Ø¯Ø§Ø¦Ù„ ÙˆØ§Ù‚Ø¹ÙŠØ©ØŒ ØªÙˆØ²ÙŠØ¹ ÙˆØ¬Ø¨Ø§Øª Ù…Ù†Ø§Ø³Ø¨.  
- Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„ØµØ­ÙŠØ©/Ø§Ù„Ø£Ø¯ÙˆÙŠØ©: ØªØ¹Ø¯ÙŠÙ„ ÙÙˆØ±ÙŠ ÙÙŠ Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ†/Ø§Ù„Ø£Ø·Ø¹Ù…Ø© + Ø¨Ø¯Ø§Ø¦Ù„ Ø¢Ù…Ù†Ø© + ØªØ­Ø°ÙŠØ± Ù…Ø®ØªØµØ±.  
- Ø·Ù„Ø¨ "ØªØ­ÙˆÙ„ Ø¬Ø°Ø±ÙŠ Ø³Ø±ÙŠØ¹": Ø£Ø´ÙØ± Ø¨Ø§Ù‚ØªØ¶Ø§Ø¨ Ø£Ù†Ù‡ Ù‚Ø§Ø³Ù ÙˆÙ‚Ø¯ Ù„Ø§ ÙŠÙ†Ø§Ø³Ø¨ Ø§Ù„Ø¬Ù…ÙŠØ¹Ø› Ù„Ùˆ Ø£ØµØ±Ù‘ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… â†’ Ù‚Ø¯Ù‘Ù… Ø§Ù„Ø®Ø·Ø© Ù…Ø¹ **ØªÙ†Ø¨ÙŠÙ‡ ÙˆØ§Ø¶Ø­ ÙˆØ¥Ø®Ù„Ø§Ø¡ Ù…Ø³Ø¤ÙˆÙ„ÙŠØ©** + Ø¨Ø¯ÙŠÙ„ Ø£Ù‡Ø¯Ø£.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€Ù¨) ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙˆØ³Ø§Ø¦Ø· (Ø¨Ø¯ÙˆÙ† Ø·Ù„Ø¨ Ù…Ø³Ø¨Ù‚)ã€‘
- Ù„Ø§ ØªØ·Ù„Ø¨ ÙˆØ³Ø§Ø¦Ø·Ø› **Ø­Ù„Ù‘Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø£ÙŠ ØµÙˆØ±/Ù…Ù„ÙØ§Øª ØªØµÙ„**.  
- ØµÙˆØ± Ø§Ù„Ø¬Ø³Ù…: Ø¨Ù†ÙŠØ©ØŒ ØªÙˆØ²ÙŠØ¹ Ø¯Ù‡ÙˆÙ†/Ø¹Ø¶Ù„ØŒ Ù…Ù„Ø§Ø­Ø¸Ø§Øª ÙˆØ¶Ø¹ÙŠØ© (Ù…ÙŠÙ„/Ø§Ù†Ø­Ù†Ø§Ø¡/ÙƒØªÙ) ÙˆØªØ£Ø«ÙŠØ±Ù‡Ø§ Ø¹Ù„Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ†.  
- InBody: BF%ØŒ SMMØŒ TBWØŒ BMR â€” Ø§Ø³ØªØ®Ø±Ø¬ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¸Ø§Ù‡Ø±Ø© ÙˆÙ‚Ø¯Ù‘Ù… ØªØ¹Ù„ÙŠÙ‚Ù‹Ø§ Ø¹Ù…Ù„ÙŠÙ‹Ø§.  
- ØµÙˆØ± Ø§Ù„ÙˆØ¬Ø¨Ø§Øª: Ù…ÙƒÙˆÙ†Ø§Øª ØªÙ‚Ø¯ÙŠØ±ÙŠØ©ØŒ Ø³Ø¹Ø±Ø§Øª/Ù…Ø§ÙƒØ±ÙˆØ² ØªÙ‚Ø±ÙŠØ¨ÙŠØ©ØŒ Ù†ØµØ§Ø¦Ø­ ØªØ­Ø³ÙŠÙ†.  
- Ù…Ù„ÙØ§Øª/ØµÙˆØ± Ù†ØµÙŠØ©: Ø§Ø³ØªØ®Ø±Ø¬ Ø§Ù„Ù…Ù‡Ù… ÙˆØ§Ø¯Ù…Ø¬Ù‡ ÙÙŠ Ø§Ù„ØªÙˆØµÙŠØ§Øª.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€Ù©) Ù‚ÙˆØ§Ù„Ø¨ Ù…Ø®ØªØµØ±Ø© Ù…ØªÙ†ÙˆØ¹Ø© (Ù…Ù†Ø¹ Ø§Ù„Ø¢Ù„ÙŠØ© Ø¨Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ ÙˆØ§Ù„Ø§Ù‚ØªØµØ§Ø¯)ã€‘
- Ø§Ù„Ø·ÙˆÙ„/Ø§Ù„ÙˆØ²Ù† (Ø§Ø®ØªØ± ØµÙŠØ§ØºØ© Ù…Ø®ØªÙ„ÙØ© ÙƒÙ„ Ù…Ø±Ø©):
  â€¢ Â«Ø§Ù„Ø·ÙˆÙ„ ÙˆØ§Ù„ÙˆØ²Ù† Ø§Ù„Ø­Ø§Ù„ÙŠØŸÂ»  
  â€¢ Â«Ù…Ù…ÙƒÙ† Ø§Ù„Ø·ÙˆÙ„ ÙˆØ§Ù„ÙˆØ²Ù† Ø¯Ù„ÙˆÙ‚ØªÙŠØŸÂ»  
- Ø§Ù„Ù†Ø´Ø§Ø·:
  â€¢ Â«ÙÙŠ ØªÙ…Ø±ÙŠÙ† Ø­Ø§Ù„ÙŠÙ‹Ø§ØŸ ÙˆÙ†Ø´Ø§Ø·Ùƒ Ø§Ù„ÙŠÙˆÙ…ÙŠ Ù‚Ø¯Ù‘ Ø¥ÙŠÙ‡ØŸÂ»  
  â€¢ Â«Ù†Ø´Ø§Ø·Ùƒ Ø®ÙÙŠÙ ÙˆÙ„Ø§ Ù…ØªÙˆØ³Ø· ÙˆÙ„Ø§ Ø¹Ø§Ù„ÙŠØŸ ÙˆØ¨ØªØªÙ…Ø±Ù†ØŸÂ»  
- Ø§Ù„Ù…ÙƒØ§Ù†/Ø§Ù„Ø£ÙŠØ§Ù…:
  â€¢ Â«Ø¨ÙŠØª ÙˆÙ„Ø§ Ø¬ÙŠÙ…ØŸ ÙˆÙƒÙ… ÙŠÙˆÙ… ØªÙ‚Ø¯Ø± ØªÙ„ØªØ²Ù…ØŸÂ»  
  â€¢ Â«ØªÙØ¶Ù‘Ù„ Ø¬ÙŠÙ… ÙˆÙ„Ø§ Ø¨ÙŠØªØŸ ÙˆØ¹Ø¯Ø¯ Ø§Ù„Ø£ÙŠØ§Ù…ØŸÂ»  
- Ø§Ù„Ø£ÙƒÙ„:
  â€¢ Â«ÙÙŠ Ø£ÙƒÙ„Ø§Øª ØªØ¨Ø¹Ø¯ Ø¹Ù†Ù‡Ø§ØŸ ÙˆÙ…Ø±ØªØ§Ø­ Ø¹Ù„Ù‰ ÙƒØ§Ù… ÙˆØ¬Ø¨Ø©ØŸÂ»  
  â€¢ Â«ØªÙØ¶ÙŠÙ„Ø§Øª/Ù…Ù…Ù†ÙˆØ¹Ø§Øª Ø§Ù„Ø£ÙƒÙ„ Ø¥ÙŠÙ‡ØŸ ÙˆØ¹Ø¯Ø¯ Ø§Ù„ÙˆØ¬Ø¨Ø§ØªØŸÂ»  
- **Ù…Ù„Ø§Ø­Ø¸Ø§Øª**: Ù„Ø§ ØªØ¨Ø¯Ø£ Ø£ÙŠ Ø¬Ù…Ù„Ø© Ø¨Ø¹Ø¨Ø§Ø±Ø§Øª ØªÙ…Ù‡ÙŠØ¯ÙŠØ© Ù…ÙƒØ±Ø±Ø©ØŒ ÙˆÙ„Ø§ ØªØ°ÙƒØ± Ø³Ø¨Ø¨ Ø§Ù„Ø³Ø¤Ø§Ù„.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€Ù¡Ù ) ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ù…ÙÙ„Ø²Ù…Ø© Ù„Ù„Ø¥Ø®Ø±Ø§Ø¬ã€‘
Ø£) **Ø®Ø·Ø© ØªØ¯Ø±ÙŠØ¨ ÙƒØ§Ù…Ù„Ø©** - **Ø§Ù„Ù‡Ø¯Ù:** â€¦  
- **Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹:** â€¦ Ø£ÙŠØ§Ù… â€” (Gym/Home)  
- **Ø¥Ø±Ø´Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø©:** Ø¥Ø­Ù…Ø§Ø¡ 5â€“10Ø¯ + ØªØ¨Ø±ÙŠØ¯ 5â€“10Ø¯ØŒ ØªØªØ¨Ù‘Ø¹ RPEØŒ ØªØ¯Ø±Ù‘Ø¬ Ø£Ø³Ø¨ÙˆØ¹ÙŠ.  
- **Ø®Ø·Ø© Ø§Ù„Ø£ÙŠØ§Ù…:** â€¢ **Day 1 â€” Upper Strength** - Bench Press â€” 4Ã—6 @ RPE 7â€“8 â€” Rest 120â€“150s â€” Notes: â€¦  
    - Row (Chest Supported) â€” 4Ã—8 â€” Rest 90s â€” Notes: â€¦  
    - Overhead Press â€” 3Ã—8 â€” Rest 90s â€” Notes: â€¦  
    - Accessory: Face Pull 3Ã—12 â€” Plank 3Ã—45s  
  â€¢ **Day 2 â€” Lower Strength** - Back Squat â€” 4Ã—6 @ RPE 7â€“8 â€” Rest 150s â€” Notes: â€¦  
    - RDL â€” 4Ã—8 â€” Rest 120s â€” Notes: â€¦  
    - Split Squat â€” 3Ã—10/leg â€” Rest 90s  
    - Accessory: Calf Raises 3Ã—15 â€” Side Plank 3Ã—35s  
  â€¦  
- **ØªÙ‚Ø¯Ù‘Ù… Ø£Ø³Ø¨ÙˆØ¹ÙŠ:** +2.5â€“5% ÙˆØ²Ù† Ø£Ùˆ +1â€“2 ØªÙƒØ±Ø§Ø±/Ù…Ø¬Ù…ÙˆØ¹Ø©.  
- **Ø¨Ø¯Ø§Ø¦Ù„ Ø§Ù„Ø¥ØµØ§Ø¨Ø§Øª:** â€¦  
- **Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©:** Ø§Ù„Ø£Ø¯Ø§Ø¡ØŒ RPEØŒ Ø¬ÙˆØ¯Ø© Ø§Ù„Ø­Ø±ÙƒØ©ØŒ ØºÙŠØ§Ø¨ Ø§Ù„Ø£Ù„Ù….

Ø¨) **Ø®Ø·Ø© ØªØºØ°ÙŠØ© ÙƒØ§Ù…Ù„Ø©** - **Ø§Ù„Ø³Ø¹Ø±Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©:** â€¦ kcal  
- **Ø§Ù„Ù…Ø§ÙƒØ±ÙˆØ²:** Protein â€¦g â€” Carbs â€¦g â€” Fat â€¦g  
- **Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ¬Ø¨Ø§Øª:** â€¦ â€” **Ø£ÙˆÙ‚Ø§Øª ØªÙ‚Ø±ÙŠØ¨ÙŠØ©:** â€¦  
- **ÙŠÙˆÙ… ÙƒØ§Ù…Ù„ Ø¨Ø§Ù„Ù…Ù‚Ø§Ø¯ÙŠØ±:** 1) **ÙØ·Ø§Ø±**: â€¦ (Ø¬Ø±Ø§Ù…/Ù…Ù„/Ù‚Ø·Ø¹) â€” **Ø§Ù„Ø³Ø¹Ø±Ø§Øª:** â€¦ â€” **Ø§Ù„Ù…Ø§ÙƒØ±ÙˆØ²:** Pâ€¦/Câ€¦/Fâ€¦ â€” **Ø§Ù„ØªØ­Ø¶ÙŠØ±:** â€¦ â€” **Ø¨Ø¯Ø§Ø¦Ù„:** â€¦  
  2) **ØºØ¯Ø§Ø¡**: â€¦  
  3) **Ø³Ù†Ø§Ùƒ**: â€¦  
  4) **Ø¹Ø´Ø§Ø¡**: â€¦  
- **Ø³ÙˆØ§Ø¦Ù„/Ù…Ù„Ø­/Ø£Ù„ÙŠØ§Ù/ÙƒØ§ÙÙŠÙŠÙ†:** â€¦  
- **ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©:** Â±100â€“200 kcal Ø­Ø³Ø¨ Ø§Ù„Ù…ÙŠØ²Ø§Ù†/Ø§Ù„Ø£Ø¯Ø§Ø¡.

Ø¬) **ÙˆØµÙØ© ÙˆØ¬Ø¨Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø·Ù„Ø¨** - **Ø§Ù„Ø§Ø³Ù…:** â€¦  
- **Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª (Ø¬Ø±Ø§Ù…/Ù…Ù„/Ù‚Ø·Ø¹):** â€¦  
- **Ø§Ù„Ø®Ø·ÙˆØ§Øª:** 1) â€¦ 2) â€¦ 3) â€¦  
- **Ø§Ù„Ø³Ø¹Ø±Ø§Øª ÙˆØ§Ù„Ù…Ø§ÙƒØ±ÙˆØ²:** â€¦  
- **Ù†ØµØ§Ø¦Ø­ Ø§Ù„Ø¬ÙˆØ¯Ø©:** â€¦  
- **Ø¨Ø¯Ø§Ø¦Ù„/Ø­Ø³Ø§Ø³ÙŠØ§Øª:** â€¦

Ø¯) **Ø±Ø¯ Ø§Ø³ØªØ´Ø§Ø±ÙŠ Ù‚ØµÙŠØ±** - **Ù…Ù„Ø®Øµ ÙÙ‡Ù…ÙŠ:** â€¦  
- **Ø­Ù„ Ø¹Ù…Ù„ÙŠ:** â€¦  
- **Ø³Ø¤Ø§Ù„ Ù…ÙƒÙ…Ù„ ÙˆØ§Ø­Ø¯ (Ø¥Ù† Ù„Ø²Ù…):** â€¦

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€Ù¡Ù¡) Ù…Ù†Ø·Ù‚ Ø§Ù„Ù‚Ø±Ø§Ø± Ø§Ù„Ø³Ø±ÙŠØ¹ã€‘
- Â«Ø¹Ø§ÙŠØ² Ø®Ø·Ø©Â» + Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ø§Ù‚ØµØ©: Ø§Ø³Ø£Ù„ Ø³Ø¤Ø§Ù„Ù‹Ø§ ÙˆØ§Ø­Ø¯Ù‹Ø§ (Ø£Ùˆ Ø³Ø¤Ø§Ù„ÙŠÙ† Ù…Ø±ØªØ¨Ø·ÙŠÙ†)ØŒ ÙˆØ¨Ø¹Ø¯ Ø§ÙƒØªÙ…Ø§Ù„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ§Øª â†’ Ù‚Ø¯Ù‘Ù… Ø§Ù„Ø®Ø·Ø© ÙƒØ§Ù…Ù„Ø©.  
- Ù‡Ø¯Ù ÙˆØ§Ø¶Ø­ + Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙƒØªÙ…Ù„Ø©: Ù‚Ø¯Ù‘Ù… Ø§Ù„Ø®Ø·Ø© ÙÙˆØ±Ù‹Ø§.  
- Ø·Ù„Ø¨ Ø¬Ø²Ø¦ÙŠ: Ø§Ø¬Ù…Ø¹ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© â†’ Ù‚Ø¯Ù‘Ù… Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ù…Ø¨Ø§Ø´Ø±Ø©.  
- ØªØ­ÙŠØ©/Ø­Ø¯ÙŠØ« Ø¹Ø§Ù…: ØªØ­ÙŠØ© Ù…Ø®ØªØµØ±Ø© ÙˆØ§Ø­Ø¯Ø© â†’ Ø³Ø¤Ø§Ù„ ØªÙˆØ¬ÙŠÙ‡ÙŠ Ø¹Ù…Ù„ÙŠ.  
- ÙˆØ³Ø§Ø¦Ø·: Ø­Ù„Ù‘Ù„ ÙˆØ§Ø¯Ù…Ø¬ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙÙˆØ±Ù‹Ø§ (Ø¨Ø¯ÙˆÙ† Ø·Ù„Ø¨ ÙˆØ³Ø§Ø¦Ø·).  
- Ø·Ù„Ø¨ ØªØ­ÙˆÙ„ Ù‚Ø§Ø³Ù: ØªÙ†Ø¨ÙŠÙ‡ Ù…ÙˆØ¬Ø² + Ø¥Ø®Ù„Ø§Ø¡ Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© + Ø®Ø·Ø© Ù‚ÙˆÙŠØ© + Ø¨Ø¯ÙŠÙ„ Ø£Ù‡Ø¯Ø£.

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ã€Ù¡Ù¢) Ø¶Ù…Ø§Ù† Ø§Ù„Ø¬ÙˆØ¯Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ (Checklist)ã€‘
- Ù„Ø§ ØªÙƒØ±Ø§Ø± Ù„Ø£Ø³Ø¦Ù„Ø©/Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…ÙØ¬Ø§Ø¨ Ø¹Ù†Ù‡Ø§.  
- Ù„Ø§ Ø°ÙƒØ± Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù….  
- Ù„Ø§ Ø¹Ø¨Ø§Ø±Ø§Øª Ø£Ùˆ Ø§ÙØªØªØ§Ø­ÙŠØ§Øª Ø¢Ù„ÙŠØ© ÙÙŠ Ø£ÙŠ Ù…ÙˆØ¶Ø¹.  
- Ø§Ù„Ù„ØºØ© Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø£Ùˆ Ù…ØµØ±ÙŠ Ø¨Ø±ÙˆÙÙŠØ´Ù†Ø§Ù„).  
- Ø§Ù„Ø±Ø¯ Ù…Ø¨Ø§Ø´Ø±ØŒ ÙƒØ§Ù…Ù„ØŒ ÙˆÙ…Ù†Ø³Ù‘Ù‚.  
- Ø§Ù„Ø®Ø·Ø· ØªØ´Ù…Ù„ ØªØ¯Ø±ÙŠØ¨ + ØªØºØ°ÙŠØ© + Ø¥Ø±Ø´Ø§Ø¯Ø§Øª + ØªÙ‚Ø¯Ù‘Ù… + Ø¨Ø¯Ø§Ø¦Ù„.  
- Ø§Ù„Ø§Ø³ØªØ´Ø§Ø±Ø©: Ø­Ù„ Ø¹Ù…Ù„ÙŠ ÙˆØ§Ø¶Ø­ + Ø³Ø¤Ø§Ù„ ÙˆØ§Ø­Ø¯ ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©.  
- Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§ÙÙŠØ©ØŸ â†’ Ù‚Ø¯Ù‘Ù… Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ø¢Ù† Ø¨Ù„Ø§ Ø£Ø³Ø¦Ù„Ø© Ø¥Ø¶Ø§ÙÙŠØ© Ø£Ùˆ ØªØ¨Ø±ÙŠØ±Ø§Øª.
` }
    function buildImagePrompt(){
      return `Ø­Ù„Ù‘Ù„ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ù‚Ø§Ø· ØªÙ†ÙÙŠØ°ÙŠØ© Ù…Ø®ØªØµØ±Ø© ÙÙ‚Ø· (3-5 Ù†Ù‚Ø§Ø·) Ø¨Ø¯ÙˆÙ† Ø£ÙŠ Ù…Ù‚Ø¯Ù…Ø§Øª:
- Ù…Ø§Ø°Ø§ ØªØ±Ù‰ (Ù…Ø®ØªØµØ± Ù…Ø­Ø¯Ø¯).
- Ø£ÙŠ Ù†Øµ/Ù‚ÙŠÙ… Ø¸Ø§Ù‡Ø±Ø© Ø¥Ù† ÙˆÙØ¬Ø¯Øª.
- Ø§Ù„ØªÙØ³ÙŠØ± Ø§Ù„ØµØ­ÙŠ/Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠ Ø§Ù„Ø¹Ù…Ù„ÙŠ.
- Ø®Ø·ÙˆØ© ÙˆØ§Ø­Ø¯Ø© Ù…Ù‚ØªØ±Ø­Ø© Ø§Ù„Ø¢Ù†.
Ù„Ø§ ØªÙƒØªØ¨ Ø¬ÙÙ…Ù„ Ø¹Ø§Ù…Ø©.`;
    }

    /* =========================
       AI Call (proxy)
    ========================= */
    async function callAI(prompt, {images, audio} = {}){
      try{
        const payload = { prompt };
        if (images && images.length){
          payload.images = images.map(x => {
            if(typeof x === 'string' && x.startsWith('data:')){
              const [meta, b64] = x.split(',');
              const mime = meta.substring(5, meta.indexOf(';'));
              return { mime, data: b64, dataUrl: x };
            }
            return x;
          });
        }
        if (audio) payload.audio = audio;
        const res = await fetch('/.netlify/functions/gemini-proxy',{
          method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)
        });
        const data = await res.json();
        if(!res.ok) throw new Error((data && (data.details || data.error)) || 'AI error');
        return data.text || '';
      }catch(e){ console.error(e); return '' }
    }

    /* =========================
       Health flags
    ========================= */
    const MED_FLAGS=/(Ø³ÙƒØ±ÙŠ|Ø¶ØºØ·|Ù‚Ù„Ø¨|Ø³Ø±Ø·Ø§Ù†|Ø­Ø§Ù…Ù„|Ø­Ù…Ù„|Ø±Ø¶Ø§Ø¹Ø©|ØºØ¯Ø©|Ø¯Ø±Ù‚|ÙƒØ¨Ø¯|ÙƒÙ„Ùˆ[ÙŠØ©]|kidney|liver|thyroid|injury|Ø¥ØµØ§Ø¨Ø©|Ø¹Ù…Ù„ÙŠØ©|Ø¯ÙˆØ§Ø¡|Ø£Ø¯ÙˆÙŠØ©|ÙƒÙˆØ±ØªÙŠØ²ÙˆÙ†|Ø¶ØºØ· Ø§Ù„Ø¯Ù…|Ø³ÙƒØ± Ø§Ù„Ø¯Ù…)/i;
    function analyzeUserMessage(msg){ if(MED_FLAGS.test(msg)){ displayMessage('ØªÙ… Ø±ØµØ¯ Ø­Ø§Ù„Ø© ØµØ­ÙŠØ© â€” Ø³Ù†Ø¶ÙŠÙ Ø§Ø­ØªÙŠØ§Ø·Ø§Øª Ù…Ù†Ø§Ø³Ø¨Ø©. Ø§Ø°ÙƒØ± ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¯ÙˆØ§Ø¡/Ø§Ù„Ø¬Ø±Ø¹Ø© Ø£Ùˆ Ø§Ù„ØªØ´Ø®ÙŠØµ Ø¥Ù† ÙˆÙØ¬Ø¯.', 'ai') } }

    /* =========================
       Internal State
    ========================= */
    function compactAndSnippet(){
      compactHistory();
      const lines = chatHistory.map(m=>{
        const role = m.role === 'assistant' ? 'Ø§Ù„Ù…Ø¯Ø±Ø¨' : 'Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…';
        const txt  = (m.parts?.[0]?.text || '').replace(/\s+/g,' ').slice(0,1200);
        return `${role}: ${txt}`;
      });
      return lines.join('\n').slice(0, MAX_PROMPT_CHARS);
    }
    function buildInternalStateSummary(){
      const d = userState.data || {};
      const fields = [];
      if (d.name)    fields.push(`Ø§Ù„Ø§Ø³Ù…: ${d.name}`);
      if (d.age)     fields.push(`Ø§Ù„Ø¹Ù…Ø±: ${d.age}`);
      if (d.country) fields.push(`Ø§Ù„Ø¯ÙˆÙ„Ø©: ${d.country}`);
      if (d.goal)    fields.push(`Ø§Ù„Ù‡Ø¯Ù: ${d.goal}`);
      if (d.health)  fields.push(`Ø­Ø§Ù„Ø© ØµØ­ÙŠØ©: ${d.health}`);
      if (d.gym)     fields.push(`Ù…ÙƒØ§Ù† Ø§Ù„ØªÙ…Ø±ÙŠÙ†: ${d.gym}`);
      if (d.meals)   fields.push(`ÙˆØ¬Ø¨Ø§Øª/Ø§Ù„ÙŠÙˆÙ…: ${d.meals}`);
      return fields.length ? `ğŸ—’ï¸ Ù…Ù„Ø®Øµ Ø§Ù„Ø­Ø§Ù„Ø©: ${fields.join(' | ')}` : '';
    }

    /* =========================
       Voice to text
    ========================= */
    let recording=false; let sttSession=0; let recognition=null; let mediaStream=null; let mediaRecorder=null; let audioChunks=[]; let recStartTime=0;
    const supportSpeechRecognition = ()=> ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window);
    function startLocalRecognition(){
      const SR = window.SpeechRecognition || window.webkitSpeechRecognition; if(!SR) return null;
      const sessionId = ++sttSession;
      const rec = new SR();
      rec.lang = (LANG==='ar' ? 'ar-EG' : 'en-US');
      rec.interimResults = true; rec.continuous = true;
      rec.onresult = (e)=>{
        if(sessionId !== sttSession) return;
        let final=''; let interim='';
        for(let i=e.resultIndex;i<e.results.length;i++){
          const r=e.results[i];
          if(r.isFinal){ final += r[0].transcript } else { interim = r[0].transcript }
        }
        const text = (final || interim).trim();
        if(text){ userInput.value = text; userInput.focus(); }
      };
      rec.onerror = ()=>{}; rec.onend = ()=>{};
      rec.start();
      return { rec, sessionId };
    }
    async function startRecording(){
      if(recording) return; recording=true;
      if(supportSpeechRecognition()){
        const h = startLocalRecognition();
        recognition = h?.rec || null;
        micBtn.classList.add('mic-live'); recHintWrap.classList.remove('hidden'); $('recHint').textContent = i18n[LANG].recStart;
        return;
      }
      try{
        mediaStream = await navigator.mediaDevices.getUserMedia({audio:true});
        const mime = MediaRecorder.isTypeSupported('audio/webm;codecs=opus') ? 'audio/webm;codecs=opus' : (MediaRecorder.isTypeSupported('audio/webm') ? 'audio/webm' : 'audio/ogg');
        mediaRecorder = new MediaRecorder(mediaStream, {mimeType: mime});
        audioChunks = []; recStartTime = Date.now();
        mediaRecorder.ondataavailable = e => { if(e.data.size>0) audioChunks.push(e.data) };
        mediaRecorder.onstop = handleRecordingStopFallback;
        mediaRecorder.start();
        micBtn.classList.add('mic-live'); recHintWrap.classList.remove('hidden'); $('recHint').textContent = i18n[LANG].recStart;
      }catch(e){ toast(i18n[LANG].recDenied); recording=false; }
    }
    function stopRecording(){
      if(!recording) return; recording=false;
      if(recognition && recognition.stop){ try{ recognition.stop(); }catch(_){}; recognition=null; }
      try{ mediaRecorder && mediaRecorder.state!=='inactive' && mediaRecorder.stop(); }catch(_){}
      try{ mediaStream && mediaStream.getTracks().forEach(t=>t.stop()); }catch(_){}
      micBtn.classList.remove('mic-live'); recHintWrap.classList.add('hidden');
      sttSession++;
    }
    async function handleRecordingStopFallback(){
      const duration = (Date.now()-recStartTime)/1000; if(duration < 0.6){ toast(i18n[LANG].recTooShort); return }
      const blob = new Blob(audioChunks, {type: mediaRecorder.mimeType});
      const reader = new FileReader(); reader.onload = async () => {
        const base64 = reader.result.split(',')[1];
        const sttPrompt = `Ø£Ø¹Ø¯ ÙÙ‚Ø· JSON ØµØ§Ù„Ø­ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø´ÙƒÙ„ Ø¨Ø¯ÙˆÙ† Ø£ÙŠ ÙƒÙ„Ø§Ù… Ø¢Ø®Ø±:
{
  "transcript": string
}
Ø­ÙˆÙ‘Ù„ Ø§Ù„ØµÙˆØª Ø¥Ù„Ù‰ Ù†Øµ ${(LANG==='ar'?'Ø¹Ø±Ø¨ÙŠ':'English')} ÙˆØ§Ø¶Ø­.`;
        const raw = await callAI(sttPrompt, { audio: { mime: blob.type, data: base64 } });
        let transcript=''; try{ const s=raw.indexOf('{'); const e=raw.lastIndexOf('}'); const j = JSON.parse(raw.slice(s,e+1)); transcript = (j.transcript||'').trim(); }catch(_){ transcript='' }
        if(transcript){ userInput.value = transcript; userInput.focus(); toast(i18n[LANG].recSaved) }
      };
      reader.readAsDataURL(blob);
    }

    /* =========================
       Files: TXT/CSV/PDF + Images
    ========================= */
    const Files = {
      async handleFile(file){
        const name = (file.name||'').toLowerCase();
        if(name.endsWith('.txt')||name.endsWith('.csv')){
          const text = await file.text();
          displayMessage(`**ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù„Ù:** ${file.name}\n\n\`\`\`\n${text.slice(0,1200)}\n\`\`\`\n`, 'user');
          await Files.analyzeText(text);
        }else if(name.endsWith('.pdf')){
          await Files.extractPdfText(file);
        }else{
          toast(LANG==='ar'?'Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… Ù‡Ù†Ø§ â€” Ø§Ø±ÙØ¹ ØµÙˆØ±Ø© Ø£Ùˆ PDF/CSV/TXT':'Unsupported file type');
        }
      },
      async analyzeText(text){
        const typingEl = showTyping('ai');
        const prompt = `Ø§Ø³ØªØ®Ø±Ø¬ Ø£Ù‡Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù†Øµ Ø§Ù„ØªØ§Ù„ÙŠ ÙˆÙ‚Ø¯Ù‘Ù… Ø®Ù„Ø§ØµØ© ØªÙ†ÙÙŠØ°ÙŠØ© Ù…Ù† 5-7 Ù†Ù‚Ø§Ø· Ø«Ù… ØªÙˆØµÙŠØ© Ø¹Ù…Ù„ÙŠØ© ÙˆØ§Ø­Ø¯Ø©:\n\n${text.slice(0,12000)}`;
        const aiResp = await callAI(prompt);
        removeNode(typingEl);
        const reply = aiResp || (LANG==='ar'?'ØªÙ…Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©.':'Read.');
        displayMessage(reply,'ai');
        chatHistory.push({role:'assistant',parts:[{text:reply}]});
      },
      async extractPdfText(file){
        displayMessage(`**ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… PDF:** ${file.name}`,'user');
        if(!window.pdfjsLib){
          await new Promise((res,rej)=>{
            const s=document.createElement('script');
            s.src='https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.5.136/pdf.min.js';
            s.onload=res; s.onerror=rej; document.head.appendChild(s);
          });
        }
        const buf = await file.arrayBuffer();
        const pdf = await pdfjsLib.getDocument({data:buf}).promise;
        let text=''; 
        for(let p=1;p<=Math.min(pdf.numPages,20);p++){
          const page = await pdf.getPage(p);
          const content = await page.getTextContent();
          text += content.items.map(i=>i.str).join(' ') + '\n';
          if(text.length>12000) break;
        }
        await Files.analyzeText(text);
      }
    };

    /* =========================
       Conversation Engine
    ========================= */
    function analyzeMsgForState(message){
      if (/Ø®Ø·Ø©|Ø£Ø®Ø³|ØªØ®Ø³ÙŠØ³|ØªØ¶Ø®ÙŠÙ…|Ø¹Ø¶Ù„/i.test(message)) userState.data.goal = userState.data.goal || 'Ø®Ø·Ø© Ù…Ø®ØµØµØ©';
      if (/Ø¬ÙŠÙ…|Ø¨ÙŠØª|Ù…Ù†Ø²Ù„/i.test(message)) userState.data.gym = userState.data.gym || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
      if (MED_FLAGS.test(message)) userState.data.health = (userState.data.health || 'Ù‚ÙŠÙˆØ¯ ØµØ­ÙŠØ©');
    }

    async function processAIResponse(message){
      const typingEl = showTyping('ai');
      analyzeMsgForState(message);
      const state = buildInternalStateSummary();
      const convo = compactAndSnippet();

      const coachPrompt =
`${buildCoachSystemPrompt()}

${state ? state + '\n' : ''}Ø³Ø¬Ù„ Ù…Ø®ØªØµØ± (Ø¢Ø®Ø± Ø§Ù„Ø±Ø³Ø§Ø¦Ù„):
${convo}

Ø±Ø¯ ÙƒÙ…Ø¯Ø±Ù‘Ø¨ Ù…Ø­ØªØ±Ù Ø¹Ù„Ù‰ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø£Ø®ÙŠØ±Ø© ÙÙ‚Ø·ØŒ ÙˆØ§Ù„ØªØ²Ù… Ø¨Ø³Ø¤Ø§Ù„ ÙˆØ§Ø­Ø¯ ÙƒØ­Ø¯ Ø£Ù‚ØµÙ‰ Ù„Ùˆ Ù„Ø²Ù…:
Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø£Ø®ÙŠØ±Ø©: ${message}`;

      let response = '';
      try{ response = await callAI(coachPrompt); }catch(e){ console.error(e); }

      removeNode(typingEl);

      if(!response || !response.trim()){
        response = (LANG==='ar')
          ? 'Ø®Ù„Ù‘ÙŠÙ†Ø§ Ù†ÙƒÙ…Ù„ Ø¨Ø®Ø·ÙˆØ© Ø¹Ù…Ù„ÙŠØ© Ø³Ø±ÙŠØ¹Ø©: Ø§Ù…Ø´Ù 15â€“20 Ø¯Ù‚ÙŠÙ‚Ø© Ø§Ù„Ù†Ù‡Ø§Ø±Ø¯Ù‡ØŒ ÙˆÙ„Ùˆ Ø¹Ù†Ø¯Ùƒ Ù‡Ø¯Ù Ù…Ø­Ø¯Ø¯ Ø³Ø¨Ù‘Ù‡ÙˆÙ„ÙŠ Ù†Ø«Ø¨Ù‘ØªÙ‡ ÙˆÙ†Ø¨Ù†ÙŠ Ø¹Ù„ÙŠÙ‡.'
          : 'Letâ€™s keep momentum: take a 15â€“20 min walk today. Share your main goal and weâ€™ll lock it.';
      }

      chatHistory.push({role:'assistant',parts:[{text:response}]});
      displayMessage(response,'ai');
      togglePlanCTA();
    }

    function sendMessage(){
      const raw=(userInput.value||'').trim(); if(!raw) return;

      // Ù„ØºØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
      Lang.autoSetByText(raw);

      // Ø±Ø¯ Ø¹Ù„Ù‰ Ø±Ø³Ø§Ù„Ø© Ù…Ù‚ØªØ¨Ø³Ø© Ø¥Ù† ÙˆÙØ¬Ø¯
      let finalMsg = raw;
      if(replyBar.classList.contains('show')){
        finalMsg = (LANG==='ar'
          ? `> ${replySnippet.textContent}\n\n${raw}`
          : `> ${replySnippet.textContent}\n\n${raw}`);
        UI.clearReply();
      }

      displayMessage(finalMsg,'user');
      chatHistory.push({role:'user',parts:[{text:finalMsg}]});
      analyzeUserMessage(finalMsg);
      processAIResponse(finalMsg);
      userInput.value='';
    }

    /* =========================
       Events
    ========================= */
    document.addEventListener('DOMContentLoaded',()=>{
      // Welcome -> Profile
      startBtn.addEventListener('click',()=>{ welcomeScreen.classList.add('hidden'); userDataScreen.classList.remove('hidden'); setLang(LANG) });

      // Profile -> Chat
      nextBtn.addEventListener('click',()=>{
        const name=(userNameInput.value||'').trim();
        const age=(userAgeInput.value||'').trim();
        const country=(userCountryInput.value||'').trim();
        Lang.autoSetByText(name || country);
        if(!name||!age||!country){ toast(i18n[LANG].emptyFields); return }
        userState.data={...userState.data,name,age,country};
        userDataScreen.classList.add('hidden'); chatContainer.classList.remove('hidden');
        const welcomeMsg = (LANG==='ar')
          ? `Ù…Ø±Ø­Ø¨Ù‹Ø§ ${name}. `
          : `Welcome ${name}. Weâ€™ll collect key data and build a precise, doable plan.`;
        chatHistory.push({role:'assistant',parts:[{text:welcomeMsg}]}); displayMessage(welcomeMsg,'ai'); togglePlanCTA();
      });

      // Theme & Lang
      btnTheme.addEventListener('click', setTheme);
      btnLang.addEventListener('click',()=> setLang(LANG==='ar' ? 'en' : 'ar'));
      const savedTheme=localStorage.getItem('theme'); if(savedTheme==='dark'){ document.documentElement.classList.add('dark'); btnTheme.textContent='ğŸŒ™' }
      setLang('ar');

      // Inputs
      function keyHandler(e){ if(e.key==='Enter') sendMessage() }
      sendBtn.addEventListener('click', sendMessage);
      userInput.addEventListener('keypress', keyHandler);

      // Plus: short press = image, long press = file
      let pressTimer;
      plusBtn.addEventListener('mousedown', ()=>{ pressTimer = setTimeout(()=> fileInput.click(), 400) });
      plusBtn.addEventListener('mouseup', ()=>{ clearTimeout(pressTimer); imageInput.click(); });
      plusBtn.addEventListener('mouseleave', ()=> clearTimeout(pressTimer));
      plusBtn.addEventListener('touchstart', ()=>{ pressTimer = setTimeout(()=> fileInput.click(), 400) }, {passive:true});
      plusBtn.addEventListener('touchend', ()=>{ clearTimeout(pressTimer); imageInput.click(); }, {passive:true});

      // Image upload -> analyze
      imageInput.addEventListener('change', async (e)=>{
        const file=e.target.files[0]; if(!file) return;
        const reader=new FileReader(); reader.onload= async (ev)=>{
          const dataUrl = ev.target.result;
          const imgHTML=`<img src="${dataUrl}" class="max-w-[220px] rounded-lg my-2" alt="uploaded image"/>`;
          displayMessage(imgHTML,'user'); toast(i18n[LANG].imageUpload);
          const typingEl = showTyping('ai');
          let aiResp = await callAI(buildImagePrompt(), { images: [dataUrl] });
          removeNode(typingEl);
          const bad = /Ù‚Ø¯Ù‘Ù…|provide|ÙŠØ±Ø¬Ù‰ ØªÙ‚Ø¯ÙŠÙ…|please provide|Ù„Ø§ Ø£Ø³ØªØ·ÙŠØ¹ Ø±Ø¤ÙŠØ© Ø§Ù„ØµÙˆØ±Ø©/i.test(aiResp||'');
          const reply = bad || !aiResp ? (LANG==='ar'? 'ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„ØµÙˆØ±Ø© ÙˆÙ…Ø¹Ø§Ù„Ø¬ØªÙ‡Ø§. Ù„Ù†ØªÙŠØ¬Ø© Ø£ÙˆØ¶Ø­ØŒ Ø£Ø±Ø³Ù„ ØµÙˆØ±Ø© Ø£ÙˆØ¶Ø­ ÙˆØ³Ø£Ø­Ù„Ù‘Ù„Ù‡Ø§ Ø¨Ø¯Ù‚Ø©.' : 'Image received and processed. For clearer results, upload a sharper image.') : aiResp;
          displayMessage(reply, 'ai');
          chatHistory.push({role:'user',parts:[{text:'[ØµÙˆØ±Ø© Ù…Ø±ÙÙˆØ¹Ø©]'}]});
          chatHistory.push({role:'assistant',parts:[{text:reply}]});
          togglePlanCTA();
        };
        reader.readAsDataURL(file)
      });

      // File upload -> parse/read
      fileInput.addEventListener('change', async (e)=>{
        const f=e.target.files[0]; if(!f) return;
        await Files.handleFile(f);
      });

      // Mic interactions
      const startEvents = ['pointerdown','touchstart','mousedown'];
      const endEvents = ['pointerup','touchend','mouseup','mouseleave','pointercancel'];
      startEvents.forEach(ev => micBtn.addEventListener(ev, (e)=>{ e.preventDefault(); startRecording() }, {passive:false}));
      endEvents.forEach(ev => micBtn.addEventListener(ev, (e)=>{ e.preventDefault(); stopRecording() }, {passive:false}));

      // CTA -> contact
      generatePlanBtn.addEventListener('click', ()=>{
        const body = contactModal.querySelector('.modal-body');
        const pitch = document.createElement('div');
        pitch.className='mb-3 text-[.95rem] font-semibold';
        pitch.textContent = 'Ù†Ø¨Ø¯Ø£ Ø§Ù„ÙŠÙˆÙ…: Ø®Ø·Ø© Ø¯Ù‚ÙŠÙ‚Ø© + Ù…ØªØ§Ø¨Ø¹Ø© Ø£Ø³Ø¨ÙˆØ¹ÙŠØ© + Ø¯Ø¹Ù… Ù…Ø¨Ø§Ø´Ø± â€” Ø§Ø´ØªØ±Ùƒ Ø§Ù„Ø¢Ù†.';
        body.prepend(pitch);
        contactModal.classList.add('open'); contactModal.setAttribute('aria-hidden','false');
      });
      closeContactBtn.addEventListener('click',()=>{ contactModal.classList.remove('open'); contactModal.setAttribute('aria-hidden','true') });
      contactModal.addEventListener('click', e=>{ if(e.target===contactModal){ contactModal.classList.remove('open'); contactModal.setAttribute('aria-hidden','true') } });
    });
  </script>
</body>
</html>



