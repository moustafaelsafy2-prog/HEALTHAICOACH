<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>ูุฏุฑุจู ุงูุดุฎุตู ุงูุฐูู | Smart Personal Coach</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap');
    :root{
      --primary:#04364A; --secondary:#176B87; --accent:#64CCC5;
      --chat-bg:#F5F7FA; --bubble-user:#E8F7D4; --bubble-ai:#FFFFFF;
      --backdrop:rgba(2,6,23,.55);
      --text:#0B1220; --muted:#64748B;
      --surface:#FFFFFF; --border:#E5E7EB
    }
    html.dark{
      --primary:#0f172a; --secondary:#334155; --accent:#10B981;
      --chat-bg:#0B1220; --bubble-user:#394150; --bubble-ai:#111827;
      --backdrop:rgba(0,0,0,.7); --text:#E5E7EB; --muted:#94A3B8;
      --surface:#0f172a; --border:#334155
    }
    *{box-sizing:border-box}
    body{font-family:'Tajawal',sans-serif;background:var(--chat-bg);color:var(--text);transition:background-color .3s,color .3s}

    /* Shell */
    .chat-container{max-width:780px;margin:0 auto;height:100vh;display:flex;flex-direction:column;background:var(--chat-bg);box-shadow:0 0 25px rgba(0,0,0,.08);border-radius:1rem;overflow:hidden}
    .chat-header{background:linear-gradient(135deg,var(--primary),var(--secondary));color:#fff;padding:.875rem 1rem;position:sticky;top:0;z-index:10;display:flex;justify-content:space-between;align-items:center}
    .brand{display:flex;align-items:center;gap:.6rem}
    .brand img{width:40px;height:40px;border-radius:999px;object-fit:cover}

    .chat-messages{flex:1;padding:1rem;overflow-y:auto;-webkit-overflow-scrolling:touch;padding-bottom:6rem}
    .message-bubble{padding:.85rem 1.15rem;border-radius:1.25rem;max-width:85%;margin-bottom:.75rem;animation:fadeIn .25s ease-in-out}
    .message-bubble.user{background:var(--bubble-user);margin-left:auto;border-bottom-right-radius:.25rem;color:#0B1220}
    .message-bubble.ai{background:var(--bubble-ai);margin-right:auto;border-bottom-left-radius:.25rem;color:var(--text)}

    .input-area{display:flex;gap:.5rem;padding:.75rem;background:color-mix(in srgb,var(--surface) 92%, transparent);border-top:1px solid var(--border);position:sticky;bottom:0;z-index:10;align-items:center;backdrop-filter:saturate(160%) blur(6px)}
    .input-area input[type=text]{flex:1;border-radius:999px;padding:.78rem 1.1rem;border:1px solid var(--border);background:#fff;color:#0B1220}
    html.dark .input-area input[type=text]{background:#0f172a;color:#E5E7EB}
    .input-area input[type=text]::placeholder{color:var(--muted)}
    .input-area input[type=text]:focus{outline:none;border-color:var(--accent)}
    .icon-btn{background:transparent;color:#0ea5e9;border-radius:999px;width:44px;height:44px;display:grid;place-items:center;transition:.25s}
    .icon-btn:hover{background:rgba(0,0,0,.06)}
    .send-btn{background:var(--accent);color:#fff}

    .welcome-screen,.user-data-screen{display:flex;flex-direction:column;justify-content:center;align-items:center;height:100vh;text-align:center;background:linear-gradient(135deg,var(--primary),var(--secondary));color:#fff}
    .cta-btn{background:var(--accent);font-weight:700;box-shadow:0 6px 16px rgba(0,0,0,.25);padding:1rem 2rem;border-radius:999px}

    .toast{position:fixed;bottom:1.2rem;left:50%;transform:translateX(-50%);background:#111827;color:#fff;padding:.7rem 1rem;border-radius:.6rem;z-index:60;opacity:0;transition:.35s}
    @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

    .typing{display:inline-flex;gap:6px;align-items:center}
    .dot{width:6px;height:6px;border-radius:999px;background:#9CA3AF;animation:blink 1.2s infinite}
    .dot:nth-child(2){animation-delay:.2s}.dot:nth-child(3){animation-delay:.4s}
    @keyframes blink{0%,80%,100%{opacity:.2}40%{opacity:1}}

    .mic-btn{position:relative}
    .mic-live::after{content:'';position:absolute;inset:-2px;border:2px solid #ef4444;border-radius:999px;animation:pulse 1s infinite}
    @keyframes pulse{0%{transform:scale(.95);opacity:.9}70%{transform:scale(1.05);opacity:.2}100%{transform:scale(.95);opacity:.9}}
    .rec-hint{font-size:.8rem;color:#ef4444;margin-inline-end:.35rem}

    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:var(--backdrop);z-index:50}
    .modal.open{display:flex}
    .modal-content{width:min(560px,96vw);max-height:86vh;overflow:hidden;background:#fff;border-radius:1rem;box-shadow:0 20px 60px rgba(0,0,0,.25);display:flex;flex-direction:column}
    html.dark .modal-content{background:#0f172a;color:#E5E7EB}
    .modal-header{display:flex;justify-content:space-between;align-items:center;padding:.85rem 1rem;border-bottom:1px solid var(--border);background:linear-gradient(135deg,var(--primary),var(--secondary));color:#fff}
    .modal-body{padding:1rem}
    .close-button{background:transparent;color:#fff;font-size:1.75rem;line-height:1;padding:0 .25rem}
    .contact-actions{display:grid;grid-template-columns:1fr;gap:.8rem}
    @media (min-width:520px){.contact-actions{grid-template-columns:1fr 1fr}}
    .contact-btn{display:flex;align-items:center;gap:.75rem;padding:1rem;border-radius:.9rem;font-weight:800;justify-content:center}
    .contact-btn svg{width:22px;height:22px}
    .contact-whatsapp{background:#25D366;color:#fff}
    .contact-phone{background:#0ea5e9;color:#fff}

    .footer{text-align:center;padding:.75rem;font-size:.9rem;color:var(--muted)}
    @media (max-width:420px){.brand span{display:none}}
  </style>
</head>
<body class="flex flex-col h-screen overflow-hidden">
  <!-- Welcome -->
  <div class="welcome-screen" id="welcomeScreen">
    <img id="welcomeAvatar" src="https://images.unsplash.com/photo-1605296867304-46d5465a13f1?auto=format&fit=crop&w=200&q=60" alt="Coach Avatar" class="rounded-full mb-6 shadow-xl object-cover"/>
    <h1 class="text-4xl font-bold mb-2" id="welcomeTitle">ูุฏุฑุจู ุงูุดุฎุตู ุงูุฐูู</h1>
    <p class="text-xl font-light text-white/90 mb-6" id="welcomeSubtitle">ุฌุงูุฒ ููุชุบููุฑุ ุฎุทุชู ูุตููุฉ ุฎุตูุตูุง ูู โ ุชูููุฐ ูุญููุ ูุชุงุจุนุฉ ุฏูููุฉุ ููุชูุฌุฉ ููููุณุฉ.</p>
    <button id="startBtn" class="cta-btn">ุงุจุฏุฃ ุงูุขู</button>
  </div>

  <!-- Profile -->
  <div class="user-data-screen hidden" id="userDataScreen">
    <h2 class="text-3xl font-extrabold mb-4" id="userDataTitle">ููุจูู ูููู ุงูุณุฑูุน</h2>
    <p class="text-white/90 mb-6" id="userDataSubtitle">ุงุณูู ูุนููุฑู ูุฏููุชู ูุจุฏุงูุฉ</p>
    <div class="w-full max-w-sm">
      <input type="text" id="userName" class="block w-full mb-3 rounded-md px-4 py-3 text-right bg-white/10 border border-white/30 text-white placeholder-white/70 focus:bg-white/20" placeholder="ุงุณูู" dir="rtl">
      <input type="number" id="userAge" class="block w-full mb-3 rounded-md px-4 py-3 text-left bg-white/10 border border-white/30 text-white placeholder-white/70 focus:bg-white/20" placeholder="ุนูุฑู" dir="ltr">
      <input type="text" id="userCountry" class="block w-full mb-3 rounded-md px-4 py-3 text-right bg-white/10 border border-white/30 text-white placeholder-white/70 focus:bg-white/20" placeholder="ุฏููุชู" dir="rtl">
      <button id="nextBtn" class="cta-btn w-full mt-2">ุงุจุฏุฃ ุงููุญุงุฏุซุฉ</button>
    </div>
  </div>

  <!-- Chat -->
  <div class="chat-container hidden" id="chatContainer">
    <div class="chat-header">
      <div class="brand">
        <img id="chatAvatar" src="https://images.unsplash.com/photo-1605296867304-46d5465a13f1?auto=format&fit=crop&w=80&q=60" alt="Coach Avatar"/>
        <span class="text-xl font-bold" id="chatTitle">ูุฏุฑุจู ุงูุดุฎุตู ุงูุฐูู</span>
      </div>
      <div class="flex items-center gap-2">
        <button id="btnLang" class="icon-btn text-white border border-white/30 px-3 w-auto h-9 rounded-md">AR</button>
        <button id="btnTheme" class="icon-btn text-white border border-white/30 w-9 h-9 rounded-md">โ๏ธ</button>
      </div>
    </div>

    <div class="chat-messages" id="chatMessages" role="region" aria-label="Chat messages" aria-live="polite"></div>

    <!-- CTA: opens contact modal -->
    <div id="planButtonArea" class="px-4 py-3 hidden">
      <div class="rounded-xl bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-700 p-3 flex items-center justify-between">
        <div class="text-[.98rem] font-semibold text-slate-700 dark:text-slate-200" id="prepStatus">ุฌุงูุฒ ุชุจุฏุฃ ุจุฎุทุชู ูุนูุงุ ุชูุงุตู ุจุฎุทูุฉ ูุงุญุฏุฉ</div>
        <button id="generatePlanBtn" class="btn send-btn" disabled>ุงุญุตู ุนูู ุฎุทุชู ุงูุขู</button>
      </div>
      <p id="planButtonNote" class="text-gray-600 dark:text-gray-300 text-sm mt-2">ููููู ุงูุงุณุชูุฑุงุฑ ูู ุงูุญุฏูุซ ุฅุฐุง ูุงูุช ูุฏูู ุฃุณุฆูุฉ.</p>
    </div>

    <div class="input-area" id="inputArea">
      <input type="text" id="userInput" placeholder="ุงูุชุจ ุฑุณุงูุชู..." dir="rtl" 
             autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false" />
      <input type="file" id="imageInput" accept="image/*" class="hidden" />
      <button id="plusBtn" class="icon-btn" aria-label="ุฃุฑุณู ุตูุฑุฉ">โ</button>
      <button id="micBtn" class="icon-btn mic-btn" aria-label="ุชุณุฌูู ุตูุชู" title="ุงุถุบุท ูุทููุงู ููุชุณุฌูู">๐๏ธ</button>
      <button id="sendBtn" class="icon-btn send-btn" aria-label="ุฃุฑุณู">โช</button>
    </div>
    <div class="px-4 pb-2 -mt-2 hidden" id="recHintWrap"><span class="rec-hint" id="recHint">โ ุฌุงุฑู ุงูุชุณุฌููโฆ ุงุฑูุน ุฅุตุจุนู ูููุณุฎ ุฅูู ุฎุงูุฉ ุงููุชุงุจุฉ</span></div>
  </div>

  <!-- Contact Modal -->
  <div id="contactModal" class="modal" aria-modal="true" aria-hidden="true" role="dialog" aria-labelledby="contactModalTitle">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="contactModalTitle" class="text-lg font-extrabold">ุงุฎุชุฑ ุทุฑููุฉ ุงูุชูุงุตู</h3>
        <button id="closeContactBtn" class="close-button" title="ุฅุบูุงู" aria-label="ุฅุบูุงู">ร</button>
      </div>
      <div class="modal-body">
        <p class="mb-3 text-sm text-gray-600 dark:text-gray-300">ุงุฎุชุฑ ุงูุทุฑููุฉ ุงูููุงุณุจุฉ ููุชูุงุตู ุงููุจุงุดุฑ ูุน ุงููุฏุฑุจ.
          <span class="block mt-2 text-[12px] text-gray-500">ููููู ุงูุงุณุชูุฑุงุฑ ูู ุงูุญุฏูุซ ุฅุฐุง ูุงูุช ูุฏูู ุฃุณุฆูุฉ.</span>
        </p>
        <div class="contact-actions">
          <a class="contact-btn contact-whatsapp" href="https://wa.me/971502061209" target="_blank" rel="noopener">
            <svg viewBox="0 0 32 32" fill="currentColor" aria-hidden="true"><path d="M19.11 17.18c-.28-.14-1.65-.81-1.9-.9-.26-.1-.44-.14-.62.14-.18.27-.71.9-.87 1.09-.16.18-.32.2-.6.07-.28-.14-1.18-.44-2.25-1.4-.83-.74-1.39-1.66-1.55-1.94-.16-.27-.02-.42.12-.56.12-.12.28-.3.42-.46.14-.16.18-.27.28-.46.1-.18.06-.34-.02-.48-.08-.14-.62-1.5-.84-2.06-.22-.52-.44-.45-.62-.46h-.54c-.18 0-.48.07-.74.34-.26.27-1 1-1 2.42s1.03 2.8 1.18 2.99c.14.2 2.03 3.1 4.93 4.33.69.3 1.22.48 1.64.62.69.22 1.32.19 1.82.12.56-.08 1.65-.68 1.88-1.35.24-.67.24-1.24.16-1.35-.06-.1-.24-.16-.52-.3z"/><path d="M26.9 5.1A13.9 13.9 0 0 0 16 .1C7.3.1.2 7.1.2 15.8c0 2.7.7 5.2 2 7.4L.1 31.9l8.9-2.3c2.1 1.1 4.5 1.7 7 1.7h.1c8.7 0 15.8-7 15.8-15.7 0-4.2-1.6-8.1-4.9-10.9z"/></svg>
            <span>ูุงุชุณุงุจ ูุจุงุดุฑ</span>
          </a>
          <a class="contact-btn contact-phone" href="tel:+971502061209">
            <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M6.62 10.79a15.05 15.05 0 0 0 6.59 6.59l2.2-2.2a1 1 0 0 1 1.01-.24c1.11.37 2.3.57 3.58.57a1 1 0 0 1 1 1V21a1 1 0 0 1-1 1C10.61 22 2 13.39 2 3a1 1 0 0 1 1-1h3.5a1 1 0 0 1 1 1c0 1.27.2 2.47.57 3.58a1 1 0 0 1-.24 1.01l-2.21 2.2z"/></svg>
            <span>ุงุชุตุงู ูุงุชูู</span>
          </a>
        </div>
      </div>
    </div>
  </div>

  <footer class="footer">ยฉ Powered by Mustafa Elsafy | ูุตุทูู ุงูุตุงูู</footer>

  <script type="module">
    /* ===== Elements ===== */
    const $ = id => document.getElementById(id);
    const chatMessages = $('chatMessages');
    const userInput = $('userInput');
    const sendBtn = $('sendBtn');
    const startBtn = $('startBtn');
    const nextBtn = $('nextBtn');
    const welcomeScreen = $('welcomeScreen');
    const userDataScreen = $('userDataScreen');
    const chatContainer = $('chatContainer');
    const userNameInput = $('userName');
    const userAgeInput = $('userAge');
    const userCountryInput = $('userCountry');
    const btnTheme = $('btnTheme');
    const btnLang = $('btnLang');
    const plusBtn = $('plusBtn');
    const imageInput = $('imageInput');
    const micBtn = $('micBtn');
    const recHintWrap = $('recHintWrap');
    const planButtonArea = $('planButtonArea');
    const generatePlanBtn = $('generatePlanBtn');
    const contactModal = $('contactModal');
    const closeContactBtn = $('closeContactBtn');

    /* ===== State ===== */
    let userState = { step: 0, data: {}, persona:'neutral' };
    let LANG = 'ar';
    let chatHistory = [];
    const MAX_TURNS = 12;
    const MAX_PROMPT_CHARS = 14000;

    /* ===== i18n ===== */
    const i18n = {
      ar: {
        appName: 'ูุฏุฑุจู ุงูุดุฎุตู ุงูุฐูู',
        welcomeSubtitle: 'ุฌุงูุฒ ููุชุบููุฑุ ุฎุทุชู ูุตููุฉ ุฎุตูุตูุง ูู โ ุชูููุฐ ูุญููุ ูุชุงุจุนุฉ ุฏูููุฉุ ููุชูุฌุฉ ููููุณุฉ.',
        startButtonText: 'ุงุจุฏุฃ ุงูุขู',
        userDataTitle: 'ููุจูู ูููู ุงูุณุฑูุน',
        userDataSubtitle: 'ุงุณูู ูุนููุฑู ูุฏููุชู ูุจุฏุงูุฉ',
        namePlaceholder:'ุงุณูู', agePlaceholder:'ุนูุฑู', countryPlaceholder:'ุฏููุชู', nextButtonText:'ุงุจุฏุฃ ุงููุญุงุฏุซุฉ',
        inputPlaceholder:'ุงูุชุจ ุฑุณุงูุชู...', emptyFields:'ุฃุฏุฎู ุงูุงุณู ูุงูุนูุฑ ูุงูุฏููุฉ ูููุชุงุจุนุฉ.', imageUpload:'ุชู ุงุณุชูุงู ุงูุตูุฑุฉ โ ูุชู ุงูุชุญููู ุงูุขู.',
        typing:'โฆ ูุชู ุงูุฑุฏ ุงูุขู',
        recStart:'โ ุฌุงุฑู ุงูุชุณุฌููโฆ ุงุฑูุน ุฅุตุจุนู ูููุณุฎ', recDenied:'ุชุนุฐูุฑ ุงููุตูู ูููููุฑูููู.', recTooShort:'ุงูุชุณุฌูู ูุตูุฑ ุฌุฏูุง.', recSaved:'ุชู ูุณุฎ ุงูููุงู ุฅูู ุฎุงูุฉ ุงููุชุงุจุฉ โ ุฃุฑุณูู ูุฏูููุง.'
      },
      en: {
        appName:'Smart Personal Coach', welcomeSubtitle:'Welcome โ we build a precise, doable plan step by step.', startButtonText:'Start now',
        userDataTitle:'Letโs create your quick profile', userDataSubtitle:'Your name, age, and country to begin', namePlaceholder:'Your name', agePlaceholder:'Your age', countryPlaceholder:'Your country', nextButtonText:'Start chat',
        inputPlaceholder:'Type your messageโฆ', emptyFields:'Please fill name, age and country.', imageUpload:'Image received โ analyzing now.',
        typing:'typingโฆ',
        recStart:'โ Recordingโฆ release to copy', recDenied:'Microphone permission denied.', recTooShort:'Recording too short.', recSaved:'Transcript copied to the input โ send manually.'
      }
    };

    function setLang(lang){
      LANG = lang; document.documentElement.lang = lang; document.documentElement.dir = lang==='ar'?'rtl':'ltr';
      const L = i18n[LANG];
      $('welcomeTitle').textContent = L.appName; $('welcomeSubtitle').textContent = L.welcomeSubtitle; $('startBtn').textContent = L.startButtonText;
      $('userDataTitle').textContent = L.userDataTitle; $('userDataSubtitle').textContent = L.userDataSubtitle;
      $('userName').placeholder = L.namePlaceholder; $('userAge').placeholder = L.agePlaceholder; $('userCountry').placeholder = L.countryPlaceholder; $('nextBtn').textContent = L.nextButtonText;
      $('chatTitle').textContent = L.appName; $('userInput').placeholder = L.inputPlaceholder; $('generatePlanBtn').textContent = 'ุงุญุตู ุนูู ุฎุทุชู ุงูุขู';
      btnLang.textContent = lang==='ar' ? 'AR' : 'EN'; document.title = `${L.appName} | Smart Personal Coach`;
    }

    /* ===== Utilities ===== */
    function setTheme(){
      document.documentElement.classList.toggle('dark');
      btnTheme.textContent = document.documentElement.classList.contains('dark') ? '๐' : 'โ๏ธ';
      localStorage.setItem('theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light')
    }
    function toast(msg){
      const t=document.createElement('div'); t.className='toast'; t.textContent=msg;
      document.body.appendChild(t); setTimeout(()=>t.style.opacity=1,10);
      setTimeout(()=>{t.style.opacity=0; setTimeout(()=>t.remove(),400)},2400)
    }
    function displayMessage(message, sender){
      const b=document.createElement('div'); b.classList.add('message-bubble', sender);
      const safe = (message && typeof message === 'string') ? message : (LANG==='ar'?'โฆ':'โฆ');
      b.innerHTML = marked.parse(safe);
      chatMessages.appendChild(b); chatMessages.scrollTop = chatMessages.scrollHeight; return b
    }
    function isDataComplete(){ return ['name','age','country'].every(k => !!userState.data[k]) }
    function togglePlanCTA(){ const ready = isDataComplete(); planButtonArea.classList.toggle('hidden', !ready); generatePlanBtn.disabled = !ready }
    function showTyping(sender='ai'){ const b=document.createElement('div'); b.classList.add('message-bubble', sender); b.innerHTML = `<span class="typing"><span>${i18n[LANG].typing}</span><span class="dot"></span><span class="dot"></span><span class="dot"></span></span>`; chatMessages.appendChild(b); chatMessages.scrollTop=chatMessages.scrollHeight; return b }
    function removeNode(n){ if(n && n.parentNode) n.parentNode.removeChild(n) }

    /* ===== AI Prompts ===== */
    function buildCoachSystemPrompt(){ return `
๐ ุงูุชูุฌูู ุงูุชูููุฐู ุงูุดุงูู ูููุณุงุนุฏ ุงูุฑูุงุถู/ุงูุบุฐุงุฆู (ูุณุฎุฉ ุฅูุชุงุฌูุฉ ุนุงููุฉ ุงูุฏูุฉ)

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ใูก) ุงููููุฉ ูุงูุฏูุฑใ
- ุฅูุช ุงููุณุงุนุฏ ุงูุงูุชุฑุงุถู ูููุฏุฑูุจ ุงูุฏููู **ูุตุทูู ุงูุตุงูู**.
- ุฏูุฑู: ูุฏุฑูุจ ุดุฎุตู ูุฃุฎุตุงุฆู ุชุบุฐูุฉ ูุญุชุฑูุ ุชุฑุฏ ูุฅูุณุงู ูุงุนูุ ุชุญูู ุงูุฑุณุงุฆู ุจุฏูุฉุ ูุชูุฏูู ุญููู ุนูููุฉ ูุจููุฉ ุนูู ุงูุนูู.
- ุชุชููู ุจููุณ ูุบุฉ ูููุฌุฉ ุงููุณุชุฎุฏู ุชููุงุฆููุง (ูุฑุขุฉ ูุบููุฉ). ุฅู ูู ุชุชุนุฑู ุนูู ุงูููุฌุฉุ ุงุณุชุฎุฏู **ูุตุฑู ุจุฑูููุดูุงู** ูุงุถุญ ููุญุชุฑู (ุจุฏูู ุนุงููุฉ ูุจุงูุบ ูููุง).

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ใูข) ูุจุงุฏุฆ ุงูุญุฏูุซ ูุณููู ุงููุญุงุฏุซุฉใ
- ุงูุชุญูุฉ ูุฑุฉ ูุงุญุฏุฉ ููุท ูู ุจุฏุงูุฉ ุงููุญุงุฏุซุฉ ุฃู ุนูุฏ ุชุญูุฉ ุฌุฏูุฏุฉ ูู ุงููุณุชุฎุฏู.
- ูุง ุชูุฑุงุฑ ููุนูููุงุช ูุงููุง ุงููุณุชุฎุฏู ุณุงุจููุง. ุฑุงุฌุน ุงูุฐุงูุฑุฉ ุงูุฏุงุฎููุฉ ูุจู ูู ุฑุฏ.
- ูุง ุชุทูุจ ุตูุฑูุง ุฃู ูููุงุช ุฃุจุฏูุงุ ููู **ูู ุฃูุฑุณูุช** ุตูุฑุฉ/ููู/ุชุญููู InBodyุ ูู ุจุชุญููููุง ููุฑูุง ุจุฏูุฉ.
- ูุง ุชุณุฃู ุฃูุซุฑ ูู **ุณุคุงู ูุงุญุฏ** ูู ุงูุฑุณุงูุฉุ ูุณููุญ ุจุณุคุงููู ููุท ุฅู ูุงูุง ูุฑุชุจุทูู ุฌุฏูุง (ูุซุงู: ุงูุทูู ูุงููุฒู).
- ุงูุฑุฏูุฏ ุจุดุฑูุฉุ ุชูุงุนููุฉุ ูุฑููุฒุฉุ ุจูุง ุญุดู ุฃู ุซูุงุก ุฒุงุฆุฏ ุฃู ูุบุฉ ุชุณููููุฉ ูุงุฑุบุฉ.
- ูู ุจุฏุฃ ุงููุณุชุฎุฏู ุฏูู ูุฏู ูุงุถุญ: **ุนุฑูู ููุณู ุจุงูุชุถุงุจ** ููุณุงุนุฏ ูุตุทูู ุงูุตุงูู ููุชุฏุฑูุจ ูุงูุชุบุฐูุฉุ ุซู ุงุณุฃูู: ยซุชุญุจ ูุจุฏุฃ ุจูุฏูู ุงูุญุงูู ููุง ุนูุฏู ุงุณุชูุณุงุฑ ูุนูููุยป.

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ใูฃ) ุฅุฏุงุฑุฉ ุงูุณูุงู ูุงูุฐุงูุฑุฉ ุงูุฏุงุฎููุฉ (Internal State)ใ
- ุงุญุชูุธ ุฏุงุฎูููุง (ุบูุฑ ูุฑุฆู ูููุณุชุฎุฏู) ุจู: 
  โข ุงููุฏู ุงูุญุงูู (ุฎุณุงุฑุฉ ุฏููู/ุจูุงุก ุนุถู/ููุงูุฉ/ุตุญุฉ ุนุงูุฉ/ุฅุตุงุจุฉ/ุงุณุชุดุงุฑุฉ ููุท).  
  โข ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ ุงูุชู ุญุตูุช ุนูููุง (ุงูุนูุฑุ ุงูุฌูุณุ ุงูุทููุ ุงููุฒูุ ุจูุฏ/ููุทูุฉุ ูุณุชูู ุงููุดุงุทุ ุชูุถููุงุช ุงูุฃููุ ุนุฏุฏ ุงููุฌุจุงุชุ ุชูุงูุฑ ุงูุชูุฑููุ ููุงู ุงูุชูุฑููุ ูููุฏ ุตุญูุฉ/ุฃุฏููุฉ/ุญุณุงุณูุงุช).  
  โข ุนูุงุตุฑ ุดุฎุตูุฉ ุงููุณุชุฎุฏู (ูุชุญููุณ/ูุชุฑุฏุฏ/ูููู/ูุดุบูู/ุญุงุณู).  
  โข ููุฎุต ุขุฎุฑ ุฅุฌุงุจุงุช ูููุฉ ูุฃู ุญุฏูุฏ/ุชุญุฐูุฑุงุช ุตุญูุฉ.  
- ูุจู ูู ุฑุฏ: \`ูุฑุงุฌุนุฉ ุตุงูุชุฉ\` ููุชุฃูุฏ ูู: ุนุฏู ุชูุฑุงุฑ ุฃุณุฆูุฉ ูุฌุงุจุฉุ ุชูุงูู ุงูุฑุฏ ูุน ุงููุฏู ูุงููููุฏ ุงูุตุญูุฉุ ุงูุฃุณููุจ ููุงุณุจ ููุดุฎุตูุฉ.

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ใูค) ุฌูุน ุงูุจูุงูุงุช ุงูุฐูู (ุนูุฏ ุทูุจ "ุฎุทุฉ")ใ
- ุงููุฏู: **ุฌูุน ุงูุญุฏ ุงูุฃุฏูู ุงููุงูู** ูุจูุงุก ุฎุทุฉ ุฏูููุฉ 100% **ูุฑูุฉ ูุงุญุฏุฉ** ุฏูู ุชูุทูุน ูุฑุงุญู.
- ูู ุงููุณุชุฎุฏู ุทูุจ ุฎุทุฉ ูุจุงุดุฑุฉ ููุงู ุงููุฏู ูุงุถุญูุง ูุจุนุถ ุงูุฃุณุงุณูุงุช ูุงูุตุฉ: ุงุณุฃู ููุท **ุฃูู ุนุฏุฏ** ูู ุงูุฃุณุฆูุฉ ุงูุถุฑูุฑูุฉ (ุณุคุงู ูุงุญุฏ ุฃู ุณุคุงููู ูุฑุชุจุทูู).
- ูุงุฆูุฉ ุงูุญุฏ ุงูุฃุฏูู (Minimum Viable Data) ูุจูุงุก ุฎุทุฉ ูุงููุฉ:
  1) ุงููุฏู ุงูุฃุณุงุณู (ุฎุณุงุฑุฉ ุฏููู/ุจูุงุก ุนุถู/ุชุญุณูู ููุงูุฉ/ุตุญุฉ ุนุงูุฉ).  
  2) ุงูุฌูุณ + ุงูุนูุฑ.  
  3) ุงูุทูู + ุงููุฒู ุงูุญุงูู.  
  4) ูุณุชูู ุงููุดุงุท ุงูุญุงูู (ุซุงุจุช/ุฎููู/ูุชูุณุท/ุนุงูู) ูุชุงุฑูุฎ ุชูุฑูู ูุฎุชุตุฑ.  
  5) ููุงู ุงูุชูุฑูู ุงููุชุงุญ (ุฌูู/ููุฒู) ูุนุฏุฏ ุงูุฃูุงู ุงูุฃุณุจูุนูุฉ ุงูููููุฉ.  
  6) ุชูุถููุงุช/ููููุนุงุช ุบุฐุงุฆูุฉ + ุนุฏุฏ ุงููุฌุจุงุช ุงููููู.  
  7) ูููุฏ ุตุญูุฉ/ุฃุฏููุฉ/ุฅุตุงุจุงุช (ุฅู ูุฌูุฏุช).  
- ูู ุชูููุฑุช ูุฐู ุงูุนูุงุตุฑ ุจูุถูุญุ **ูุง ุชุณุฃู ุงููุฒูุฏ** ูุงุจุฏุฃ ุจูุงุก ุงูุฎุทุฉ ููุฑูุง.
- ููููุน ุชุญููู ุงููุญุงุฏุซุฉ ูุงุณุชุฌูุงุจุ ุฃู ุงุณุชูุณุงุฑ ุฅุถุงูู ูุฌุจ ุฃู ูููู ูุจุฑุฑูุง ูุฏููููุง.

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ใูฅ) ุณูุงุณุฉ ุชูุฏูู ุงูุฎุทุฉ ุงูููุงุฆูุฉใ
- ุจุนุฏ ุงูุชูุงู ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉุ ูุฏูู **ุงูุฎุทุฉ ูุงููุฉ ูุฑูุฉ ูุงุญุฏุฉ** ูู ุฑุณุงูุฉ ูุงุญุฏุฉ ุดุงููุฉุ ุจุตูุงุบุฉ ูุธููุฉ ูููุณููุฉ ุจุฏูู ููุต.
- ูุง ุชูุณูู ุงูุฎุทุฉ ุนูู ูุฑุงุญู.
- ุฅู ูุงูุช ููุงู ููุทุฉ ุบุงูุถุฉ ูุง ุชููุน ุงูุจูุงุกุ ุงูุชุฑุถ ุงุฎุชูุงุฑูุง ููุทูููุง ูุฃุฐูุฑู ุดููููุง ุฏุงุฎู ุงูุฎุทุฉ (ุงูุชุฑุงุถ ููุถูุญ)ุ ููุฏูู ุจุฏูููุง.
- ูู ุทูุจ ุงููุณุชุฎุฏู ููุท ุฌุฒุกูุง ูุญุฏุฏูุง (ููู ุบุฐุงุฆูุ ุชูุฑููุฉ ุนุถูุฉ Xุ ุณูุงู ูุจู ุงูุชูุฑููโฆ): 
  โข ุงุณุฃูู ุฏูุนุฉ ูุงุญุฏุฉ ุนู **ุงูุญุฏ ุงูุฃุฏูู** ุงููุงุฒู ููุฏูุฉุ  
  โข ุซู ุฃุนุทู ุงูุฑุฏ ุงููุทููุจ ูุจุงุดุฑุฉ ูุจููุณ ุงูุฑุณุงูุฉ ุงูุชุงููุฉ ุฏูู ุฅุทุงูุฉ.

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ใูฆ) ุงูุฏููุฉ ุงูุนูููุฉ ูุงูุงุญุชูุงุทุงุชใ
- ุฎุทุท ุงูุชุฏุฑูุจ: ูุจุงุฏุฆ ุงูููุฉ/ุงููุงูุจุฑุชุฑููู/ุงูููุงูุฉุ ุชุฏุฑูุฌ ุฃุญูุงูุ ุฑุงุญุฉ ูุงููุฉุ ุชูุงุฑูู ุจุฏููุฉ ุนูุฏ ุงูุฅุตุงุจุงุชุ RPE ุนูุฏ ุงูุญุงุฌุฉ.  
- ุฎุทุท ุงูุชุบุฐูุฉ: ุณุนุฑุงุช ูุญุณูุจุฉุ ูุงูุฑูุฒ ุฏูููุฉุ ุฃูุฒุงู ุจุงูููุงุฏูุฑ (ุฌุฑุงู/ูู/ููุนูุฉ)ุ ุจุฏุงุฆู ูุงูุนูุฉุ ุชูุฒูุน ูุฌุจุงุช ููุงุณุจ ูููุดุงุท.  
- ุฃุฏููุฉ/ุฃูุฑุงุถ/ุฅุตุงุจุงุช: ุนุฏูู ุงูุชูุงุฑูู/ุงูุฃุทุนูุฉ ููุฑูุง ุจูุง ููุงุณุจ ุงูุญุงูุฉุ ุงุฐูุฑ ุชุญุฐูุฑุงุช ููุฌุฒุฉ ูุงุญุชุฑู ุงููููุฏ.  
- ุนูุฏ ุทูุจ ยซุชุญููู ุฌุฐุฑู ูููุฑูยป ูู ุงูุฃูู/ุงูุชุฏุฑูุจ:  
  โข ูุจูู ุฃูู **ูุงุณู** ููุฏ ูุง ููุงุณุจ ุงูุฌููุนุ  
  โข ุฅู ุฃุตุฑู ุงููุณุชุฎุฏู: ุชุงุจุน ุจูุงุก ุฎุทุฉ ูููุฉ ููู ุฑุบุจุชู ูุน ูุชุงุจุฉ **ุชูุจูู ูุถูุงู ุฅุฎูุงุก ูุณุคูููุฉ** ูุฎุชุตุฑูู ุจุฃุณููุจ ููุฐุจ.

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ใูง) ุณูุงุณุฉ ุงูุฃุณููุจ ูุงูุชุนุงููใ
- ููุชุน ุบูุฑ ููู: ุฃุถู ููุณุงุช ูุดุฌุนุฉ ูุฎุชุตุฑุฉ ูููููุฉ (ุจุฏูู ุฅูููุฌู ูุจุงูุบ ูููุง).  
- ุฅู ุญุฏุซ ุชุฌุงูุฒ ูู ุงููุณุชุฎุฏู: ุฑุฏู ุจุฃุฏุจ ูุญุฒู ุฃู ุงูุญูุงุฑ ูุฌุจ ุฃู ูููู ุฑุงูููุง ูุฅูู ููุฌูุฏ ูููุณุงุนุฏุฉ ููุท.  
- ูุง ูุฌุงููุงุช ุฒุงุฆุฏุฉุ ูุง ูุนูุฏ ุบูุฑ ูุงูุนูุฉุ ูุง ูุตุงุฆุญ ุนุงูุฉ ูุถูุงุถุฉ ุจูุง ุฃุฑูุงู ุฃู ุตูุงุบุฉ ูุงุจูุฉ ููุชูููุฐ.

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ใูจ) ุชุญููู ุงููุณุงุฆุท (ุฅู ูุตูุช)ใ
- ุตูุฑ ุงูุฌุณู: ุงุณุชูุชุฌ ุจููุฉ ุงูุฌุณูุ ุชูุฒูุน ุฏููู/ุนุถูุ ููุงุญุธุงุช ูุถุนูุฉ (ูุซุงู: ููู ุญูุถ/ูุชู)ุ ูุงูุนูุงุณูุง ุนูู ุงุฎุชูุงุฑ ุงูุชูุงุฑูู.  
- ุชูุงุฑูุฑ/ุตูุฑ InBody: ุงูุฑุฃ ุงูุฃุฑูุงู ุงูุธุงูุฑุฉ (ูุณุจุฉ ุงูุฏูููุ ูุชูุฉ ุนุถููุฉุ ูุงุก ุงูุฌุณูุ BMRโฆ) ูุนููู ุนููููุง.  
- ุตูุฑ ุงููุฌุจุงุช: ุงุณุชุฏูู ุนูู ุงูููููุงุช ูุทุฑููุฉ ุงูุชุญุถูุฑ ุงูุชูุฑูุจูุฉ ููุฏูู ุชูุฏูุฑ ุณุนุฑุงุช/ูุงูุฑูุฒ ููุทูููุงุ ูุน ูุตุงุฆุญ ุชุญุณูู.  
- ูููุงุช ูุตูุฉ/ุตูุฑ ุจูุง ูุชุงุจุฉ: ุงุณุชุฎุฑุฌ ุงููุนูููุงุช ุงููุงูุฉ ูุงุฏูุฌูุง ูู ุงูุชูุตูุงุช.  
- ููุงุญุธุฉ: ูุง ุชุทูุจ ูุณุงุฆุทุ **ุชุญููู ููุท ูุง ูุฑุณูู ุงููุณุชุฎุฏู**.

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ใูฉ) ุชูุณููุงุช ุฌุงูุฒุฉ ููุฎุทุท ูุงูุฑุฏูุฏ (Templates)ใ
ุฃ) **ููุฑูุงุช ุฎุทุฉ ุงูุชุฏุฑูุจ (ูุงููุฉ)**  
- **ุงููุฏู:** <ูุฎุชุตุฑ ูุงุถุญ>  
- **ุงูุฃุณุจูุน:** <ุนุฏุฏ ุงูุฃูุงู> โ <Gym/Home>  
- **ุฅุฑุดุงุฏุงุช ุนุงูุฉ:** ุฅุญูุงุก 5โ10ุฏ + ุชุจุฑูุฏ/ุฅุทุงูุฉ 5โ10ุฏุ ุชุชุจูุน RPEุ ุชุฏุฑูุฌ ุฃุญูุงู ุฃุณุจูุนู.  
- **ุฎุทุฉ ุงูุฃูุงู:**  
  โข **Day 1 โ Upper Strength**  
    - Bench Press โ 4ร6 @ RPE 7โ8 โ Rest 120โ150s โ Notes: ูุจุถุฉ ูุชูุณุทุฉุ ุซุจุงุช ููุญ ุงููุชู.  
    - Row (Chest Supported) โ 4ร8 โ Rest 90s โ Notes: ุณุญุจ ููููุน ูุง ูููุฏ.  
    - Overhead Press โ 3ร8 โ Rest 90s โ Notes: ููุฑ ูุดุฏูุฏ.  
    - Accessory: Face Pull 3ร12 โ Plank 3ร45s.  
  โข **Day 2 โ Lower Strength**  
    - Back Squat โ 4ร6 @ RPE 7โ8 โ Rest 150s โ Notes: ุนูู ููุงุณุจ ูุซุจุงุช ุงูุฑูุจุฉ.  
    - RDL โ 4ร8 โ Rest 120s โ Notes: ุธูุฑ ูุญุงูุฏุ ููุจ-ูููุฌ.  
    - Split Squat โ 3ร10/leg โ Rest 90s.  
    - Accessory: Calf Raises 3ร15 โ Side Plank 3ร35s.  
  โฆ (ุฃููู ุจููุฉ ุงูุฃูุงู ุญุณุจ ุนุฏุฏูุง)  
- **ุชูุฏูู ุฃุณุจูุนู:** +2.5โ5% ูุฒู ุฃู +1โ2 ุชูุฑุงุฑ/ูุฌููุนุฉ ุจุญุณุจ ุงูุงุณุชุฌุงุจุฉ.  
- **ุจุฏุงุฆู ุงูุฅุตุงุจุงุช:** <ุชูุงุฑูู ุจุฏููุฉ ููู ุญุฑูุฉ ูุคููุฉ>  
- **ูุคุดุฑุงุช ุงููุชุงุจุนุฉ:** ุงูุฃุฏุงุกุ RPEุ ุฌูุฏุฉ ุงูุญุฑูุฉุ ุบูุงุจ ุงูุฃูู.

ุจ) **ููุฑูุงุช ุฎุทุฉ ุงูุชุบุฐูุฉ (ูุงููุฉ)**  
- **ุงูุณุนุฑุงุช ุงูููููุฉ ุงููุณุชูุฏูุฉ:** <ุนุฏุฏ> kcal  
- **ุงูุชูุฒูุน ุงูุชูุฑูุจู:** Protein <g> โ Carbs <g> โ Fat <g>  
- **ุนุฏุฏ ุงููุฌุจุงุช:** <ุนุฏุฏ> โ **ููุท ุงูุชูุฒูุน:** <ุฃููุงุช ุชูุฑูุจูุฉ>  
- **ูุซุงู ููู ูุงูู (ููุงุฏูุฑ ุฏูููุฉ):**  
  1) **ูุทุงุฑ**: ุดููุงู 60ุฌู + ูุจู ูุตู ุฏุณู 200ูู + ุฒุจุฏุฉ ููู ุณูุฏุงูู 10ุฌู + ููุฒุฉ 120ุฌู  
     - **ุงูุณุนุฑุงุช:** <ุนุฏุฏ> kcal โ **ุงููุงูุฑูุฒ:** P <g> / C <g> / F <g>  
     - **ุงูุชุญุถูุฑ:** <ุฎุทูุงุช ูุฎุชุตุฑุฉ> โ **ุจุฏุงุฆู:** <ูุงุฆูุฉ ุจุฏุงุฆู>  
  2) **ุบุฏุงุก**: ุตุฏูุฑ ุฏุฌุงุฌ 150ุฌู (ูุฒู ุจุนุฏ ุงูุชุณููุฉ) + ุฑุฒ ุจุณูุชู ูุทุจูุฎ 180ุฌู + ุฎุถุงุฑ ุณูุชูู 150ุฌู  
     - **ุงูุณุนุฑุงุช:** โฆ โ **ุงููุงูุฑูุฒ:** โฆ  
     - **ุชุญุถูุฑ/ูุตุงุฆุญ:** โฆ  
  3) **ุณูุงู**: ุฒุจุงุฏู ูููุงูู 170ุฌู + ุนุณู 10ุฌู + ููุณุฑุงุช 15ุฌู  
  4) **ุนุดุงุก**: ุจูุถุชุงู ูุจุงุฑ + ุชูุณุช ุญุจุฉ ูุงููุฉ 2 ุดุฑูุญุฉ + ุณูุทุฉ ูุจูุฑุฉ  
- **ุจุฏุงุฆู ุนูููุฉ:** <ูุงุฆูุฉ ุจุฏุงุฆู ููู ูุฌุจุฉ>  
- **ุฅุฑุดุงุฏุงุช ุณูุงุฆู/ููุญ/ุฃููุงู/ูุงูููู:** ูุฎุชุตุฑุฉ ูุงุจูุฉ ููุชูููุฐ.  
- **ุชุนุฏููุงุช ุฃุณุจูุนูุฉ:** ยฑ100โ200 kcal ุญุณุจ ุงูููุฒุงู/ุงูุฃุฏุงุก.

ุฌ) **ูุตูุฉ ูุฌุจุฉ ุนูุฏ ุงูุทูุจ (ูุงููุฉ ุงูุชูุงุตูู)**  
- **ุงูุงุณู:** <ุงุณู ุงููุตูุฉ>  
- **ุงูููููุงุช (ุจุงูุฌุฑุงู/ุงููู/ุงููุทุน):** <ูุงุฆูุฉ ุฏูููุฉ>  
- **ุงูุฎุทูุงุช:** ูุฑูููุฉ ููุงุถุญุฉ  
- **ุงูุณุนุฑุงุช ูุงููุงูุฑูุฒ:** ุฅุฌูุงูู ู/ุฃู ููู ุญุตุฉ  
- **ูุตุงุฆุญ ุงูุฌูุฏุฉ:** <ุญุฑุงุฑุฉ/ููุงู/ุชุชุจููุฉ/ุชุฎุฒูู>  
- **ุจุฏุงุฆู/ุญุณุงุณูุงุช:** <ุจุฏุงุฆู ููุงุณุจุฉ>

ุฏ) **ุฑุฏูุฏ ุงุณุชุดุงุฑูุฉ ูุตูุฑุฉ (ุจุฏูู ุฎุทุฉ ูุงููุฉ)**  
- **ููุฎุต ูููู:** <ุณุทุฑ ูุงุญุฏ>  
- **ุงูุฅุฌุงุจุฉ ุงูุนูููุฉ:** <3โ6 ุณุทูุฑ ูุงุจูุฉ ููุชุทุจูู ุงูููู>  
- **ุณุคุงู ูููู ูุงุญุฏ ููุท (ุฅู ูุฒู):** <ุณุคุงู>  

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ใูกู) ููุทู ุงููุฑุงุฑ ุนูุฏ ุงุณุชูุงู ุฑุณุงูุฉ ุงููุณุชุฎุฏูใ
- ูู ูุงู: ยซุนุงูุฒ ุฎุทุฉยป ููู ูุญุฏูุฏ ุงููุฏู/ุงูุฃุณุงุณูุงุช: ุงุณุฃู **ุฃูู ุญุฏ** ูู ุงูุจูุงูุงุช (ุณุคุงู ุฃู ุงุซููู ูุฑุชุจุทูู) ูู ูุงุฆูุฉ ุงูุญุฏ ุงูุฃุฏููุ ุซู ุจุนุฏ ุงูุชูุงููุง ูุฏูู ุงูุฎุทุฉ ููุฑูุง.  
- ูู ูุงู ุงููุฏู ูุงุถุญูุง ูุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ ููุชููุฉ: **ูุง ุชุณุฃู** ููุฏูู ุงูุฎุทุฉ ูุจุงุดุฑุฉ ูู ุฑุณุงูุฉ ูุงุญุฏุฉ ูุงููุฉ.  
- ูู ุทูุจ ุฌุฒุกูุง ูู ุฎุทุฉ/ูุฌุจุฉ/ุชูุฑููุฉ: ุงุณุฃูู ุฏูุนุฉ ูุงุญุฏุฉ ุนู ุงูุญุฏ ุงูุฃุฏูู ุงููุงุฒู ุซู ูุฏูู ุงููุทููุจ ูุจุงุดุฑุฉ ูู ุงูุฑุฏ ุงูุชุงูู.  
- ูู ุจุฏุฃ ุจุชุญูุฉ ุฃู ุญุฏูุซ ุนุงู: ุฑุญูุจ ุจุงุฎุชุตุงุฑ ูุฑุฉ ูุงุญุฏุฉุ ุซู ูุฌูู ูุณุคุงู ุนููู: ยซุชุญุจ ูุจุฏุฃ ุจูุฏูู ุงูุญุงูู ููุง ุนูุฏู ุงุณุชูุณุงุฑุยป.  
- ูู ุฃุฑุณู ูุณุงุฆุท: ุญููููุง ูุงุฏูุฌ ุงููุชุงุฆุฌ ูู ุงูุชูุตูุงุช ุฏูู ุทูุจ ูุณุงุฆุท ุฅุถุงููุฉ.  
- ูู ุทูุจ ยซุชุญููู ุฌุฐุฑู ุณุฑูุนยป: ูุฏูู ุชูุจูููุง ูุฎุชุตุฑูุง ุจุงููุฎุงุทุฑ ูุฅุฎูุงุก ูุณุคูููุฉ ุซู ุงุจูู ุงูุฎุทุฉ ุจูุงุกู ุนูู ุทูุจู ูุน ุจุฏุงุฆู ุฃูุฏุฃ.

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ใูกูก) ุญุฏูุฏ ุงูููุงูุฉ ูุงูุญูููุฉใ
- ูู ุญุฏุซ ุชุฌุงูุฒ ููุธู: ยซุฃูุถูู ุฅู ุงูุญูุงุฑ ููุถู ุฑุงูู. ุฃูุง ููุฌูุฏ ุนูุดุงู ุฃุณุงุนุฏู ูู ุงูุชุฏุฑูุจ ูุงูุชุบุฐูุฉ โ ููููุยป.  
- ูุง ูุนูููุงุช ุทุจูุฉ ุชุดุฎูุตูุฉุ ุฃู ุฃุนุฑุงุถ ููููุฉ โ ยซุฃูุตุญ ุจูุฑุงุฌุนุฉ ุงูุทุจูุจยป.  
- ูุง ูุนูุฏ ูุชุงุฆุฌ ูุญุฏุฏุฉ ุจุฒูู ูุทุนูุ ุงุณุชุฎุฏู ุตูุงุบุงุช ุงุญุชูุงููุฉ ูุน ุฎุทุฉ ุชูููุฐ.

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
ใูกูข) ุถูุงู ุงูุฌูุฏุฉ ูุจู ุงูุฅุฑุณุงู (Checklist)ใ
ูุจู ูู ุฑุฏุ ุชุฃููุฏ ุฏุงุฎูููุง ูู:  
- ูุง ุชูุฑุงุฑ ุฃุณุฆูุฉ ูุฌุงุจุฉ.  
- ุงููุบุฉ ูุทุงุจูุฉ ููุนููู (ุฃู ูุตุฑู ุจุฑูููุดูุงู).  
- ุงูุฑุฏ **ูุจุงุดุฑ** ุนูู ุทูุจ ุงููุณุชุฎุฏูุ ูุงููุ ุจุฏูู ููุต.  
- ูู ุงูุฎุทุท: ูู ุงูุนูุงุตุฑ ุงููุทููุจุฉ ููุฌูุฏุฉ (ุชุฏุฑูุจ+ุชุบุฐูุฉ+ุฅุฑุดุงุฏุงุช+ุชูุฏูู+ุจุฏุงุฆู).  
- ูู ูุงู ุงูุฑุฏ ุงุณุชุดุงุฑู: ููุฌุฏ ููุฎุต ููู + ุญู ุนููู + ุณุคุงู ูุงุญุฏ (ุฅู ูุฒู).  
- ุฅู ูุงูุช ุงูุจูุงูุงุช ูุงููุฉ ูุฎุทูุฉ: ูุง ุชุณุฃู ุฃูุซุฑ โ ูุฏูู ุงูุฎุทุฉ ุงูุขู.

` }
    function buildImagePrompt(){ return `ุญููู ุงูุตูุฑุฉ ูู 2-4 ุฃุณุทุฑ: 1) ูุง ุงูุฐู ุชุฑุงูุ 2) ุฃู ูุต/ููููุงุช ุธุงูุฑุฉ ุฅู ูุฌุฏุช. 3) ุงูุฏูุงูุฉ ุงูุตุญูุฉ/ุงูุฑูุงุถูุฉ. ูู ูุญุฏุฏูุง ูุนููููุง ูุงุนุชูุฏ ููุท ุนูู ุงูุตูุฑุฉ ุงููุฑุณูุฉ.` }

    /* ===== AI Call (proxy) ===== */
    async function callAI(prompt, {images, audio} = {}){
      try{
        const payload = { prompt };
        if (images && images.length){
          payload.images = images.map(x => {
            if(typeof x === 'string' && x.startsWith('data:')){
              const [meta, b64] = x.split(',');
              const mime = meta.substring(5, meta.indexOf(';'));
              return { mime, data: b64, dataUrl: x };
            }
            return x;
          });
        }
        if (audio) payload.audio = audio;
        const res = await fetch('/.netlify/functions/gemini-proxy',{
          method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)
        });
        const data = await res.json();
        if(!res.ok) throw new Error((data && (data.details || data.error)) || 'AI error');
        return data.text || '';
      }catch(e){ console.error(e); return '' }
    }

    /* ===== Health flags ===== */
    const MED_FLAGS=/(ุณูุฑู|ุถุบุท|ููุจ|ุณุฑุทุงู|ุญุงูู|ุญูู|ุฑุถุงุนุฉ|ุบุฏุฉ|ุฏุฑู|ูุจุฏ|ููู[ูุฉ]|kidney|liver|thyroid|injury|ุฅุตุงุจุฉ|ุนูููุฉ|ุฏูุงุก|ุฃุฏููุฉ|ููุฑุชูุฒูู|ุถุบุท ุงูุฏู|ุณูุฑ ุงูุฏู)/i;
    function analyzeUserMessage(msg){ if(MED_FLAGS.test(msg)){ displayMessage('ุชู ุฑุตุฏ ุญุงูุฉ ุตุญูุฉ โ ุณูุถูู ุงุญุชูุงุทุงุช ููุงุณุจุฉ. ุงุฐูุฑ ุชูุงุตูู ุงูุฏูุงุก/ุงูุฌุฑุนุฉ ุฃู ุงูุชุดุฎูุต ุฅู ููุฌุฏ.', 'ai') } }

    /* ===== History & State helpers ===== */
    function compactHistory(){
      if (chatHistory.length > MAX_TURNS) chatHistory = chatHistory.slice(-MAX_TURNS);
    }
    function buildInternalStateSummary(){
      const d = userState.data || {};
      const fields = [];
      if (d.name)    fields.push(`ุงูุงุณู: ${d.name}`);
      if (d.age)     fields.push(`ุงูุนูุฑ: ${d.age}`);
      if (d.country) fields.push(`ุงูุฏููุฉ: ${d.country}`);
      if (d.goal)    fields.push(`ุงููุฏู: ${d.goal}`);
      if (d.health)  fields.push(`ุญุงูุฉ ุตุญูุฉ: ${d.health}`);
      if (d.gym)     fields.push(`ููุงู ุงูุชูุฑูู: ${d.gym}`);
      if (d.meals)   fields.push(`ูุฌุจุงุช/ุงูููู: ${d.meals}`);
      return fields.length ? `๐๏ธ ููุฎุต ุงูุญุงูุฉ: ${fields.join(' | ')}` : '';
    }
    function buildConversationSnippet(){
      compactHistory();
      const lines = chatHistory.map(m=>{
        const role = m.role === 'assistant' ? 'ุงููุฏุฑุจ' : 'ุงููุณุชุฎุฏู';
        const txt  = (m.parts?.[0]?.text || '').replace(/\s+/g,' ').slice(0,1200);
        return `${role}: ${txt}`;
      });
      return lines.join('\n').slice(0, MAX_PROMPT_CHARS);
    }

    /* ===== Voice to text ===== */
    let recording=false; let sttSession=0; let recognition=null; let mediaStream=null; let mediaRecorder=null; let audioChunks=[]; let recStartTime=0;
    const supportSpeechRecognition = ()=> ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window);
    function startLocalRecognition(){
      const SR = window.SpeechRecognition || window.webkitSpeechRecognition; if(!SR) return null;
      const sessionId = ++sttSession;
      const rec = new SR();
      rec.lang = (LANG==='ar' ? 'ar-EG' : 'en-US');
      rec.interimResults = true; rec.continuous = true;
      rec.onresult = (e)=>{
        if(sessionId !== sttSession) return;
        let final=''; let interim='';
        for(let i=e.resultIndex;i<e.results.length;i++){
          const r=e.results[i];
          if(r.isFinal){ final += r[0].transcript } else { interim = r[0].transcript }
        }
        const text = (final || interim).trim();
        if(text){ userInput.value = text; userInput.focus(); }
      };
      rec.onerror = ()=>{}; rec.onend = ()=>{};
      rec.start();
      return { rec, sessionId };
    }
    async function startRecording(){
      if(recording) return; recording=true;
      if(supportSpeechRecognition()){
        const h = startLocalRecognition();
        recognition = h?.rec || null;
        micBtn.classList.add('mic-live'); recHintWrap.classList.remove('hidden'); $('recHint').textContent = i18n[LANG].recStart;
        return;
      }
      try{
        mediaStream = await navigator.mediaDevices.getUserMedia({audio:true});
        const mime = MediaRecorder.isTypeSupported('audio/webm;codecs=opus') ? 'audio/webm;codecs=opus' : (MediaRecorder.isTypeSupported('audio/webm') ? 'audio/webm' : 'audio/ogg');
        mediaRecorder = new MediaRecorder(mediaStream, {mimeType: mime});
        audioChunks = []; recStartTime = Date.now();
        mediaRecorder.ondataavailable = e => { if(e.data.size>0) audioChunks.push(e.data) };
        mediaRecorder.onstop = handleRecordingStopFallback;
        mediaRecorder.start();
        micBtn.classList.add('mic-live'); recHintWrap.classList.remove('hidden'); $('recHint').textContent = i18n[LANG].recStart;
      }catch(e){ toast(i18n[LANG].recDenied); recording=false; }
    }
    function stopRecording(){
      if(!recording) return; recording=false;
      if(recognition && recognition.stop){ try{ recognition.stop(); }catch(_){}; recognition=null; }
      try{ mediaRecorder && mediaRecorder.state!=='inactive' && mediaRecorder.stop(); }catch(_){}
      try{ mediaStream && mediaStream.getTracks().forEach(t=>t.stop()); }catch(_){}
      micBtn.classList.remove('mic-live'); recHintWrap.classList.add('hidden');
      sttSession++;
    }
    async function handleRecordingStopFallback(){
      const duration = (Date.now()-recStartTime)/1000; if(duration < 0.6){ toast(i18n[LANG].recTooShort); return }
      const blob = new Blob(audioChunks, {type: mediaRecorder.mimeType});
      const reader = new FileReader(); reader.onload = async () => {
        const base64 = reader.result.split(',')[1];
        const sttPrompt = `ุฃุนุฏ ููุท JSON ุตุงูุญ ุจูุฐุง ุงูุดูู ุจุฏูู ุฃู ููุงู ุขุฎุฑ:
{
  "transcript": string
}
ุญููู ุงูุตูุช ุฅูู ูุต ${(LANG==='ar'?'ุนุฑุจู':'English')} ูุงุถุญ.`;
        const raw = await callAI(sttPrompt, { audio: { mime: blob.type, data: base64 } });
        let transcript=''; try{ const s=raw.indexOf('{'); const e=raw.lastIndexOf('}'); const j = JSON.parse(raw.slice(s,e+1)); transcript = (j.transcript||'').trim(); }catch(_){ transcript='' }
        if(transcript){ userInput.value = transcript; userInput.focus(); toast(i18n[LANG].recSaved) }
      };
      reader.readAsDataURL(blob);
    }

    /* ===== Conversation Engine ===== */
    async function processAIResponse(message){
      const typingEl = showTyping('ai');

      // ุชุญุฏูุซ ุญุงูุฉ ูุจุณูุท ูู ุงูุฑุณุงูุฉ (ุงุฎุชูุงุฑู)
      if (/ุฎุทุฉ|ุฃุฎุณ|ุชุฎุณูุณ|ุชุถุฎูู|ุนุถู/i.test(message)) userState.data.goal = userState.data.goal || 'ุฎุทุฉ ูุฎุตุตุฉ';
      if (/ุฌูู|ุจูุช|ููุฒู/i.test(message)) userState.data.gym = userState.data.gym || 'ุบูุฑ ูุญุฏุฏ';
      if (MED_FLAGS.test(message)) userState.data.health = (userState.data.health || 'ูููุฏ ุตุญูุฉ') ;

      const state = buildInternalStateSummary();
      const convo = buildConversationSnippet();

      const coachPrompt =
`${buildCoachSystemPrompt()}

${state ? state + '\n' : ''}ุณุฌู ูุฎุชุตุฑ (ุขุฎุฑ ุงูุฑุณุงุฆู):
${convo}

ุฑุฏ ููุฏุฑูุจ ูุญุชุฑู ุนูู ุฑุณุงูุฉ ุงููุณุชุฎุฏู ุงูุฃุฎูุฑุฉ ููุทุ ูุงูุชุฒู ุจุณุคุงู ูุงุญุฏ ูุญุฏ ุฃูุตู ูู ูุฒู:
ุฑุณุงูุฉ ุงููุณุชุฎุฏู ุงูุฃุฎูุฑุฉ: ${message}`;

      let response = '';
      try{
        response = await callAI(coachPrompt);
      }catch(e){
        console.error(e);
      }

      removeNode(typingEl);

      if(!response || !response.trim()){
        response = (LANG==='ar')
          ? 'ุฎููููุง ูููู ุจุฎุทูุฉ ุนูููุฉ ุณุฑูุนุฉ: ุงูุดู 15โ20 ุฏูููุฉ ุงูููุงุฑุฏูุ ููู ุนูุฏู ูุฏู ูุญุฏุฏ ุณุจููููู ูุซุจูุชู ููุจูู ุนููู.'
          : 'Letโs keep momentum: take a 15โ20 min walk today. Share your main goal and weโll lock it.';
      }

      chatHistory.push({role:'assistant',parts:[{text:response}]});
      displayMessage(response,'ai');
      togglePlanCTA();
    }

    function sendMessage(){
      const message=(userInput.value||'').trim(); if(!message) return;
      displayMessage(message,'user');
      chatHistory.push({role:'user',parts:[{text:message}]});
      analyzeUserMessage(message);
      processAIResponse(message);
      userInput.value='';
    }

    /* ===== Events ===== */
    document.addEventListener('DOMContentLoaded',()=>{
      startBtn.addEventListener('click',()=>{ welcomeScreen.classList.add('hidden'); userDataScreen.classList.remove('hidden'); setLang(LANG) });
      nextBtn.addEventListener('click',()=>{
        const name=(userNameInput.value||'').trim();
        const age=(userAgeInput.value||'').trim();
        const country=(userCountryInput.value||'').trim();
        if(!name||!age||!country){ toast(i18n[LANG].emptyFields); return }
        userState.data={...userState.data,name,age,country};
        userDataScreen.classList.add('hidden'); chatContainer.classList.remove('hidden');
        const welcomeMsg = `ูุฑุญุจูุง ${name}. ููุดู ุฎุทูุฉ ุฎุทูุฉ ูุชุฌููุน ุจูุงูุงุชู ูุจูุงุก ุฎุทุฉ ุฏูููุฉ ูุงุจูุฉ ููุชูููุฐ.`;
        chatHistory.push({role:'assistant',parts:[{text:welcomeMsg}]}); displayMessage(welcomeMsg,'ai'); togglePlanCTA();
      });

      btnTheme.addEventListener('click', setTheme);
      btnLang.addEventListener('click',()=> setLang(LANG==='ar' ? 'en' : 'ar'));
      plusBtn.addEventListener('click',()=> imageInput.click());

      imageInput.addEventListener('change', async (e)=>{
        const file=e.target.files[0]; if(!file) return;
        const reader=new FileReader(); reader.onload= async (ev)=>{
          const dataUrl = ev.target.result;
          const imgHTML=`<img src="${dataUrl}" class="max-w-[220px] rounded-lg my-2" alt="uploaded"/>`;
          displayMessage(imgHTML,'user'); toast(i18n[LANG].imageUpload);
          const typingEl = showTyping('ai');
          let aiResp = await callAI(buildImagePrompt(), { images: [dataUrl] });
          removeNode(typingEl);
          const bad = /ูุฏูู|provide|ูุฑุฌู ุชูุฏูู|please provide|ูุง ุฃุณุชุทูุน ุฑุคูุฉ ุงูุตูุฑุฉ/i.test(aiResp||'');
          const reply = bad || !aiResp ? (LANG==='ar'? 'ุชู ุงุณุชูุงู ุงูุตูุฑุฉ ููุนุงูุฌุชูุง. ูู ุนุงูุฒ ุชุญููู ุฃุฏูุ ุงุจุนุช ุตูุฑุฉ ุฃูุถุญ ููุญููููุง ุจุงูุชูุตูู.' : 'Image received and processed. For deeper analysis, upload a clearer photo.') : aiResp;
          displayMessage(reply, 'ai');
          chatHistory.push({role:'user',parts:[{text:'[ุตูุฑุฉ ูุฑููุนุฉ]'}]});
          chatHistory.push({role:'assistant',parts:[{text:reply}]});
          togglePlanCTA();
        };
        reader.readAsDataURL(file)
      });

      function keyHandler(e){ if(e.key==='Enter') sendMessage() }
      sendBtn.addEventListener('click', sendMessage);
      userInput.addEventListener('keypress', keyHandler);

      // Mic interactions
      const startEvents = ['pointerdown','touchstart','mousedown'];
      const endEvents = ['pointerup','touchend','mouseup','mouseleave','pointercancel'];
      startEvents.forEach(ev => micBtn.addEventListener(ev, (e)=>{ e.preventDefault(); startRecording() }, {passive:false}));
      endEvents.forEach(ev => micBtn.addEventListener(ev, (e)=>{ e.preventDefault(); stopRecording() }, {passive:false}));

      // CTA -> contact
      generatePlanBtn.addEventListener('click', ()=>{ contactModal.classList.add('open'); contactModal.setAttribute('aria-hidden','false') });
      closeContactBtn.addEventListener('click',()=>{ contactModal.classList.remove('open'); contactModal.setAttribute('aria-hidden','true') });
      contactModal.addEventListener('click', e=>{ if(e.target===contactModal){ contactModal.classList.remove('open'); contactModal.setAttribute('aria-hidden','true') } });

      const savedTheme=localStorage.getItem('theme'); if(savedTheme==='dark'){ document.documentElement.classList.add('dark'); btnTheme.textContent='๐' }
      setLang('ar');
    })
  </script>
</body>
</html>

