<!DOCTYPE html>
const cfg = await r.json();
$('#coachName').value = cfg.coachName || '';
$('#phone').value = cfg.phone || '';
$('#whats').value = cfg.whats || '';
$('#avatar').value = cfg.avatar || '';
$('#bio').value = cfg.bio || '';
$('#iherbCode').value = cfg.iherbCode || '';
$('#iherbUrl').value = cfg.iherbUrl || '';
$('#aiPrompt').value = cfg.aiPrompt || '';
$('#welcomeTitle').value = cfg.welcomeTitle || '';
$('#welcomeSubtitle').value = cfg.welcomeSubtitle || '';
}


async function saveConfig(){
const token = $('#adminToken').value.trim();
const body = {
coachName: $('#coachName').value.trim(),
phone: $('#phone').value.trim(),
whats: $('#whats').value.trim(),
avatar: $('#avatar').value.trim(),
bio: $('#bio').value.trim(),
iherbCode: $('#iherbCode').value.trim(),
iherbUrl: $('#iherbUrl').value.trim(),
aiPrompt: $('#aiPrompt').value,
welcomeTitle: $('#welcomeTitle').value.trim(),
welcomeSubtitle: $('#welcomeSubtitle').value.trim(),
};
const r = await fetch(FSET, {method:'POST', headers:{'Content-Type':'application/json','x-admin-token':token}, body: JSON.stringify(body)});
const j = await r.json();
alert(j.ok ? 'تم الحفظ بنجاح' : ('فشل الحفظ: ' + (j.error||'Unknown')));
}


function buildBookmarklet(){
const url = location.origin + '/admin/runtime.js';
const code = `javascript:(function(){var s=document.createElement('script');s.src='${url}?t='+(Date.now());document.body.appendChild(s);}())`;
navigator.clipboard.writeText(code).then(()=>{
$('#bmlStatus').textContent = 'تم النسخ — اسحبه إلى شريط العلامات لديك.';
});
}


$('#loadBtn').onclick = loadConfig;
$('#saveBtn').onclick = saveConfig;
$('#copyBml').onclick = buildBookmarklet;


loadConfig();
</script>
</body>
</html>
